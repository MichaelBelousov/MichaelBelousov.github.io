<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="ie=edge"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><meta name="generator" content="Gatsby 5.13.6"/><meta data-react-helmet="true" name="description" content="Mike Belousov&#x27;s Website"/><meta data-react-helmet="true" property="og:title" content="The useClass hook and using class-based APIs in modern React"/><meta data-react-helmet="true" property="og:description" content="Mike Belousov&#x27;s Website"/><meta data-react-helmet="true" property="og:type" content="website"/><meta data-react-helmet="true" name="twitter:card" content="summary"/><meta data-react-helmet="true" name="twitter:creator" content="Mike Belousov"/><meta data-react-helmet="true" name="twitter:title" content="The useClass hook and using class-based APIs in modern React"/><meta data-react-helmet="true" name="twitter:description" content="Mike Belousov&#x27;s Website"/><meta name="theme-color" content="#663399"/><style data-href="/styles.072bd992f47fb1653576.css" data-identity="gatsby-global-css">._3d-module--container--a12c0{display:flex;flex-wrap:wrap}._3d-module--container--a12c0 img{max-height:200px}.DialogueEditor-module--toolbar--af3ea{box-sizing:border-box;display:flex;gap:22px;height:60px;padding:11px 22px}.DialogueEditor-module--graph--d94d3{height:calc(100vh - 60px)}.DialogueEditor-module--deleteButton--78e43{background-color:red;border:1px solid #000;box-sizing:border-box;color:#fff;cursor:pointer;font-size:16pt;font-weight:500;height:25px;left:calc(100% - 25px);position:absolute;top:0;width:25px}.DialogueEditor-module--dialogueEntryNode--d370e{background-color:#fff;border:1px solid #000;color:#000;padding:22px}.DialogueEditor-module--dialogueEntryNode--d370e>label{align-items:center;display:flex;gap:11px}.DialogueEditor-module--handle--30c88{height:16px;width:16px}.DialogueEditor-module--portraitImage--a639a{height:50px;width:50px}.work-module--container--6017a{overflow:hidden}.work-module--pdf--1900a{width:100%}code[class*=language-],pre[class*=language-]{word-wrap:normal;background:none;color:#f8f8f2;font-family:Consolas,Monaco,Andale Mono,Ubuntu Mono,monospace;font-size:1em;-webkit-hyphens:none;hyphens:none;line-height:1.5;tab-size:4;text-align:left;text-shadow:0 1px rgba(0,0,0,.3);white-space:pre;word-break:normal;word-spacing:normal}pre[class*=language-]{border-radius:.3em;margin:.5em 0;overflow:auto;padding:1em}:not(pre)>code[class*=language-],pre[class*=language-]{background:#272822}:not(pre)>code[class*=language-]{border-radius:.3em;padding:.1em;white-space:normal}.token.cdata,.token.comment,.token.doctype,.token.prolog{color:#8292a2}.token.punctuation{color:#f8f8f2}.token.namespace{opacity:.7}.token.constant,.token.deleted,.token.property,.token.symbol,.token.tag{color:#f92672}.token.boolean,.token.number{color:#ae81ff}.token.attr-name,.token.builtin,.token.char,.token.inserted,.token.selector,.token.string{color:#a6e22e}.language-css .token.string,.style .token.string,.token.entity,.token.operator,.token.url,.token.variable{color:#f8f8f2}.token.atrule,.token.attr-value,.token.class-name,.token.function{color:#e6db74}.token.keyword{color:#66d9ef}.token.important,.token.regex{color:#fd971f}.token.bold,.token.important{font-weight:700}.token.italic{font-style:italic}.token.entity{cursor:help}@media only screen and (max-width:700px){.header-module--pageWrapper--3e268{padding:12px}}@media only screen and (min-width:700px){.header-module--pageWrapper--3e268{padding:22px 1in 1in}}.header-module--topnav--68b35{align-items:center;display:flex;flex-wrap:wrap;gap:11px;justify-content:center}.header-module--navLink--e54d2{transform:scale(1)}.header-module--navLink--e54d2,.header-module--navLink--e54d2:link,.header-module--navLink--e54d2:visited{color:rgb(var(--body-rgb));font-size:1rem;font-weight:700;text-decoration:initial;transition:font-size .1s ease;vertical-align:middle}.header-module--navLink--e54d2:hover{color:orange;transform:scale(1.1)}.header-module--navLink--e54d2:hover>*{fill:orange}.shared-module--center--894dc{align-items:center;display:flex;justify-content:center}@media only screen and (max-width:700px){.layout-module--pageWrapper--b70ac{padding:12px}}@media only screen and (min-width:700px){.layout-module--pageWrapper--b70ac{padding:22px calc(50% - 4.25in)}}body,html{-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale;background-color:rgb(var(--background-rgb));color:rgb(var(--body-rgb));font-family:"Noto Serif",serif;font-optical-sizing:auto;font-size:14pt;font-style:normal;font-variation-settings:"wdth" 100;line-height:1.5em;margin:0}h1,h2,h3,h4,h5,h6,header{font-family:Open Sans,sans-serif}code{font-family:source-code-pro,Menlo,Monaco,Consolas,Courier New,monospace}a{color:#49a9f9}a:visited{color:#69a9f9}a:active{color:#b9b999}h1{font-size:1.4em;font-weight:700}h1,h3{font-style:italic}h3{font-size:1em;font-weight:400}h1+h3{margin-top:-8px}hr{color:rgba(var(--body-rgb),.3)}.blog-module--container--a5b3b{display:flex;flex-direction:column}@keyframes blog-module--spin--f8bab{0%{transform:scaleX(0)}50%{transform:scaleX(1)}to{transform:scaleX(0)}}.blog-module--loader--8d23c{align-items:center;display:flex;justify-content:center}.blog-module--loader--8d23c .blog-module--inner--d848f{animation-duration:1s;animation-iteration-count:infinite;animation-name:blog-module--spin--f8bab;animation-timing-function:ease-out;border:4px solid rgb(var(--body-rgb));border-radius:50%;height:26px;width:26px}.blog-module--compactBlogListing--64e52{line-height:1.1em}.blog-module--compactBlogListing--64e52>h3{margin-bottom:4px;margin-top:11px}.blog-module--compactBlogListing--64e52>ul{margin-bottom:0;margin-top:0}:root{--background-rgb:18,18,24;--body-rgb:239,239,239}.blog-module--blogLink--6573c{margin:11px}.blog-module--blogLink--6573c,.blog-module--blogLink--6573c:link,.blog-module--blogLink--6573c:visited{color:rgb(var(--body-rgb));font-weight:700;text-decoration:initial;vertical-align:middle}.blog-module--blogLink--6573c:hover{color:orange}.blog-module--blogsSidebar--3e1fa{font-size:.8rem;margin-right:.5in;margin-top:22px;overflow-x:hidden;position:fixed;right:0;top:.8in;width:12rem;z-index:1}@media only screen and (max-width:15in){.blog-module--blogsSidebar--3e1fa{display:none}}</style><title data-react-helmet="true">The useClass hook and using class-based APIs in modern React | Mike Belousov&#x27;s Website</title><link data-react-helmet="true" rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.10/styles/paraiso-dark.min.css" crossorigin="anonymous"/><link rel="icon" href="/favicon-32x32.png?v=2405b308f5bfa6bed1da04996c2e3d55" type="image/png"/><link rel="manifest" href="/manifest.webmanifest" crossorigin="anonymous"/><link rel="apple-touch-icon" sizes="48x48" href="/icons/icon-48x48.png?v=2405b308f5bfa6bed1da04996c2e3d55"/><link rel="apple-touch-icon" sizes="72x72" href="/icons/icon-72x72.png?v=2405b308f5bfa6bed1da04996c2e3d55"/><link rel="apple-touch-icon" sizes="96x96" href="/icons/icon-96x96.png?v=2405b308f5bfa6bed1da04996c2e3d55"/><link rel="apple-touch-icon" sizes="144x144" href="/icons/icon-144x144.png?v=2405b308f5bfa6bed1da04996c2e3d55"/><link rel="apple-touch-icon" sizes="192x192" href="/icons/icon-192x192.png?v=2405b308f5bfa6bed1da04996c2e3d55"/><link rel="apple-touch-icon" sizes="256x256" href="/icons/icon-256x256.png?v=2405b308f5bfa6bed1da04996c2e3d55"/><link rel="apple-touch-icon" sizes="384x384" href="/icons/icon-384x384.png?v=2405b308f5bfa6bed1da04996c2e3d55"/><link rel="apple-touch-icon" sizes="512x512" href="/icons/icon-512x512.png?v=2405b308f5bfa6bed1da04996c2e3d55"/><link rel="alternate" type="application/rss+xml" title="Mike Belousov&#x27;s blog" href="/rss.xml"/><link rel="preconnect" href="https://fonts.googleapis.com" crossorigin="true"/><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="true"/><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Open+Sans:wght@400;600;700&amp;display=swap"/><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Noto+Serif:ital,wght@0,100..900;1,100..900&amp;display=swap"/></head><body><div id="___gatsby"><div style="outline:none" tabindex="-1" id="gatsby-focus-wrapper"><div class="layout-module--pageWrapper--b70ac"><header><div class="shared-module--center--894dc"><nav class="header-module--topnav--68b35">Mike Belousov<a class="header-module--navLink--e54d2" href="/">Home</a><a class="header-module--navLink--e54d2" href="/work/">Resume</a><a class="header-module--navLink--e54d2" href="/3d/">Art</a><a class="header-module--navLink--e54d2" href="/blog/">Blog</a><a href="https://github.com/MichaelBelousov" class="shared-module--center--894dc"><svg class="header-module--navLink--e54d2" style="width:20px;height:20px;margin-top:4px" viewBox="0 0 100 100" width="98" height="96"><path fill-rule="evenodd" clip-rule="evenodd" d="M48.854 0C21.839 0 0 22 0 49.217c0 21.756 13.993 40.172 33.405 46.69 2.427.49 3.316-1.059 3.316-2.362 0-1.141-.08-5.052-.08-9.127-13.59 2.934-16.42-5.867-16.42-5.867-2.184-5.704-5.42-7.17-5.42-7.17-4.448-3.015.324-3.015.324-3.015 4.934.326 7.523 5.052 7.523 5.052 4.367 7.496 11.404 5.378 14.235 4.074.404-3.178 1.699-5.378 3.074-6.6-10.839-1.141-22.243-5.378-22.243-24.283 0-5.378 1.94-9.778 5.014-13.2-.485-1.222-2.184-6.275.486-13.038 0 0 4.125-1.304 13.426 5.052a46.97 46.97 0 0112.214-1.63c4.125 0 8.33.571 12.213 1.63 9.302-6.356 13.427-5.052 13.427-5.052 2.67 6.763.97 11.816.485 13.038 3.155 3.422 5.015 7.822 5.015 13.2 0 18.905-11.404 23.06-22.324 24.283 1.78 1.548 3.316 4.481 3.316 9.126 0 6.6-.08 11.897-.08 13.526 0 1.304.89 2.853 3.316 2.364 19.412-6.52 33.405-24.935 33.405-46.691C97.707 22 75.788 0 48.854 0z" fill="#fff"></path></svg></a></nav></div><hr/><br/></header><main><nav class="blog-module--blogsSidebar--3e1fa"><h2>Other posts</h2><div class="blog-module--compactBlogListing--64e52"><h3><strong>2024</strong></h3><div><div><a href="/blog/maybe_streaming/" class="blog-module--blogLink--6573c" style="margin:0">Soft starting some streaming</a></div><div><a href="/blog/mobile_programming/" class="blog-module--blogLink--6573c" style="margin:0">Programming on your phone</a></div></div></div><div class="blog-module--compactBlogListing--64e52"><h3><strong>2022</strong></h3><div><div><a href="/blog/bashisms/" class="blog-module--blogLink--6573c" style="margin:0">Bashisms Part 1</a></div></div></div><div class="blog-module--compactBlogListing--64e52"><h3><strong>2021</strong></h3><div><div><a href="/blog/subclass-apis-in-react/" class="blog-module--blogLink--6573c" style="margin:0">The useClass hook and using class-based APIs in modern React</a></div></div></div><div class="blog-module--compactBlogListing--64e52"><h3><strong>2020</strong></h3><div><div><a href="/blog/iterators-and-generators-are-better-than-array-prototype/" class="blog-module--blogLink--6573c" style="margin:0">Lazy Javascript Iterables via Generators</a></div><div><a href="/blog/imodeljs-articles-oct-2020/" class="blog-module--blogLink--6573c" style="margin:0">iModel.js Articles</a></div><div><a href="/blog/react_hooks_tutorial/" class="blog-module--blogLink--6573c" style="margin:0">React and its hooks without Create React App</a></div><div><a href="/blog/always_monorepo/" class="blog-module--blogLink--6573c" style="margin:0">Always use a Monorepo</a></div></div></div><div class="blog-module--compactBlogListing--64e52"><h3><strong>2019</strong></h3><div><div><a href="/blog/eye_ball/" class="blog-module--blogLink--6573c" style="margin:0">Eye Progress</a></div><div><a href="/blog/blender_2_8/" class="blog-module--blogLink--6573c" style="margin:0">Blender 2.8 Grease Pencil Is Awesome</a></div><div><a href="/blog/convex_hull/" class="blog-module--blogLink--6573c" style="margin:0">Melkman Algorithm Visualization</a></div><div><a href="/blog/latex_and_python/" class="blog-module--blogLink--6573c" style="margin:0">Empowering LaTeX (PyLaTeXc)</a></div></div></div><div class="blog-module--compactBlogListing--64e52"><h3><strong>2018</strong></h3><div><div><a href="/blog/billwurtz/" class="blog-module--blogLink--6573c" style="margin:0">Bill Wurtz</a></div><div><a href="/blog/Super_Thin_RAII_Wrappers_for_C_Types/" class="blog-module--blogLink--6573c" style="margin:0">Super Thin RAII Wrappers for C Types</a></div></div></div></nav><div><h1>The useClass hook and using class-based APIs in modern React</h1><h3>October 10, 2021</h3><div><p>Modern React has a problem, that functional components unfortunately, make it all too easy to rely on state
that gets thrown out the window between renders. That's why <code class="language-js">useCallback</code> and <code class="language-js">useEffect</code>, which take closures
that may accidentally reference old state in their bodies, can have weird bugs when dependencies aren't used correctly.</p>
<p>Take for example:</p>
<div class="gatsby-highlight" data-language="jsx"><pre class="language-jsx"><code class="language-jsx"><span class="token keyword">function</span> <span class="token function">MyComponent</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> <span class="token punctuation">[</span>state1<span class="token punctuation">,</span> setState2<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span>
    <span class="token keyword">const</span> <span class="token punctuation">[</span>state2<span class="token punctuation">,</span> setState2<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span>
    <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>state1 <span class="token operator">+</span> state2<span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>state1<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// oops state2 is also a dependency</span>
    <span class="token keyword">return</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">onClick</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">setState1</span><span class="token punctuation">(</span>state1 <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token punctuation">></span></span><span class="token plain-text">press me</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">></span></span>
<span class="token punctuation">}</span></code></pre></div>
<p>Because no dependencies have been listed for React to check between renders, it will see that the effect does not need
to be updated, even though the value of <code class="language-js">state</code> would have changed between renders when the button is clicked.
When altering existing code especially, you may accidentally add a new dependency without realizing and not add it to the list,
and thus, a bug is born.</p>
<p>This is really just a shortcoming of something that should be a language-level feature so that we wouldn't have to extract
such redundant data ourselves, but to continue using vanilla JavaScript safely, we lucikly have
<a href="https://reactjs.org/docs/hooks-rules.html">the rules of hooks and some eslint plugins</a>, which, when integrated properly
with your editor and CI/CD, provide near perfect support for inferred dependencies.</p>
<p>These dependencies are checked by React using <em>strict equality</em>, which in JavaScript pretty much means object identity.
To determine
whether your <code class="language-js">useEffect</code>, <code class="language-js">useMemo</code>, or <code class="language-js">useCallback</code> should be thrown out and replaced with the new
closure, referencing up-to-date state, all objects in the dependency list are checked if they still <code class="language-text">===</code> each other.
This works fine, petty performance concerns aside, until you want React to not throw away the old function, but instead keep
it <em>stable</em>.</p>
<p>Let's try the following:</p>
<div class="gatsby-highlight" data-language="jsx"><pre class="language-jsx"><code class="language-jsx"><span class="token keyword">function</span> <span class="token function">MyComponent</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> <span class="token punctuation">[</span>isHovered<span class="token punctuation">,</span> setIsHovered<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">class</span> <span class="token class-name">MyClass</span> <span class="token punctuation">{</span>
        x <span class="token operator">=</span> <span class="token number">5</span>
        <span class="token function">color</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> isHovered<span class="token operator">?</span> <span class="token string">"red"</span> <span class="token operator">:</span> <span class="token string">"blue"</span> <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    
    <span class="token keyword">const</span> <span class="token punctuation">[</span>myInst<span class="token punctuation">,</span> setMyInst<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">MyClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

    <span class="token keyword">return</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">onMouseEnter</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">setIsHovered</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">}</span></span>
                <span class="token attr-name">onMouseLeave</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">setIsHovered</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">}</span></span>
                <span class="token attr-name">style</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token punctuation">{</span><span class="token literal-property property">height</span><span class="token operator">:</span> <span class="token string">"50px"</span><span class="token punctuation">,</span> <span class="token literal-property property">width</span><span class="token operator">:</span> <span class="token string">"50px"</span><span class="token punctuation">}</span><span class="token punctuation">}</span></span> <span class="token punctuation">/></span></span>
<span class="token punctuation">}</span></code></pre></div>
<p>What's wrong here? Suppose we are using a dependency, <code class="language-js"><span class="token string">"some-api"</span></code>, that manipulates subclasses from its own classes,
and we have to register them to use them (ignore whether that's a well-designed JavaScript library or not for now, these
kinds of packages do exist). Let's add an effect to register our class on component mount, and unregister it after:</p>
<div class="gatsby-highlight" data-language="jsx"><pre class="language-jsx"><code class="language-jsx"><span class="token keyword">import</span> <span class="token punctuation">{</span> ApiClass<span class="token punctuation">,</span> register<span class="token punctuation">,</span> unregister <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"some-api"</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">MyComponent</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">//...</span>
    <span class="token keyword">class</span> <span class="token class-name">MyClass</span> <span class="token keyword">extends</span> <span class="token class-name">ApiClass</span> <span class="token punctuation">{</span>
        x <span class="token operator">=</span> <span class="token number">5</span>
        <span class="token function">color</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> isHovered <span class="token operator">?</span> <span class="token string">"red"</span> <span class="token operator">:</span> <span class="token string">"blue"</span> <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
        <span class="token function">register</span><span class="token punctuation">(</span>MyClass<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">unregister</span><span class="token punctuation">(</span>MyClass<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>MyClass<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//...</span>
<span class="token punctuation">}</span></code></pre></div>
<p>Now, a <em>new</em> <code class="language-js">MyClass</code> is created every render
because the class declaration is inside a function body, which means <code class="language-js">MyClass</code> is always new so the effect is always
reran, not just on mount, and we call <code class="language-js">register</code> and <code class="language-js">unregister</code>
practically every render. Moreso, <code class="language-js">myInst</code> is no longer of the same class after the first render,
so <code class="language-js">myInst <span class="token keyword">instanceof</span> <span class="token class-name">MyClass</span></code> will be false, and that might mess with <code class="language-js"><span class="token string">"some-api"</span></code>'s assumptions.</p>
<p>Worse still, the <code class="language-js">MyClass<span class="token punctuation">.</span>color</code> method has an out-of-date copy of <code class="language-js">isHovered</code>. <code class="language-js">myInst</code> uses the
definition as it saw it during the first render when it was constructed, and <code class="language-js">isHovered</code> was immutably
set as <code class="language-js"><span class="token boolean">false</span></code>. To fix this in JavaScript, we need a stable, mutable object indirectly referencing <code class="language-js">isHovered</code>.
In React we can get that using a <code class="language-js">ref</code> like so:</p>
<div class="gatsby-highlight" data-language="jsx"><pre class="language-jsx"><code class="language-jsx"><span class="token keyword">import</span> <span class="token punctuation">{</span> ApiClass<span class="token punctuation">,</span> register<span class="token punctuation">,</span> unregister <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"some-api"</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">MyComponent</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">//...</span>
    <span class="token keyword">const</span> componentState <span class="token operator">=</span> <span class="token function">useRef</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    componentState<span class="token punctuation">.</span>current<span class="token punctuation">.</span>isHovered <span class="token operator">=</span> isHovered<span class="token punctuation">;</span> <span class="token comment">// update the state to whatever the lastest is from React</span>
    <span class="token keyword">class</span> <span class="token class-name">MyClass</span> <span class="token keyword">extends</span> <span class="token class-name">ApiClass</span> <span class="token punctuation">{</span>
        x <span class="token operator">=</span> <span class="token number">5</span>
        <span class="token function">color</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> componentState<span class="token punctuation">.</span>isHovered <span class="token operator">?</span> <span class="token string">"red"</span> <span class="token operator">:</span> <span class="token string">"blue"</span> <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token comment">//...</span>
<span class="token punctuation">}</span></code></pre></div>
<p>Now our class will always reference the up-to-date state through an indirect reference that is always up to date.
The final step is to make sure we have a stable reference to the class itself, which is done the same way we get
a stable state object for indirect access of the component state.</p>
<div class="gatsby-highlight" data-language="jsx"><pre class="language-jsx"><code class="language-jsx"><span class="token keyword">import</span> <span class="token punctuation">{</span> ApiClass<span class="token punctuation">,</span> register<span class="token punctuation">,</span> unregister <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"some-api"</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">MyComponent</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">//...</span>
    <span class="token keyword">const</span> MyClass <span class="token operator">=</span> <span class="token function">useRef</span><span class="token punctuation">(</span><span class="token keyword">class</span> <span class="token class-name">MyClass</span> <span class="token keyword">extends</span> <span class="token class-name">ApiClass</span> <span class="token punctuation">{</span>
        x <span class="token operator">=</span> <span class="token number">5</span>
        <span class="token function">color</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> componentState<span class="token punctuation">.</span>isHovered <span class="token operator">?</span> <span class="token string">"red"</span> <span class="token operator">:</span> <span class="token string">"blue"</span> <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span>current<span class="token punctuation">;</span>
    <span class="token comment">//...</span>
<span class="token punctuation">}</span></code></pre></div>
<p><code class="language-js">useRef</code>, will be a stable reference to its argument, and can only be mutated by setting its
<code class="language-js">current</code> property, but we've made that impossible by keeping no reference to the ref object itself.
Now that we have it, we can generalize to create a <code class="language-js">useClass</code> hook that does the work for us.</p>
<div id="the-useclass-hook"></div>
<h2><a href="#the-useclass-hook">The <code class="language-text">useClass</code> Hook</a></h2>
<p>Smaller than I thought it would be, really.</p>
<div class="gatsby-highlight" data-language="tsx"><pre class="language-tsx"><code class="language-tsx"><span class="token keyword">function</span> useClass<span class="token operator">&lt;</span><span class="token constant">C</span> <span class="token keyword">extends</span> <span class="token class-name"><span class="token keyword">new</span></span> <span class="token punctuation">(</span><span class="token operator">...</span>args<span class="token operator">:</span> <span class="token builtin">any</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token builtin">any</span><span class="token punctuation">,</span> <span class="token constant">S</span> <span class="token keyword">extends</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token operator">></span><span class="token punctuation">(</span>
  <span class="token function-variable function">makeClass</span><span class="token operator">:</span> <span class="token punctuation">(</span>s<span class="token operator">:</span> <span class="token constant">S</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token constant">C</span><span class="token punctuation">,</span>
  dependencies<span class="token operator">:</span> <span class="token constant">S</span> <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span> <span class="token keyword">as</span> <span class="token constant">S</span>
<span class="token punctuation">)</span><span class="token operator">:</span> <span class="token constant">C</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> stateRef <span class="token operator">=</span> <span class="token function">useRef</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span> <span class="token keyword">as</span> <span class="token constant">S</span><span class="token punctuation">)</span><span class="token punctuation">.</span>current<span class="token punctuation">;</span>
  Object<span class="token punctuation">.</span><span class="token function">assign</span><span class="token punctuation">(</span>stateRef<span class="token punctuation">,</span> dependencies<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token function">useRef</span><span class="token punctuation">(</span><span class="token function">makeClass</span><span class="token punctuation">(</span>stateRef<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>current<span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre></div>
<p>Let's use it:</p>
<div class="gatsby-highlight" data-language="tsx"><pre class="language-tsx"><code class="language-tsx"><span class="token keyword">class</span> <span class="token class-name">Base</span> <span class="token punctuation">{</span>
  <span class="token function">f</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token string">"x"</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">function</span> <span class="token function">App</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>isHovered<span class="token punctuation">,</span> setIsHovered<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">const</span> Derived <span class="token operator">=</span> <span class="token function">useClass</span><span class="token punctuation">(</span>
    <span class="token punctuation">(</span>state<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token keyword">class</span> <span class="token class-name">Derived</span> <span class="token keyword">extends</span> <span class="token class-name">Base</span> <span class="token punctuation">{</span>
                 <span class="token function">f</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">f</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">_</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>state<span class="token punctuation">.</span>isHovered <span class="token operator">?</span> <span class="token string">"y"</span> <span class="token operator">:</span> <span class="token string">"n"</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
               <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span> isHovered <span class="token punctuation">}</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">const</span> <span class="token punctuation">[</span>myInst<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Derived</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">></span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span> <span class="token attr-name">onMouseEnter</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">setIsHovered</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">}</span></span>
         <span class="token attr-name">onMouseLeave</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">setIsHovered</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token punctuation">></span></span><span class="token plain-text">
        </span><span class="token punctuation">{</span>myInst<span class="token punctuation">.</span><span class="token function">f</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span><span class="token plain-text">
    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre></div>
<p>And there we have classes as usable as possible directly in our functional components.
Probably not as performant as a module-scope class declaration unless our runtime is extremely clever,
but that's just the world we're living in. If you're heavily using an inheritance based library in your work,
maybe you'll enjoy this as much as I do.</p></div></div></main><footer><a href="/rss.xml">&gt;subscribe to my rss feed</a></footer></div></div><div id="gatsby-announcer" style="position:absolute;top:0;width:1px;height:1px;padding:0;overflow:hidden;clip:rect(0, 0, 0, 0);white-space:nowrap;border:0" aria-live="assertive" aria-atomic="true"></div></div><script id="gatsby-script-loader">/*<![CDATA[*/window.pagePath="/blog/subclass-apis-in-react/";/*]]>*/</script><!-- slice-start id="_gatsby-scripts-1" -->
          <script
            id="gatsby-chunk-mapping"
          >
            window.___chunkMapping="{\"app\":[\"/app.js\"],\"component---src-components-blog-page-tsx\":[\"/component---src-components-blog-page-tsx.js\"],\"component---src-pages-3-d-tsx\":[\"/component---src-pages-3-d-tsx.js\"],\"component---src-pages-404-tsx\":[\"/component---src-pages-404-tsx.js\"],\"component---src-pages-blog-tsx\":[\"/component---src-pages-blog-tsx.js\"],\"component---src-pages-dialogue-editor-tsx\":[\"/component---src-pages-dialogue-editor-tsx.js\"],\"component---src-pages-index-tsx\":[\"/component---src-pages-index-tsx.js\"],\"component---src-pages-sentinel-beam-tsx\":[\"/component---src-pages-sentinel-beam-tsx.js\"],\"component---src-pages-work-tsx\":[\"/component---src-pages-work-tsx.js\"]}";
          </script>
        <script>window.___webpackCompilationHash="c2a8f77c8677422b6027";</script><script src="/webpack-runtime.js" async></script><script src="/app.js" async></script><!-- slice-end id="_gatsby-scripts-1" --></body></html>