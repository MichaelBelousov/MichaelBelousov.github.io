<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="ie=edge"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><style data-href="/styles.2bfa96bd1441db1b300c.css" id="gatsby-global-css">code[class*=language-],pre[class*=language-]{color:#f8f8f2;background:none;text-shadow:0 1px rgba(0,0,0,.3);font-family:Consolas,Monaco,Andale Mono,Ubuntu Mono,monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-ms-hyphens:none;hyphens:none}pre[class*=language-]{padding:1em;margin:.5em 0;overflow:auto;border-radius:.3em}:not(pre)>code[class*=language-],pre[class*=language-]{background:#272822}:not(pre)>code[class*=language-]{padding:.1em;border-radius:.3em;white-space:normal}.token.cdata,.token.comment,.token.doctype,.token.prolog{color:#8292a2}.token.punctuation{color:#f8f8f2}.token.namespace{opacity:.7}.token.constant,.token.deleted,.token.property,.token.symbol,.token.tag{color:#f92672}.token.boolean,.token.number{color:#ae81ff}.token.attr-name,.token.builtin,.token.char,.token.inserted,.token.selector,.token.string{color:#a6e22e}.language-css .token.string,.style .token.string,.token.entity,.token.operator,.token.url,.token.variable{color:#f8f8f2}.token.atrule,.token.attr-value,.token.class-name,.token.function{color:#e6db74}.token.keyword{color:#66d9ef}.token.important,.token.regex{color:#fd971f}.token.bold,.token.important{font-weight:700}.token.italic{font-style:italic}.token.entity{cursor:help}._3d-module--container--3u9YK{display:flex;flex-wrap:wrap}._3d-module--container--3u9YK img{max-height:200px}.work-module--container--31LKz{overflow:hidden}.work-module--pdf--8cbUT{width:100%}@media only screen and (max-width:700px){.header-module--pageWrapper--1ij_0{padding:12px}}@media only screen and (min-width:700px){.header-module--pageWrapper--1ij_0{padding:22px 1in 1in}}.header-module--separate--G80zA{display:flex;align-items:center;justify-content:space-between}.header-module--separate--G80zA .header-module--left--2-ITV{display:flex;flex-direction:row;flex-wrap:wrap;margin-left:-22px;padding:11px}.header-module--separate--G80zA .header-module--left--2-ITV .header-module--navLink--1IuEZ{margin:11px}.header-module--separate--G80zA .header-module--left--2-ITV .header-module--navLink--1IuEZ,.header-module--separate--G80zA .header-module--left--2-ITV .header-module--navLink--1IuEZ:link,.header-module--separate--G80zA .header-module--left--2-ITV .header-module--navLink--1IuEZ:visited{font-size:2rem;color:rgb(var(--body-rgb));text-decoration:initial;font-style:italic;font-weight:700;transition:font-size .1s ease;height:2.5rem;vertical-align:middle}@media only screen and (max-width:700px){.header-module--separate--G80zA .header-module--left--2-ITV .header-module--navLink--1IuEZ,.header-module--separate--G80zA .header-module--left--2-ITV .header-module--navLink--1IuEZ:link,.header-module--separate--G80zA .header-module--left--2-ITV .header-module--navLink--1IuEZ:visited{font-size:1.5rem}}.header-module--separate--G80zA .header-module--left--2-ITV .header-module--navLink--1IuEZ:hover{color:orange;font-size:2.5em}@media only screen and (max-width:700px){.layout-module--pageWrapper--22gEu{padding:12px}}@media only screen and (min-width:700px){.layout-module--pageWrapper--22gEu{padding:22px 1in 1in}}body,html{margin:0;font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen,Ubuntu,Cantarell,Fira Sans,Droid Sans,Helvetica Neue,sans-serif;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale;background-color:rgb(var(--background-rgb));font-size:14pt;color:rgb(var(--body-rgb))}code{font-family:source-code-pro,Menlo,Monaco,Consolas,Courier New,monospace}a{color:#49a9f9}a:visited{color:#69a9f9}a:active{color:#b9b999}h1{font-size:1.4em;font-weight:700}h1,h3{font-style:italic}h3{font-size:1em;font-weight:400}h1+h3{margin-top:-8px}hr{color:rgba(var(--body-rgb),.3)}.blog-module--container--1pCGB{display:flex;flex-direction:column}@keyframes blog-module--spin--1ZuQ_{0%{transform:scaleX(0)}50%{transform:scaleX(1)}to{transform:scaleX(0)}}.blog-module--loader--27Uha{display:flex;align-items:center;justify-content:center}.blog-module--loader--27Uha .blog-module--inner--3N3oy{border:4px solid rgb(var(--body-rgb));height:26px;width:26px;border-radius:50%;animation-name:blog-module--spin--1ZuQ_;animation-duration:1s;animation-iteration-count:infinite;animation-timing-function:ease-out}@media only screen and (min-width:700px){.blog-module--post--oYMJm{padding:0 1in}.blog-module--post--oYMJm *{max-width:100%}}:root{--background-rgb:18,18,24;--body-rgb:239,239,239}.blog-module--blogLink--1dLLs{margin:11px}.blog-module--blogLink--1dLLs,.blog-module--blogLink--1dLLs:link,.blog-module--blogLink--1dLLs:visited{color:rgb(var(--body-rgb));text-decoration:initial;font-weight:700;vertical-align:middle}.blog-module--blogLink--1dLLs:hover{color:orange}.DialogueEditor-module--toolbar--2WdIZ{box-sizing:border-box;height:60px;display:flex;padding:11px 22px;gap:22px}.DialogueEditor-module--graph--1_z-x{height:calc(100vh - 60px)}.DialogueEditor-module--deleteButton--3ZPhz{position:absolute;top:0;height:25px;width:25px;left:calc(100% - 25px);border:1px solid #000;box-sizing:border-box;background-color:red;color:#fff;font-size:16pt;font-weight:500;cursor:pointer}.DialogueEditor-module--dialogueEntryNode--gdaLP{border:1px solid #000;background-color:#fff;color:#000;padding:22px}.DialogueEditor-module--dialogueEntryNode--gdaLP>label{display:flex;gap:11px;align-items:center}.DialogueEditor-module--handle--2Tk3p{width:16px;height:16px}.DialogueEditor-module--portraitImage--3zG46{height:50px;width:50px}</style><meta name="generator" content="Gatsby 2.30.1"/><title data-react-helmet="true">The useClass hook and using class-based APIs in modern React | Mike Belousov&#x27;s Website</title><link data-react-helmet="true" rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.10/styles/paraiso-dark.min.css" crossorigin="anonymous"/><meta data-react-helmet="true" name="description" content="Mike Belousov&#x27;s Website"/><meta data-react-helmet="true" property="og:title" content="The useClass hook and using class-based APIs in modern React"/><meta data-react-helmet="true" property="og:description" content="Mike Belousov&#x27;s Website"/><meta data-react-helmet="true" property="og:type" content="website"/><meta data-react-helmet="true" name="twitter:card" content="summary"/><meta data-react-helmet="true" name="twitter:creator" content="Mike Belousov"/><meta data-react-helmet="true" name="twitter:title" content="The useClass hook and using class-based APIs in modern React"/><meta data-react-helmet="true" name="twitter:description" content="Mike Belousov&#x27;s Website"/><link rel="icon" href="/favicon-32x32.png?v=2405b308f5bfa6bed1da04996c2e3d55" type="image/png"/><link rel="manifest" href="/manifest.webmanifest" crossorigin="anonymous"/><meta name="theme-color" content="#663399"/><link rel="apple-touch-icon" sizes="48x48" href="/icons/icon-48x48.png?v=2405b308f5bfa6bed1da04996c2e3d55"/><link rel="apple-touch-icon" sizes="72x72" href="/icons/icon-72x72.png?v=2405b308f5bfa6bed1da04996c2e3d55"/><link rel="apple-touch-icon" sizes="96x96" href="/icons/icon-96x96.png?v=2405b308f5bfa6bed1da04996c2e3d55"/><link rel="apple-touch-icon" sizes="144x144" href="/icons/icon-144x144.png?v=2405b308f5bfa6bed1da04996c2e3d55"/><link rel="apple-touch-icon" sizes="192x192" href="/icons/icon-192x192.png?v=2405b308f5bfa6bed1da04996c2e3d55"/><link rel="apple-touch-icon" sizes="256x256" href="/icons/icon-256x256.png?v=2405b308f5bfa6bed1da04996c2e3d55"/><link rel="apple-touch-icon" sizes="384x384" href="/icons/icon-384x384.png?v=2405b308f5bfa6bed1da04996c2e3d55"/><link rel="apple-touch-icon" sizes="512x512" href="/icons/icon-512x512.png?v=2405b308f5bfa6bed1da04996c2e3d55"/><link rel="alternate" type="application/rss+xml" href="/rss.xml"/><link as="script" rel="preload" href="/webpack-runtime-86ff0e5dcd201d98e513.js"/><link as="script" rel="preload" href="/app-71888d304687d9bcd05d.js"/><link as="script" rel="preload" href="/styles-407fe62976dc5310c43e.js"/><link as="script" rel="preload" href="/922baf5242ed4ba4672941b22c37e341b7a6f945-a49834105405f3830df1.js"/><link as="script" rel="preload" href="/component---src-components-blog-page-tsx-091ca84cc61c106d77bd.js"/><link as="fetch" rel="preload" href="/page-data/blog/subclass-apis-in-react/page-data.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/page-data/sq/d/3649515864.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/page-data/sq/d/63159454.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/page-data/app-data.json" crossorigin="anonymous"/></head><body><div id="___gatsby"><div style="outline:none" tabindex="-1" id="gatsby-focus-wrapper"><div class="layout-module--pageWrapper--22gEu"><header><div class="header-module--separate--G80zA"><div class="header-module--left--2-ITV"><a class="header-module--navLink--1IuEZ" href="/">Home</a><a class="header-module--navLink--1IuEZ" href="/work">Work</a><a class="header-module--navLink--1IuEZ" href="/3d">3D</a><a class="header-module--navLink--1IuEZ" href="/blog">Blog</a></div><div><h1>Mike Belousov</h1></div></div><hr/></header><main><div class="blog-module--post--oYMJm"><h1>The useClass hook and using class-based APIs in modern React</h1><h3>October 10, 2021</h3><div><p>Modern React has a problem, that functional components unfortunately, make it all too easy to rely on state
that gets thrown out the window between renders. That's why <code class="language-js">useCallback</code> and <code class="language-js">useEffect</code>, which take closures
that may accidentally reference old state in their bodies, can have weird bugs when dependencies aren't used correctly.</p>
<p>Take for example:</p>
<div class="gatsby-highlight" data-language="jsx"><pre class="language-jsx"><code class="language-jsx"><span class="token keyword">function</span> <span class="token function">MyComponent</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> <span class="token punctuation">[</span>state1<span class="token punctuation">,</span> setState2<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span>
    <span class="token keyword">const</span> <span class="token punctuation">[</span>state2<span class="token punctuation">,</span> setState2<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span>
    <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>state1 <span class="token operator">+</span> state2<span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>state1<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// oops state2 is also a dependency</span>
    <span class="token keyword">return</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">onClick</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">setState1</span><span class="token punctuation">(</span>state1 <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token punctuation">></span></span><span class="token plain-text">press me</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">></span></span>
<span class="token punctuation">}</span></code></pre></div>
<p>Because no dependencies have been listed for React to check between renders, it will see that the effect does not need
to be updated, even though the value of <code class="language-js">state</code> would have changed between renders when the button is clicked.
When altering existing code especially, you may accidentally add a new dependency without realizing and not add it to the list,
and thus, a bug is born.</p>
<p>This is really just a shortcoming of something that should be a language-level feature so that we wouldn't have to extract
such redundant data ourselves, but to continue using vanilla JavaScript safely, we lucikly have
<a href="https://reactjs.org/docs/hooks-rules.html">the rules of hooks and some eslint plugins</a>, which, when integrated properly
with your editor and CI/CD, provide near perfect support for inferred dependencies.</p>
<p>These dependencies are checked by React using <em>strict equality</em>, which in JavaScript pretty much means object identity.
To determine
whether your <code class="language-js">useEffect</code>, <code class="language-js">useMemo</code>, or <code class="language-js">useCallback</code> should be thrown out and replaced with the new
closure, referencing up-to-date state, all objects in the dependency list are checked if they still <code class="language-text">===</code> each other.
This works fine, petty performance concerns aside, until you want React to not throw away the old function, but instead keep
it <em>stable</em>.</p>
<p>Let's try the following:</p>
<div class="gatsby-highlight" data-language="jsx"><pre class="language-jsx"><code class="language-jsx"><span class="token keyword">function</span> <span class="token function">MyComponent</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> <span class="token punctuation">[</span>isHovered<span class="token punctuation">,</span> setIsHovered<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">class</span> <span class="token class-name">MyClass</span> <span class="token punctuation">{</span>
        x <span class="token operator">=</span> <span class="token number">5</span>
        <span class="token function">color</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> isHovered<span class="token operator">?</span> <span class="token string">"red"</span> <span class="token operator">:</span> <span class="token string">"blue"</span> <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    
    <span class="token keyword">const</span> <span class="token punctuation">[</span>myInst<span class="token punctuation">,</span> setMyInst<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">MyClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

    <span class="token keyword">return</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">onMouseEnter</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">setIsHovered</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">}</span></span>
                <span class="token attr-name">onMouseLeave</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">setIsHovered</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">}</span></span>
                <span class="token attr-name">style</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token punctuation">{</span>height<span class="token operator">:</span> <span class="token string">"50px"</span><span class="token punctuation">,</span> width<span class="token operator">:</span> <span class="token string">"50px"</span><span class="token punctuation">}</span><span class="token punctuation">}</span></span> <span class="token punctuation">/></span></span>
<span class="token punctuation">}</span></code></pre></div>
<p>What's wrong here? Suppose we are using a dependency, <code class="language-js"><span class="token string">"some-api"</span></code>, that manipulates subclasses from its own classes,
and we have to register them to use them (ignore whether that's a well-designed JavaScript library or not for now, these
kinds of packages do exist). Let's add an effect to register our class on component mount, and unregister it after:</p>
<div class="gatsby-highlight" data-language="jsx"><pre class="language-jsx"><code class="language-jsx"><span class="token keyword">import</span> <span class="token punctuation">{</span> ApiClass<span class="token punctuation">,</span> register<span class="token punctuation">,</span> unregister <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"some-api"</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">MyComponent</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">//...</span>
    <span class="token keyword">class</span> <span class="token class-name">MyClass</span> <span class="token keyword">extends</span> <span class="token class-name">ApiClass</span> <span class="token punctuation">{</span>
        x <span class="token operator">=</span> <span class="token number">5</span>
        <span class="token function">color</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> isHovered <span class="token operator">?</span> <span class="token string">"red"</span> <span class="token operator">:</span> <span class="token string">"blue"</span> <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
        <span class="token function">register</span><span class="token punctuation">(</span>MyClass<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">unregister</span><span class="token punctuation">(</span>MyClass<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>MyClass<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//...</span>
<span class="token punctuation">}</span></code></pre></div>
<p>Now, a <em>new</em> <code class="language-js">MyClass</code> is created every render
because the class declaration is inside a function body, which means <code class="language-js">MyClass</code> is always new so the effect is always
reran, not just on mount, and we call <code class="language-js">register</code> and <code class="language-js">unregister</code>
practically every render. Moreso, <code class="language-js">myInst</code> is no longer of the same class after the first render,
so <code class="language-js">myInst <span class="token keyword">instanceof</span> <span class="token class-name">MyClass</span></code> will be false, and that might mess with <code class="language-js"><span class="token string">"some-api"</span></code>'s assumptions.</p>
<p>Worse still, the <code class="language-js">MyClass<span class="token punctuation">.</span>color</code> method has an out-of-date copy of <code class="language-js">isHovered</code>. <code class="language-js">myInst</code> uses the
definition as it saw it during the first render when it was constructed, and <code class="language-js">isHovered</code> was immutably
set as <code class="language-js"><span class="token boolean">false</span></code>. To fix this in JavaScript, we need a stable, mutable object indirectly referencing <code class="language-js">isHovered</code>.
In React we can get that using a <code class="language-js">ref</code> like so:</p>
<div class="gatsby-highlight" data-language="jsx"><pre class="language-jsx"><code class="language-jsx"><span class="token keyword">import</span> <span class="token punctuation">{</span> ApiClass<span class="token punctuation">,</span> register<span class="token punctuation">,</span> unregister <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"some-api"</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">MyComponent</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">//...</span>
    <span class="token keyword">const</span> componentState <span class="token operator">=</span> <span class="token function">useRef</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    componentState<span class="token punctuation">.</span>current<span class="token punctuation">.</span>isHovered <span class="token operator">=</span> isHovered<span class="token punctuation">;</span> <span class="token comment">// update the state to whatever the lastest is from React</span>
    <span class="token keyword">class</span> <span class="token class-name">MyClass</span> <span class="token keyword">extends</span> <span class="token class-name">ApiClass</span> <span class="token punctuation">{</span>
        x <span class="token operator">=</span> <span class="token number">5</span>
        <span class="token function">color</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> componentState<span class="token punctuation">.</span>isHovered <span class="token operator">?</span> <span class="token string">"red"</span> <span class="token operator">:</span> <span class="token string">"blue"</span> <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token comment">//...</span>
<span class="token punctuation">}</span></code></pre></div>
<p>Now our class will always reference the up-to-date state through an indirect reference that is always up to date.
The final step is to make sure we have a stable reference to the class itself, which is done the same way we get
a stable state object for indirect access of the component state.</p>
<div class="gatsby-highlight" data-language="jsx"><pre class="language-jsx"><code class="language-jsx"><span class="token keyword">import</span> <span class="token punctuation">{</span> ApiClass<span class="token punctuation">,</span> register<span class="token punctuation">,</span> unregister <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"some-api"</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">MyComponent</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">//...</span>
    <span class="token keyword">const</span> MyClass <span class="token operator">=</span> <span class="token function">useRef</span><span class="token punctuation">(</span><span class="token keyword">class</span> <span class="token class-name">MyClass</span> <span class="token keyword">extends</span> <span class="token class-name">ApiClass</span> <span class="token punctuation">{</span>
        x <span class="token operator">=</span> <span class="token number">5</span>
        <span class="token function">color</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> componentState<span class="token punctuation">.</span>isHovered <span class="token operator">?</span> <span class="token string">"red"</span> <span class="token operator">:</span> <span class="token string">"blue"</span> <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span>current<span class="token punctuation">;</span>
    <span class="token comment">//...</span>
<span class="token punctuation">}</span></code></pre></div>
<p><code class="language-js">useRef</code>, will be a stable reference to its argument, and can only be mutated by setting its
<code class="language-js">current</code> property, but we've made that impossible by keeping no reference to the ref object itself.
Now that we have it, we can generalize to create a <code class="language-js">useClass</code> hook that does the work for us.</p>
<div id="the-useclass-hook"></div>
<h2><a href="#the-useclass-hook">The <code class="language-text">useClass</code> Hook</a></h2>
<p>Smaller than I thought it would be, really.</p>
<div class="gatsby-highlight" data-language="tsx"><pre class="language-tsx"><code class="language-tsx"><span class="token keyword">function</span> useClass<span class="token operator">&lt;</span><span class="token constant">C</span> <span class="token keyword">extends</span> <span class="token class-name"><span class="token keyword">new</span></span> <span class="token punctuation">(</span><span class="token parameter"><span class="token operator">...</span>args<span class="token operator">:</span> any<span class="token punctuation">[</span><span class="token punctuation">]</span></span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token builtin">any</span><span class="token punctuation">,</span> <span class="token constant">S</span> <span class="token keyword">extends</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token operator">></span><span class="token punctuation">(</span>
  <span class="token function-variable function">makeClass</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">s<span class="token operator">:</span> <span class="token constant">S</span></span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token constant">C</span><span class="token punctuation">,</span>
  dependencies<span class="token operator">:</span> <span class="token constant">S</span> <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span> <span class="token keyword">as</span> <span class="token constant">S</span>
<span class="token punctuation">)</span><span class="token operator">:</span> <span class="token constant">C</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> stateRef <span class="token operator">=</span> <span class="token function">useRef</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span> <span class="token keyword">as</span> <span class="token constant">S</span><span class="token punctuation">)</span><span class="token punctuation">.</span>current<span class="token punctuation">;</span>
  Object<span class="token punctuation">.</span><span class="token function">assign</span><span class="token punctuation">(</span>stateRef<span class="token punctuation">,</span> dependencies<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token function">useRef</span><span class="token punctuation">(</span><span class="token function">makeClass</span><span class="token punctuation">(</span>stateRef<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>current<span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre></div>
<p>Let's use it:</p>
<div class="gatsby-highlight" data-language="tsx"><pre class="language-tsx"><code class="language-tsx"><span class="token keyword">class</span> <span class="token class-name">Base</span> <span class="token punctuation">{</span>
  <span class="token function">f</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token string">"x"</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">function</span> <span class="token function">App</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>isHovered<span class="token punctuation">,</span> setIsHovered<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">const</span> Derived <span class="token operator">=</span> <span class="token function">useClass</span><span class="token punctuation">(</span>
    <span class="token punctuation">(</span><span class="token parameter">state</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token keyword">class</span> <span class="token class-name">Derived</span> <span class="token keyword">extends</span> <span class="token class-name">Base</span> <span class="token punctuation">{</span>
                 <span class="token function">f</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">f</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">_</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>state<span class="token punctuation">.</span>isHovered <span class="token operator">?</span> <span class="token string">"y"</span> <span class="token operator">:</span> <span class="token string">"n"</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
               <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span> isHovered <span class="token punctuation">}</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">const</span> <span class="token punctuation">[</span>myInst<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Derived</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">></span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span> <span class="token attr-name">onMouseEnter</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">setIsHovered</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">}</span></span>
         <span class="token attr-name">onMouseLeave</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">setIsHovered</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token punctuation">></span></span><span class="token plain-text">
        </span><span class="token punctuation">{</span>myInst<span class="token punctuation">.</span><span class="token function">f</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span><span class="token plain-text">
    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre></div>
<p>And there we have classes as usable as possible directly in our functional components.
Probably not as performant as a module-scope class declaration unless our runtime is extremely clever,
but that's just the world we're living in. If you're heavily using an inheritance based library in your work,
maybe you'll enjoy this as much as I do.</p></div></div></main></div></div><div id="gatsby-announcer" style="position:absolute;top:0;width:1px;height:1px;padding:0;overflow:hidden;clip:rect(0, 0, 0, 0);white-space:nowrap;border:0" aria-live="assertive" aria-atomic="true"></div></div><script id="gatsby-script-loader">/*<![CDATA[*/window.pagePath="/blog/subclass-apis-in-react/";/*]]>*/</script><script id="gatsby-chunk-mapping">/*<![CDATA[*/window.___chunkMapping={"polyfill":["/polyfill-403736c8c59f37ef32f4.js"],"app":["/app-71888d304687d9bcd05d.js"],"component---src-components-blog-page-tsx":["/component---src-components-blog-page-tsx-091ca84cc61c106d77bd.js"],"component---src-pages-3-d-tsx":["/component---src-pages-3-d-tsx-3f35a314367f63c25106.js"],"component---src-pages-404-tsx":["/component---src-pages-404-tsx-d2a0d43b9da466624ab5.js"],"component---src-pages-blog-tsx":["/component---src-pages-blog-tsx-7caafff3392a29dc6a11.js"],"component---src-pages-dialogue-editor-tsx":["/component---src-pages-dialogue-editor-tsx-668e15d4d3b781ac6cf4.js"],"component---src-pages-index-tsx":["/component---src-pages-index-tsx-d10d41910d017b33cb92.js"],"component---src-pages-sentinel-beam-tsx":["/component---src-pages-sentinel-beam-tsx-ae40eecd3d7dfcc85bba.js"],"component---src-pages-work-tsx":["/component---src-pages-work-tsx-ad65b8c259c9281fbb51.js"]};/*]]>*/</script><script src="/polyfill-403736c8c59f37ef32f4.js" nomodule=""></script><script src="/component---src-components-blog-page-tsx-091ca84cc61c106d77bd.js" async=""></script><script src="/922baf5242ed4ba4672941b22c37e341b7a6f945-a49834105405f3830df1.js" async=""></script><script src="/styles-407fe62976dc5310c43e.js" async=""></script><script src="/app-71888d304687d9bcd05d.js" async=""></script><script src="/webpack-runtime-86ff0e5dcd201d98e513.js" async=""></script></body></html>