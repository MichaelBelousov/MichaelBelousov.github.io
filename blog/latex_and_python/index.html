<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="ie=edge"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><style data-href="/styles.80aff200461880aa68c7.css">code[class*=language-],pre[class*=language-]{color:#f8f8f2;background:none;text-shadow:0 1px rgba(0,0,0,.3);font-family:Consolas,Monaco,Andale Mono,Ubuntu Mono,monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-ms-hyphens:none;hyphens:none}pre[class*=language-]{padding:1em;margin:.5em 0;overflow:auto;border-radius:.3em}:not(pre)>code[class*=language-],pre[class*=language-]{background:#272822}:not(pre)>code[class*=language-]{padding:.1em;border-radius:.3em;white-space:normal}.token.cdata,.token.comment,.token.doctype,.token.prolog{color:#8292a2}.token.punctuation{color:#f8f8f2}.token.namespace{opacity:.7}.token.constant,.token.deleted,.token.property,.token.symbol,.token.tag{color:#f92672}.token.boolean,.token.number{color:#ae81ff}.token.attr-name,.token.builtin,.token.char,.token.inserted,.token.selector,.token.string{color:#a6e22e}.language-css .token.string,.style .token.string,.token.entity,.token.operator,.token.url,.token.variable{color:#f8f8f2}.token.atrule,.token.attr-value,.token.class-name,.token.function{color:#e6db74}.token.keyword{color:#66d9ef}.token.important,.token.regex{color:#fd971f}.token.bold,.token.important{font-weight:700}.token.italic{font-style:italic}.token.entity{cursor:help}._3d-module--container--3u9YK{display:flex;flex-wrap:wrap}._3d-module--container--3u9YK img{max-height:200px}.work-module--container--31LKz{overflow:hidden}.work-module--pdf--8cbUT{width:100%}@media only screen and (max-width:700px){.header-module--pageWrapper--1ij_0{padding:12px}}@media only screen and (min-width:700px){.header-module--pageWrapper--1ij_0{padding:22px 1in 1in}}.header-module--separate--G80zA{display:flex;align-items:center;justify-content:space-between}.header-module--separate--G80zA .header-module--left--2-ITV{display:flex;flex-direction:row;flex-wrap:wrap;margin-left:-22px;padding:11px}.header-module--separate--G80zA .header-module--left--2-ITV .header-module--navLink--1IuEZ{margin:11px}.header-module--separate--G80zA .header-module--left--2-ITV .header-module--navLink--1IuEZ,.header-module--separate--G80zA .header-module--left--2-ITV .header-module--navLink--1IuEZ:link,.header-module--separate--G80zA .header-module--left--2-ITV .header-module--navLink--1IuEZ:visited{font-size:2rem;color:rgb(var(--body-rgb));text-decoration:initial;font-style:italic;font-weight:700;transition:font-size .1s ease;height:2.5rem;vertical-align:middle}@media only screen and (max-width:700px){.header-module--separate--G80zA .header-module--left--2-ITV .header-module--navLink--1IuEZ,.header-module--separate--G80zA .header-module--left--2-ITV .header-module--navLink--1IuEZ:link,.header-module--separate--G80zA .header-module--left--2-ITV .header-module--navLink--1IuEZ:visited{font-size:1.5rem}}.header-module--separate--G80zA .header-module--left--2-ITV .header-module--navLink--1IuEZ:hover{color:orange;font-size:2.5em}@media only screen and (max-width:700px){.layout-module--pageWrapper--22gEu{padding:12px}}@media only screen and (min-width:700px){.layout-module--pageWrapper--22gEu{padding:22px 1in 1in}}body,html{margin:0;font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen,Ubuntu,Cantarell,Fira Sans,Droid Sans,Helvetica Neue,sans-serif;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale;background-color:rgb(var(--background-rgb));font-size:14pt;color:rgb(var(--body-rgb))}code{font-family:source-code-pro,Menlo,Monaco,Consolas,Courier New,monospace}a{color:#49a9f9}a:visited{color:#69a9f9}a:active{color:#b9b999}h1{font-size:1.4em;font-weight:700}h1,h3{font-style:italic}h3{font-size:1em;font-weight:400}h1+h3{margin-top:-8px}hr{color:rgba(var(--body-rgb),.3)}.blog-module--container--1pCGB{display:flex;flex-direction:column}@keyframes blog-module--spin--1ZuQ_{0%{transform:scaleX(0)}50%{transform:scaleX(1)}to{transform:scaleX(0)}}.blog-module--loader--27Uha{display:flex;align-items:center;justify-content:center}.blog-module--loader--27Uha .blog-module--inner--3N3oy{border:4px solid rgb(var(--body-rgb));height:26px;width:26px;border-radius:50%;animation-name:blog-module--spin--1ZuQ_;animation-duration:1s;animation-iteration-count:infinite;animation-timing-function:ease-out}@media only screen and (min-width:700px){.blog-module--post--oYMJm{padding:0 1in}.blog-module--post--oYMJm *{max-width:100%}}:root{--background-rgb:18,18,24;--body-rgb:239,239,239}.blog-module--blogLink--1dLLs{margin:11px}.blog-module--blogLink--1dLLs,.blog-module--blogLink--1dLLs:link,.blog-module--blogLink--1dLLs:visited{color:rgb(var(--body-rgb));text-decoration:initial;font-weight:700;vertical-align:middle}.blog-module--blogLink--1dLLs:hover{color:orange}</style><meta name="generator" content="Gatsby 2.21.13"/><title data-react-helmet="true">Empowering LaTeX (PyLaTeXc) | Mike Belousov&#x27;s Website</title><link data-react-helmet="true" rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.10/styles/paraiso-dark.min.css" crossorigin="anonymous"/><meta data-react-helmet="true" name="description" content="See title"/><meta data-react-helmet="true" property="og:title" content="Empowering LaTeX (PyLaTeXc)"/><meta data-react-helmet="true" property="og:description" content="See title"/><meta data-react-helmet="true" property="og:type" content="website"/><meta data-react-helmet="true" name="twitter:card" content="summary"/><meta data-react-helmet="true" name="twitter:creator" content="Mike Belousov"/><meta data-react-helmet="true" name="twitter:title" content="Empowering LaTeX (PyLaTeXc)"/><meta data-react-helmet="true" name="twitter:description" content="See title"/><link rel="icon" href="/favicon-32x32.png?v=bdc2871edacbda8dd5a11f8bfaedcd63"/><link rel="manifest" href="/manifest.webmanifest"/><meta name="theme-color" content="#663399"/><link rel="apple-touch-icon" sizes="48x48" href="/icons/icon-48x48.png?v=bdc2871edacbda8dd5a11f8bfaedcd63"/><link rel="apple-touch-icon" sizes="72x72" href="/icons/icon-72x72.png?v=bdc2871edacbda8dd5a11f8bfaedcd63"/><link rel="apple-touch-icon" sizes="96x96" href="/icons/icon-96x96.png?v=bdc2871edacbda8dd5a11f8bfaedcd63"/><link rel="apple-touch-icon" sizes="144x144" href="/icons/icon-144x144.png?v=bdc2871edacbda8dd5a11f8bfaedcd63"/><link rel="apple-touch-icon" sizes="192x192" href="/icons/icon-192x192.png?v=bdc2871edacbda8dd5a11f8bfaedcd63"/><link rel="apple-touch-icon" sizes="256x256" href="/icons/icon-256x256.png?v=bdc2871edacbda8dd5a11f8bfaedcd63"/><link rel="apple-touch-icon" sizes="384x384" href="/icons/icon-384x384.png?v=bdc2871edacbda8dd5a11f8bfaedcd63"/><link rel="apple-touch-icon" sizes="512x512" href="/icons/icon-512x512.png?v=bdc2871edacbda8dd5a11f8bfaedcd63"/><link as="script" rel="preload" href="/app-9c714177bc12ca497d7d.js"/><link as="script" rel="preload" href="/component---src-components-blog-page-tsx-a0215a27a309230e6da8.js"/><link as="script" rel="preload" href="/commons-25182742ed8c87910e1c.js"/><link as="script" rel="preload" href="/styles-8636a280cbc61d53ad10.js"/><link as="script" rel="preload" href="/framework-da8c6e3ed6a1d0c32925.js"/><link as="script" rel="preload" href="/webpack-runtime-7e975ab65308e2e9b647.js"/><link as="fetch" rel="preload" href="/page-data/blog/latex_and_python/page-data.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/page-data/app-data.json" crossorigin="anonymous"/></head><body><div id="___gatsby"><div style="outline:none" tabindex="-1" id="gatsby-focus-wrapper"><div class="layout-module--pageWrapper--22gEu"><header><div class="header-module--separate--G80zA"><div class="header-module--left--2-ITV"><a class="header-module--navLink--1IuEZ" href="/">Home</a><a class="header-module--navLink--1IuEZ" href="/work">Work</a><a class="header-module--navLink--1IuEZ" href="/3d">3D</a><a class="header-module--navLink--1IuEZ" href="/blog">Blog</a></div><div><h1>Mike Belousov</h1></div></div><hr/></header><main><div class="blog-module--post--oYMJm"><h1>Empowering LaTeX (PyLaTeXc)</h1><h3>May 04, 2019</h3><div><p>The one nagging gap in my homework development stack early on
was an itch for
programmability, that trait which Excel is alleged to have.
But I have a gripe with Excel. It's like Scratch for adults,
A psuedoscripting language for the uninitiated and unlearned.
Personally, I've always kicked up a Python interpreter any
time I needed a calculation, and I quickly began depending on
Python+scipy for more intense derivations and data routines. I scratched
up a utility module for producing LaT<sub>E</sub>X tables and pgfplots graphics
from various data formats, and used it frequently with minimal
copy and paste glue (thank you Cygwin's
<code class="language-latex">/dev/clipboard</code>).</p>
<p>But larger projects begged for more complete tools; like that assignment
involving the visualization
of 26 different samples from a dataset, as well as calculating some
statistical metrics about each sample.
A sane person would have used the charting features
in the Excel spreadsheet it was provided in, but that's outside the scope
of this post.
I exported to csv immediately and made an incredibly primitive
toolkit for embedding Python logic in LaT<sub>E</sub>X. Revisiting it a
couple of months later, I refined my toolkit massively and today I
would consider the design complete, but alternative implementation
approaches merit some exploration.</p>
<p>The first time I attemped glueing my Pythonisms into LaT<sub>E</sub>X,
my design was a tiny mapping from a LaT<sub>E</sub>X grammar extension
to Python formatting key syntax.
If I were to write my LaT<sub>E</sub>X code directly in a Python string,
and attempt to use formatting keys,
I would probably spontaneously combust. It looks like this:</p>
<div class="gatsby-highlight" data-language="latex"><pre class="language-latex"><code class="language-latex">r"""<span class="token function selector">\begin</span><span class="token punctuation">{</span><span class="token keyword">{document</span><span class="token punctuation">}</span><span class="token punctuation">}</span>
<span class="token function selector">\frac</span><span class="token punctuation">{</span><span class="token punctuation">{</span> <span class="token punctuation">{</span>kill<span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">{</span><span class="token punctuation">{</span> <span class="token punctuation">{</span>me<span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">}</span>
<span class="token function selector">\end</span><span class="token punctuation">{</span><span class="token keyword">{document</span><span class="token punctuation">}</span><span class="token punctuation">}</span>""".format(kill=5, me=10)</code></pre></div>
<p>That's almost as crufty as chained ternary expressions in JSX.
Backslash doubling I can avoid by making it a raw string, but that
isn't an option in all use cases.
Regardless, I hid this formatting ugliness behind a script, which
escaped braces for me, and interpretted the characters '&#x3C;&#x3C;' as '{', and
'>>' as '}'. So now I didn't have to brace every 5 characters, and the
keys looked distinct from the LaT<sub>E</sub>X syntax.
My dumb and ugly LaT<sub>E</sub>X superset templater took about 5 lines of
Python code to process, and the source looked like:</p>
<div class="gatsby-highlight" data-language="latex"><pre class="language-latex"><code class="language-latex"><span class="token function selector">\begin</span><span class="token punctuation">{</span><span class="token keyword">document</span><span class="token punctuation">}</span>
<span class="token function selector">\frac</span><span class="token punctuation">{</span>&lt;&lt;numerator>><span class="token punctuation">}</span><span class="token punctuation">{</span>&lt;&lt;denominator>><span class="token punctuation">}</span>
<span class="token function selector">\end</span><span class="token punctuation">{</span><span class="token keyword">document</span><span class="token punctuation">}</span></code></pre></div>
<p>Quite literally, all my template processor had to do was replace all braces with
escaped double braces, and then replace all
double angle brackets with a single formatting brace, thus yielding
the valid Python formatting keys, while allowing raw LaT<sub>E</sub>X to look
at least familiar.
Then you just produce your values and/or data in your Python script,
read this template from some file,
and submit it to Python's formatting functinos with the expected keyword
arguments that you used in the document source
(e.g. &#x3C;<numerator>>).
Here's the naive templating implementation:</p>
<div class="gatsby-highlight" data-language="python"><pre class="language-python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">load_pytex</span><span class="token punctuation">(</span>path<span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span><span class="token punctuation">:</span>
  txt <span class="token operator">=</span> <span class="token builtin">open</span><span class="token punctuation">(</span>path<span class="token punctuation">)</span><span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span>
  txt <span class="token operator">=</span> txt<span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">'{'</span><span class="token punctuation">,</span><span class="token string">'{{'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">'}'</span><span class="token punctuation">,</span><span class="token string">'}}'</span><span class="token punctuation">)</span>    
  txt <span class="token operator">=</span> txt<span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">'&lt;&lt;'</span><span class="token punctuation">,</span> <span class="token string">'{'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">'>>'</span><span class="token punctuation">,</span> <span class="token string">'}'</span><span class="token punctuation">)</span>
  txt<span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span><span class="token operator">**</span>kwargs<span class="token punctuation">)</span>
  <span class="token keyword">return</span> txt  <span class="token comment"># or subproc.check_output(['pdflatex' ...])</span></code></pre></div>
<p>So this works, but it would be quite annoying to have a Python
context so decoupled from the usage context. Calculating things
without regard to the location in the document, and being
unable to change the logic while editing the document without
switching files.
Certainly I could do better? So I did something sinful.</p>
<p>Fake macros in LaT<sub>E</sub>X will make this all look way more T<sub>E</sub>X-savvy.
Let's add a <code class="language-latex"><span class="token function selector">\pyeval</span></code> pseudo-command, and a
<code class="language-text">pyexec</code> pseudo-environment so that we can get something
like so:</p>
<div class="gatsby-highlight" data-language="latex"><pre class="language-latex"><code class="language-latex"><span class="token function selector">\begin</span><span class="token punctuation">{</span><span class="token keyword">pyexec</span><span class="token punctuation">}</span>
name = 'John'
<span class="token function selector">\end</span><span class="token punctuation">{</span><span class="token keyword">pyexec</span><span class="token punctuation">}</span>

Hello I am <span class="token function selector">\pyeval</span><span class="token punctuation">{</span>' '.join(<span class="token punctuation">[</span>name,'Smith'<span class="token punctuation">]</span>)<span class="token punctuation">}</span></code></pre></div>
<p>Originally I implemented (knowing my transgressions) a naive
regular expression based implementation, but this has many problems</p>
<ul>
<li>I want to ignore false ends in quotes and comments</li>
<li>I want to allow counting of nested braces in pyeval</li>
</ul>
<p>expressions so that you don't need to escape all right
braces. (Regular expressions can't find the valid ending
brace of a nested expression)
Checkout the following counter_examples:</p>
<div class="gatsby-highlight" data-language="latex"><pre class="language-latex"><code class="language-latex"><span class="token function selector">\begin</span><span class="token punctuation">{</span><span class="token keyword">pyexec</span><span class="token punctuation">}</span>
hate_you = r'<span class="token function selector">\end</span><span class="token punctuation">{</span><span class="token keyword">pyexec</span><span class="token punctuation">}</span>'  # we need to avoid ending if its in a literal
<span class="token function selector">\end</span><span class="token punctuation">{</span><span class="token keyword">pyexec</span><span class="token punctuation">}</span>

<span class="token function selector">\pyeval</span><span class="token punctuation">{</span>h = <span class="token punctuation">{</span>'hello': 'world', 'x': <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">}</span>  # which brace do we end on?</code></pre></div>
<p>So I couldn't use regular expressions for this, but I still wanted it.
Because my LaT<sub>E</sub>X document source would look like this:</p>
<div class="gatsby-highlight" data-language="latex"><pre class="language-latex"><code class="language-latex"><span class="token function selector">\begin</span><span class="token punctuation">{</span><span class="token keyword">pyexec</span><span class="token punctuation">}</span>
from scipy.optimize import curve_fit
from random import random as rand
from itertools import count, product as crossproduct
bin = crossproduct((0,1),repeat=5)
data = list(zip(count(), bin))
# add a count of set bits as a column
for row in data:
d, b = row
row.append(b.count(1))
randpts = <span class="token punctuation">[</span><span class="token punctuation">[</span>rand(),rand()<span class="token punctuation">]</span> for _ in range(100)<span class="token punctuation">]</span>
<span class="token function selector">\end</span><span class="token punctuation">{</span><span class="token keyword">pyexec</span><span class="token punctuation">}</span>

<span class="token function selector">\section*</span><span class="token punctuation">{</span><span class="token headline class-name">Data Stuff</span><span class="token punctuation">}</span>

<span class="token function selector">\begin</span><span class="token punctuation">{</span><span class="token keyword">tabular</span><span class="token punctuation">}</span><span class="token punctuation">{</span>|c|c|<span class="token punctuation">}</span>
<span class="token function selector">\hline</span>
Decimal <span class="token punctuation">&amp;</span> Binary <span class="token punctuation">&amp;</span> 1-Bits <span class="token function selector">\\</span>
<span class="token function selector">\hline</span>
<span class="token function selector">\pyeval</span><span class="token punctuation">{</span>'<span class="token function selector">\n</span>'.join(('<span class="token punctuation">&amp;</span>'.join(map(str,d)) for d in data))<span class="token punctuation">}</span>
<span class="token comment">% we can extract the above one-liner for reuse in tabular </span>
<span class="token comment">% construction and any horizontally partitioned context</span>
<span class="token function selector">\hline</span>
<span class="token function selector">\end</span><span class="token punctuation">{</span><span class="token keyword">tabular</span><span class="token punctuation">}</span>

<span class="token comment">% use unpack+zip hack to get separate lists of x then y coords</span>
Best Fit: <span class="token function selector">\pyeval</span><span class="token punctuation">{</span>curve_fit(lambda x,m,b: m*x+b, zip(*randpts))<span class="token punctuation">}</span> </code></pre></div>
<p>Mmmmm... delicious. It looks so much like Python yet so much like LaT<sub>E</sub>X.
It's both at once, without crippling either one! It's logic embedded in the document
markup cleanly. So I did go and implement it. Originally I tried using a more
complicated parsing approach, PyParsing, but it turned out to be far too complicated
for what was essentially templating. I ended up settling on parsing by character, due
to the simplicity of the extension. There are a few performance enhancements I could
make but I'm not in the need of them right now, and I've noted them for posterity in
my README. This is PyLaT<sub>E</sub>X, and I put it on my
<a href="https://github.com/MichaelBelousov/pylatexc">GitHub</a></p>
<p>At last, I would argue, that we have a tool more extensible than Excel,
it's got all of PyPI behind it, with numpy, scipy, and all the packages
you could want— embedded in your document.
If you like this approach, maybe you can be just as sinful and throw it into
Markdown, or change up the scripting language to your preference. So long as you
don't use php. Even if it's already a templating language.</p>
<div class="gatsby-highlight" data-language="markdown"><pre class="language-markdown"><code class="language-markdown"><span class="token title important">My Document
<span class="token punctuation">===========</span></span>

<span class="token code"><span class="token punctuation">```</span><span class="token code-language">pyexec</span>
<span class="token code-block language-pyexec">import csv
data = list(csv.reader('mycsv.csv'))</span>
<span class="token punctuation">```</span></span>
<span class="token code keyword">`>>> '\n'.join(data)`</span></code></pre></div>
<p>And as a final note, check out <a href="https://typora.io/">Typora</a>
other cool ways to not use Office products. I don't actually use it, but the LaT<sub>E</sub>X
in Markdown makes me want to. Even if I'm not in school any more.</p>
<style>
span.vim {
    font-size: 3pt;
}
</style></div></div></main></div></div><div id="gatsby-announcer" style="position:absolute;top:0;width:1px;height:1px;padding:0;overflow:hidden;clip:rect(0, 0, 0, 0);white-space:nowrap;border:0" aria-live="assertive" aria-atomic="true"></div></div><script id="gatsby-script-loader">/*<![CDATA[*/window.pagePath="/blog/latex_and_python/";/*]]>*/</script><script id="gatsby-chunk-mapping">/*<![CDATA[*/window.___chunkMapping={"app":["/app-9c714177bc12ca497d7d.js"],"component---src-components-blog-page-tsx":["/component---src-components-blog-page-tsx-a0215a27a309230e6da8.js"],"component---src-pages-3-d-tsx":["/component---src-pages-3-d-tsx-2e718283dbc8bc73f3f7.js"],"component---src-pages-404-tsx":["/component---src-pages-404-tsx-581c2129730b4589495d.js"],"component---src-pages-blog-tsx":["/component---src-pages-blog-tsx-93486d463c9297091d6d.js"],"component---src-pages-index-tsx":["/component---src-pages-index-tsx-cd461490bc8b791c6a80.js"],"component---src-pages-work-tsx":["/component---src-pages-work-tsx-c6afbfcff1a7253e790b.js"]};/*]]>*/</script><script src="/webpack-runtime-7e975ab65308e2e9b647.js" async=""></script><script src="/framework-da8c6e3ed6a1d0c32925.js" async=""></script><script src="/styles-8636a280cbc61d53ad10.js" async=""></script><script src="/commons-25182742ed8c87910e1c.js" async=""></script><script src="/component---src-components-blog-page-tsx-a0215a27a309230e6da8.js" async=""></script><script src="/app-9c714177bc12ca497d7d.js" async=""></script></body></html>