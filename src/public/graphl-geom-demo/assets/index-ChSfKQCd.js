(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const f of document.querySelectorAll('link[rel="modulepreload"]'))a(f);new MutationObserver(f=>{for(const i of f)if(i.type==="childList")for(const r of i.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&a(r)}).observe(document,{childList:!0,subtree:!0});function n(f){const i={};return f.integrity&&(i.integrity=f.integrity),f.referrerPolicy&&(i.referrerPolicy=f.referrerPolicy),f.crossOrigin==="use-credentials"?i.credentials="include":f.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function a(f){if(f.ep)return;f.ep=!0;const i=n(f);fetch(f.href,i)}})();const Pe="/graphl-geom-demo/assets/dvui-frontend-UDO6YMAK-DF7ap5iq.wasm";var he=0,ge=1,b=0,m=8,G=20,Y=28,pe=31,Oe=37,B=44,Me=52,F=54,_e=55,v=58,te=63,me=76,re=64,ye=class ne{static read_bytes(e,n){const a=new ne;return a.buf=e.getUint32(n,!0),a.buf_len=e.getUint32(n+4,!0),a}static read_bytes_array(e,n,a){const f=[];for(let i=0;i<a;i++)f.push(ne.read_bytes(e,n+8*i));return f}},be=class ie{static read_bytes(e,n){const a=new ie;return a.buf=e.getUint32(n,!0),a.buf_len=e.getUint32(n+4,!0),a}static read_bytes_array(e,n,a){const f=[];for(let i=0;i<a;i++)f.push(ie.read_bytes(e,n+8*i));return f}},ze=0,je=1,Se=2,we=2,A=3,J=4,Z=class{head_length(){return 24}name_length(){return this.dir_name.byteLength}write_head_bytes(t,e){t.setBigUint64(e,this.d_next,!0),t.setBigUint64(e+8,this.d_ino,!0),t.setUint32(e+16,this.dir_name.length,!0),t.setUint8(e+20,this.d_type)}write_name_bytes(t,e,n){t.set(this.dir_name.slice(0,Math.min(this.dir_name.byteLength,n)),e)}constructor(t,e,n,a){const f=new TextEncoder().encode(n);this.d_next=t,this.d_ino=e,this.d_namlen=f.byteLength,this.d_type=a,this.dir_name=f}},Ve=1,ue=class{write_bytes(t,e){t.setUint8(e,this.fs_filetype),t.setUint16(e+2,this.fs_flags,!0),t.setBigUint64(e+8,this.fs_rights_base,!0),t.setBigUint64(e+16,this.fs_rights_inherited,!0)}constructor(t,e){this.fs_rights_base=0n,this.fs_rights_inherited=0n,this.fs_filetype=t,this.fs_flags=e}},ee=1,z=2,xe=4,ve=8,ce=class{write_bytes(t,e){t.setBigUint64(e,this.dev,!0),t.setBigUint64(e+8,this.ino,!0),t.setUint8(e+16,this.filetype),t.setBigUint64(e+24,this.nlink,!0),t.setBigUint64(e+32,this.size,!0),t.setBigUint64(e+38,this.atim,!0),t.setBigUint64(e+46,this.mtim,!0),t.setBigUint64(e+52,this.ctim,!0)}constructor(t,e,n){this.dev=0n,this.nlink=0n,this.atim=0n,this.mtim=0n,this.ctim=0n,this.ino=t,this.filetype=e,this.size=n}},$e=0,He=class{write_bytes(t,e){t.setUint32(e,this.pr_name.byteLength,!0)}constructor(t){this.pr_name=new TextEncoder().encode(t)}},Xe=class Ce{static dir(e){const n=new Ce;return n.tag=$e,n.inner=new He(e),n}write_bytes(e,n){e.setUint32(n,this.tag,!0),this.inner.write_bytes(e,n+4)}},We=class{enable(e){this.log=Ge(e===void 0?!0:e,this.prefix)}get enabled(){return this.isEnabled}constructor(e){this.isEnabled=e,this.prefix="wasi:",this.enable(e)}};function Ge(t,e){return t?console.log.bind(console,"%c%s","color: #265BA0",e):()=>{}}var T=new We(!1),Ee=class extends Error{constructor(t){super("exit with exit code "+t),this.code=t}},Ye=class{start(e){this.inst=e;try{return e.exports._start(),0}catch(n){if(n instanceof Ee)return n.code;throw n}}initialize(e){this.inst=e,e.exports._initialize&&e.exports._initialize()}constructor(e,n,a,f={}){this.args=[],this.env=[],this.fds=[],T.enable(f.debug),this.args=e,this.env=n,this.fds=a;const i=this;this.wasiImport={args_sizes_get(r,s){const o=new DataView(i.inst.exports.memory.buffer);o.setUint32(r,i.args.length,!0);let l=0;for(const c of i.args)l+=c.length+1;return o.setUint32(s,l,!0),T.log(o.getUint32(r,!0),o.getUint32(s,!0)),0},args_get(r,s){const o=new DataView(i.inst.exports.memory.buffer),l=new Uint8Array(i.inst.exports.memory.buffer),c=s;for(let d=0;d<i.args.length;d++){o.setUint32(r,s,!0),r+=4;const u=new TextEncoder().encode(i.args[d]);l.set(u,s),o.setUint8(s+u.length,0),s+=u.length+1}return T.enabled&&T.log(new TextDecoder("utf-8").decode(l.slice(c,s))),0},environ_sizes_get(r,s){const o=new DataView(i.inst.exports.memory.buffer);o.setUint32(r,i.env.length,!0);let l=0;for(const c of i.env)l+=c.length+1;return o.setUint32(s,l,!0),T.log(o.getUint32(r,!0),o.getUint32(s,!0)),0},environ_get(r,s){const o=new DataView(i.inst.exports.memory.buffer),l=new Uint8Array(i.inst.exports.memory.buffer),c=s;for(let d=0;d<i.env.length;d++){o.setUint32(r,s,!0),r+=4;const u=new TextEncoder().encode(i.env[d]);l.set(u,s),o.setUint8(s+u.length,0),s+=u.length+1}return T.enabled&&T.log(new TextDecoder("utf-8").decode(l.slice(c,s))),0},clock_res_get(r,s){let o;switch(r){case ge:{o=5000n;break}case he:{o=1000000n;break}default:return Me}return new DataView(i.inst.exports.memory.buffer).setBigUint64(s,o,!0),b},clock_time_get(r,s,o){const l=new DataView(i.inst.exports.memory.buffer);if(r===he)l.setBigUint64(o,BigInt(new Date().getTime())*1000000n,!0);else if(r==ge){let c;try{c=BigInt(Math.round(performance.now()*1e6))}catch{c=0n}l.setBigUint64(o,c,!0)}else l.setBigUint64(o,0n,!0);return 0},fd_advise(r,s,o,l){return i.fds[r]!=null?b:m},fd_allocate(r,s,o){return i.fds[r]!=null?i.fds[r].fd_allocate(s,o):m},fd_close(r){if(i.fds[r]!=null){const s=i.fds[r].fd_close();return i.fds[r]=void 0,s}else return m},fd_datasync(r){return i.fds[r]!=null?i.fds[r].fd_sync():m},fd_fdstat_get(r,s){if(i.fds[r]!=null){const{ret:o,fdstat:l}=i.fds[r].fd_fdstat_get();return l?.write_bytes(new DataView(i.inst.exports.memory.buffer),s),o}else return m},fd_fdstat_set_flags(r,s){return i.fds[r]!=null?i.fds[r].fd_fdstat_set_flags(s):m},fd_fdstat_set_rights(r,s,o){return i.fds[r]!=null?i.fds[r].fd_fdstat_set_rights(s,o):m},fd_filestat_get(r,s){if(i.fds[r]!=null){const{ret:o,filestat:l}=i.fds[r].fd_filestat_get();return l?.write_bytes(new DataView(i.inst.exports.memory.buffer),s),o}else return m},fd_filestat_set_size(r,s){return i.fds[r]!=null?i.fds[r].fd_filestat_set_size(s):m},fd_filestat_set_times(r,s,o,l){return i.fds[r]!=null?i.fds[r].fd_filestat_set_times(s,o,l):m},fd_pread(r,s,o,l,c){const d=new DataView(i.inst.exports.memory.buffer),u=new Uint8Array(i.inst.exports.memory.buffer);if(i.fds[r]!=null){const h=ye.read_bytes_array(d,s,o);let p=0;for(const g of h){const{ret:_,data:y}=i.fds[r].fd_pread(g.buf_len,l);if(_!=b)return d.setUint32(c,p,!0),_;if(u.set(y,g.buf),p+=y.length,l+=BigInt(y.length),y.length!=g.buf_len)break}return d.setUint32(c,p,!0),b}else return m},fd_prestat_get(r,s){const o=new DataView(i.inst.exports.memory.buffer);if(i.fds[r]!=null){const{ret:l,prestat:c}=i.fds[r].fd_prestat_get();return c?.write_bytes(o,s),l}else return m},fd_prestat_dir_name(r,s,o){if(i.fds[r]!=null){const{ret:l,prestat:c}=i.fds[r].fd_prestat_get();if(c==null)return l;const d=c.inner.pr_name;return new Uint8Array(i.inst.exports.memory.buffer).set(d.slice(0,o),s),d.byteLength>o?Oe:b}else return m},fd_pwrite(r,s,o,l,c){const d=new DataView(i.inst.exports.memory.buffer),u=new Uint8Array(i.inst.exports.memory.buffer);if(i.fds[r]!=null){const h=be.read_bytes_array(d,s,o);let p=0;for(const g of h){const _=u.slice(g.buf,g.buf+g.buf_len),{ret:y,nwritten:E}=i.fds[r].fd_pwrite(_,l);if(y!=b)return d.setUint32(c,p,!0),y;if(p+=E,l+=BigInt(E),E!=_.byteLength)break}return d.setUint32(c,p,!0),b}else return m},fd_read(r,s,o,l){const c=new DataView(i.inst.exports.memory.buffer),d=new Uint8Array(i.inst.exports.memory.buffer);if(i.fds[r]!=null){const u=ye.read_bytes_array(c,s,o);let h=0;for(const p of u){const{ret:g,data:_}=i.fds[r].fd_read(p.buf_len);if(g!=b)return c.setUint32(l,h,!0),g;if(d.set(_,p.buf),h+=_.length,_.length!=p.buf_len)break}return c.setUint32(l,h,!0),b}else return m},fd_readdir(r,s,o,l,c){const d=new DataView(i.inst.exports.memory.buffer),u=new Uint8Array(i.inst.exports.memory.buffer);if(i.fds[r]!=null){let h=0;for(;;){const{ret:p,dirent:g}=i.fds[r].fd_readdir_single(l);if(p!=0)return d.setUint32(c,h,!0),p;if(g==null)break;if(o-h<g.head_length()){h=o;break}const _=new ArrayBuffer(g.head_length());if(g.write_head_bytes(new DataView(_),0),u.set(new Uint8Array(_).slice(0,Math.min(_.byteLength,o-h)),s),s+=g.head_length(),h+=g.head_length(),o-h<g.name_length()){h=o;break}g.write_name_bytes(u,s,o-h),s+=g.name_length(),h+=g.name_length(),l=g.d_next}return d.setUint32(c,h,!0),0}else return m},fd_renumber(r,s){if(i.fds[r]!=null&&i.fds[s]!=null){const o=i.fds[s].fd_close();return o!=0?o:(i.fds[s]=i.fds[r],i.fds[r]=void 0,0)}else return m},fd_seek(r,s,o,l){const c=new DataView(i.inst.exports.memory.buffer);if(i.fds[r]!=null){const{ret:d,offset:u}=i.fds[r].fd_seek(s,o);return c.setBigInt64(l,u,!0),d}else return m},fd_sync(r){return i.fds[r]!=null?i.fds[r].fd_sync():m},fd_tell(r,s){const o=new DataView(i.inst.exports.memory.buffer);if(i.fds[r]!=null){const{ret:l,offset:c}=i.fds[r].fd_tell();return o.setBigUint64(s,c,!0),l}else return m},fd_write(r,s,o,l){const c=new DataView(i.inst.exports.memory.buffer),d=new Uint8Array(i.inst.exports.memory.buffer);if(i.fds[r]!=null){const u=be.read_bytes_array(c,s,o);let h=0;for(const p of u){const g=d.slice(p.buf,p.buf+p.buf_len),{ret:_,nwritten:y}=i.fds[r].fd_write(g);if(_!=b)return c.setUint32(l,h,!0),_;if(h+=y,y!=g.byteLength)break}return c.setUint32(l,h,!0),b}else return m},path_create_directory(r,s,o){const l=new Uint8Array(i.inst.exports.memory.buffer);if(i.fds[r]!=null){const c=new TextDecoder("utf-8").decode(l.slice(s,s+o));return i.fds[r].path_create_directory(c)}else return m},path_filestat_get(r,s,o,l,c){const d=new DataView(i.inst.exports.memory.buffer),u=new Uint8Array(i.inst.exports.memory.buffer);if(i.fds[r]!=null){const h=new TextDecoder("utf-8").decode(u.slice(o,o+l)),{ret:p,filestat:g}=i.fds[r].path_filestat_get(s,h);return g?.write_bytes(d,c),p}else return m},path_filestat_set_times(r,s,o,l,c,d,u){const h=new Uint8Array(i.inst.exports.memory.buffer);if(i.fds[r]!=null){const p=new TextDecoder("utf-8").decode(h.slice(o,o+l));return i.fds[r].path_filestat_set_times(s,p,c,d,u)}else return m},path_link(r,s,o,l,c,d,u){const h=new Uint8Array(i.inst.exports.memory.buffer);if(i.fds[r]!=null&&i.fds[c]!=null){const p=new TextDecoder("utf-8").decode(h.slice(o,o+l)),g=new TextDecoder("utf-8").decode(h.slice(d,d+u)),{ret:_,inode_obj:y}=i.fds[r].path_lookup(p,s);return y==null?_:i.fds[c].path_link(g,y,!1)}else return m},path_open(r,s,o,l,c,d,u,h,p){const g=new DataView(i.inst.exports.memory.buffer),_=new Uint8Array(i.inst.exports.memory.buffer);if(i.fds[r]!=null){const y=new TextDecoder("utf-8").decode(_.slice(o,o+l));T.log(y);const{ret:E,fd_obj:I}=i.fds[r].path_open(s,y,c,d,u,h);if(E!=0)return E;i.fds.push(I);const L=i.fds.length-1;return g.setUint32(p,L,!0),0}else return m},path_readlink(r,s,o,l,c,d){const u=new DataView(i.inst.exports.memory.buffer),h=new Uint8Array(i.inst.exports.memory.buffer);if(i.fds[r]!=null){const p=new TextDecoder("utf-8").decode(h.slice(s,s+o));T.log(p);const{ret:g,data:_}=i.fds[r].path_readlink(p);if(_!=null){const y=new TextEncoder().encode(_);if(y.length>c)return u.setUint32(d,0,!0),m;h.set(y,l),u.setUint32(d,y.length,!0)}return g}else return m},path_remove_directory(r,s,o){const l=new Uint8Array(i.inst.exports.memory.buffer);if(i.fds[r]!=null){const c=new TextDecoder("utf-8").decode(l.slice(s,s+o));return i.fds[r].path_remove_directory(c)}else return m},path_rename(r,s,o,l,c,d){const u=new Uint8Array(i.inst.exports.memory.buffer);if(i.fds[r]!=null&&i.fds[l]!=null){const h=new TextDecoder("utf-8").decode(u.slice(s,s+o)),p=new TextDecoder("utf-8").decode(u.slice(c,c+d));let{ret:g,inode_obj:_}=i.fds[r].path_unlink(h);if(_==null)return g;if(g=i.fds[l].path_link(p,_,!0),g!=b&&i.fds[r].path_link(h,_,!0)!=b)throw"path_link should always return success when relinking an inode back to the original place";return g}else return m},path_symlink(r,s,o,l,c){const d=new Uint8Array(i.inst.exports.memory.buffer);return i.fds[o]!=null?(new TextDecoder("utf-8").decode(d.slice(r,r+s)),new TextDecoder("utf-8").decode(d.slice(l,l+c)),v):m},path_unlink_file(r,s,o){const l=new Uint8Array(i.inst.exports.memory.buffer);if(i.fds[r]!=null){const c=new TextDecoder("utf-8").decode(l.slice(s,s+o));return i.fds[r].path_unlink_file(c)}else return m},poll_oneoff(r,s,o){throw"async io not supported"},proc_exit(r){throw new Ee(r)},proc_raise(r){throw"raised signal "+r},sched_yield(){},random_get(r,s){const o=new Uint8Array(i.inst.exports.memory.buffer).subarray(r,r+s);if("crypto"in globalThis&&(typeof SharedArrayBuffer>"u"||!(i.inst.exports.memory.buffer instanceof SharedArrayBuffer)))for(let l=0;l<s;l+=65536)crypto.getRandomValues(o.subarray(l,l+65536));else for(let l=0;l<s;l++)o[l]=Math.random()*256|0},sock_recv(r,s,o){throw"sockets not supported"},sock_send(r,s,o){throw"sockets not supported"},sock_shutdown(r,s){throw"sockets not supported"},sock_accept(r,s){throw"sockets not supported"}}}},de=class{fd_allocate(t,e){return v}fd_close(){return 0}fd_fdstat_get(){return{ret:v,fdstat:null}}fd_fdstat_set_flags(t){return v}fd_fdstat_set_rights(t,e){return v}fd_filestat_get(){return{ret:v,filestat:null}}fd_filestat_set_size(t){return v}fd_filestat_set_times(t,e,n){return v}fd_pread(t,e){return{ret:v,data:new Uint8Array}}fd_prestat_get(){return{ret:v,prestat:null}}fd_pwrite(t,e){return{ret:v,nwritten:0}}fd_read(t){return{ret:v,data:new Uint8Array}}fd_readdir_single(t){return{ret:v,dirent:null}}fd_seek(t,e){return{ret:v,offset:0n}}fd_sync(){return 0}fd_tell(){return{ret:v,offset:0n}}fd_write(t){return{ret:v,nwritten:0}}path_create_directory(t){return v}path_filestat_get(t,e){return{ret:v,filestat:null}}path_filestat_set_times(t,e,n,a,f){return v}path_link(t,e,n){return v}path_unlink(t){return{ret:v,inode_obj:null}}path_lookup(t,e){return{ret:v,inode_obj:null}}path_open(t,e,n,a,f,i){return{ret:F,fd_obj:null}}path_readlink(t){return{ret:v,data:null}}path_remove_directory(t){return v}path_rename(t,e,n){return v}path_unlink_file(t){return v}},H=class se{static issue_ino(){return se.next_ino++}static root_ino(){return 0n}constructor(){this.ino=se.issue_ino()}};H.next_ino=1n;var Ie=class extends de{fd_allocate(t,e){if(!(this.file.size>t+e)){const n=new Uint8Array(Number(t+e));n.set(this.file.data,0),this.file.data=n}return b}fd_fdstat_get(){return{ret:0,fdstat:new ue(J,0)}}fd_filestat_set_size(t){if(this.file.size>t)this.file.data=new Uint8Array(this.file.data.buffer.slice(0,Number(t)));else{const e=new Uint8Array(Number(t));e.set(this.file.data,0),this.file.data=e}return b}fd_read(t){const e=this.file.data.slice(Number(this.file_pos),Number(this.file_pos+BigInt(t)));return this.file_pos+=BigInt(e.length),{ret:0,data:e}}fd_pread(t,e){return{ret:0,data:this.file.data.slice(Number(e),Number(e+BigInt(t)))}}fd_seek(t,e){let n;switch(e){case ze:n=t;break;case je:n=this.file_pos+t;break;case Se:n=BigInt(this.file.data.byteLength)+t;break;default:return{ret:Y,offset:0n}}return n<0?{ret:Y,offset:0n}:(this.file_pos=n,{ret:0,offset:this.file_pos})}fd_tell(){return{ret:0,offset:this.file_pos}}fd_write(t){if(this.file.readonly)return{ret:m,nwritten:0};if(this.file_pos+BigInt(t.byteLength)>this.file.size){const e=this.file.data;this.file.data=new Uint8Array(Number(this.file_pos+BigInt(t.byteLength))),this.file.data.set(e)}return this.file.data.set(t,Number(this.file_pos)),this.file_pos+=BigInt(t.byteLength),{ret:0,nwritten:t.byteLength}}fd_pwrite(t,e){if(this.file.readonly)return{ret:m,nwritten:0};if(e+BigInt(t.byteLength)>this.file.size){const n=this.file.data;this.file.data=new Uint8Array(Number(e+BigInt(t.byteLength))),this.file.data.set(n)}return this.file.data.set(t,Number(e)),{ret:0,nwritten:t.byteLength}}fd_filestat_get(){return{ret:0,filestat:this.file.stat()}}constructor(t){super(),this.file_pos=0n,this.file=t}},Le=class extends de{fd_seek(t,e){return{ret:m,offset:0n}}fd_tell(){return{ret:m,offset:0n}}fd_allocate(t,e){return m}fd_fdstat_get(){return{ret:0,fdstat:new ue(A,0)}}fd_readdir_single(t){if(T.enabled&&(T.log("readdir_single",t),T.log(t,this.dir.contents.keys())),t==0n)return{ret:b,dirent:new Z(1n,this.dir.ino,".",A)};if(t==1n)return{ret:b,dirent:new Z(2n,this.dir.parent_ino(),"..",A)};if(t>=BigInt(this.dir.contents.size)+2n)return{ret:0,dirent:null};const[e,n]=Array.from(this.dir.contents.entries())[Number(t-2n)];return{ret:0,dirent:new Z(t+1n,n.ino,e,n.stat().filetype)}}path_filestat_get(t,e){const{ret:n,path:a}=D.from(e);if(a==null)return{ret:n,filestat:null};const{ret:f,entry:i}=this.dir.get_entry_for_path(a);return i==null?{ret:f,filestat:null}:{ret:0,filestat:i.stat()}}path_lookup(t,e){const{ret:n,path:a}=D.from(t);if(a==null)return{ret:n,inode_obj:null};const{ret:f,entry:i}=this.dir.get_entry_for_path(a);return i==null?{ret:f,inode_obj:null}:{ret:b,inode_obj:i}}path_open(t,e,n,a,f,i){const{ret:r,path:s}=D.from(e);if(s==null)return{ret:r,fd_obj:null};let{ret:o,entry:l}=this.dir.get_entry_for_path(s);if(l==null){if(o!=B)return{ret:o,fd_obj:null};if((n&ee)==ee){const{ret:c,entry:d}=this.dir.create_entry_for_path(e,(n&z)==z);if(d==null)return{ret:c,fd_obj:null};l=d}else return{ret:B,fd_obj:null}}else if((n&xe)==xe)return{ret:G,fd_obj:null};return(n&z)==z&&l.stat().filetype!==A?{ret:F,fd_obj:null}:l.path_open(n,a,i)}path_create_directory(t){return this.path_open(0,t,ee|z,0n,0n,0).ret}path_link(t,e,n){const{ret:a,path:f}=D.from(t);if(f==null)return a;if(f.is_dir)return B;const{ret:i,parent_entry:r,filename:s,entry:o}=this.dir.get_parent_dir_and_entry_for_path(f,!0);if(r==null||s==null)return i;if(o!=null){const l=e.stat().filetype==A,c=o.stat().filetype==A;if(l&&c)if(n&&o instanceof oe){if(o.contents.size!=0)return _e}else return G;else{if(l&&!c)return F;if(!l&&c)return pe;if(!(e.stat().filetype==J&&o.stat().filetype==J))return G}}return!n&&e.stat().filetype==A?te:(r.contents.set(s,e),b)}path_unlink(t){const{ret:e,path:n}=D.from(t);if(n==null)return{ret:e,inode_obj:null};const{ret:a,parent_entry:f,filename:i,entry:r}=this.dir.get_parent_dir_and_entry_for_path(n,!0);return f==null||i==null?{ret:a,inode_obj:null}:r==null?{ret:B,inode_obj:null}:(f.contents.delete(i),{ret:b,inode_obj:r})}path_unlink_file(t){const{ret:e,path:n}=D.from(t);if(n==null)return e;const{ret:a,parent_entry:f,filename:i,entry:r}=this.dir.get_parent_dir_and_entry_for_path(n,!1);return f==null||i==null||r==null?a:r.stat().filetype===A?pe:(f.contents.delete(i),b)}path_remove_directory(t){const{ret:e,path:n}=D.from(t);if(n==null)return e;const{ret:a,parent_entry:f,filename:i,entry:r}=this.dir.get_parent_dir_and_entry_for_path(n,!1);return f==null||i==null||r==null?a:!(r instanceof oe)||r.stat().filetype!==A?F:r.contents.size!==0?_e:f.contents.delete(i)?b:B}fd_filestat_get(){return{ret:0,filestat:this.dir.stat()}}fd_filestat_set_size(t){return m}fd_read(t){return{ret:m,data:new Uint8Array}}fd_pread(t,e){return{ret:m,data:new Uint8Array}}fd_write(t){return{ret:m,nwritten:0}}fd_pwrite(t,e){return{ret:m,nwritten:0}}constructor(t){super(),this.dir=t}},Je=class extends Le{fd_prestat_get(){return{ret:0,prestat:Xe.dir(this.prestat_name)}}constructor(t,e){super(new oe(e)),this.prestat_name=t}},De=class extends H{path_open(t,e,n){if(this.readonly&&(e&BigInt(re))==BigInt(re))return{ret:te,fd_obj:null};if((t&ve)==ve){if(this.readonly)return{ret:te,fd_obj:null};this.data=new Uint8Array([])}const a=new Ie(this);return n&Ve&&a.fd_seek(0n,Se),{ret:b,fd_obj:a}}get size(){return BigInt(this.data.byteLength)}stat(){return new ce(this.ino,J,this.size)}constructor(t,e){super(),this.data=new Uint8Array(t),this.readonly=!!e?.readonly}},D=class Fe{static from(e){const n=new Fe;if(n.is_dir=e.endsWith("/"),e.startsWith("/"))return{ret:me,path:null};if(e.includes("\0"))return{ret:Y,path:null};for(const a of e.split("/"))if(!(a===""||a===".")){if(a===".."){if(n.parts.pop()==null)return{ret:me,path:null};continue}n.parts.push(a)}return{ret:b,path:n}}to_path_string(){let e=this.parts.join("/");return this.is_dir&&(e+="/"),e}constructor(){this.parts=[],this.is_dir=!1}},oe=class j extends H{parent_ino(){return this.parent==null?H.root_ino():this.parent.ino}path_open(e,n,a){return{ret:b,fd_obj:new Le(this)}}stat(){return new ce(this.ino,A,0n)}get_entry_for_path(e){let n=this;for(const a of e.parts){if(!(n instanceof j))return{ret:F,entry:null};const f=n.contents.get(a);if(f!==void 0)n=f;else return T.log(a),{ret:B,entry:null}}return e.is_dir&&n.stat().filetype!=A?{ret:F,entry:null}:{ret:b,entry:n}}get_parent_dir_and_entry_for_path(e,n){const a=e.parts.pop();if(a===void 0)return{ret:Y,parent_entry:null,filename:null,entry:null};const{ret:f,entry:i}=this.get_entry_for_path(e);if(i==null)return{ret:f,parent_entry:null,filename:null,entry:null};if(!(i instanceof j))return{ret:F,parent_entry:null,filename:null,entry:null};const r=i.contents.get(a);return r===void 0?n?{ret:b,parent_entry:i,filename:a,entry:null}:{ret:B,parent_entry:null,filename:null,entry:null}:e.is_dir&&r.stat().filetype!=A?{ret:F,parent_entry:null,filename:null,entry:null}:{ret:b,parent_entry:i,filename:a,entry:r}}create_entry_for_path(e,n){const{ret:a,path:f}=D.from(e);if(f==null)return{ret:a,entry:null};let{ret:i,parent_entry:r,filename:s,entry:o}=this.get_parent_dir_and_entry_for_path(f,!0);if(r==null||s==null)return{ret:i,entry:null};if(o!=null)return{ret:G,entry:null};T.log("create",f);let l;return n?l=new j(new Map):l=new De(new ArrayBuffer(0)),r.contents.set(s,l),o=l,{ret:b,entry:o}}constructor(e){super(),this.parent=null,e instanceof Array?this.contents=new Map(e):this.contents=e;for(const n of this.contents.values())n instanceof j&&(n.parent=this)}},Te=class Be extends de{fd_filestat_get(){return{ret:0,filestat:new ce(this.ino,we,BigInt(0))}}fd_fdstat_get(){const e=new ue(we,0);return e.fs_rights_base=BigInt(re),{ret:0,fdstat:e}}fd_write(e){return this.write(e),{ret:0,nwritten:e.byteLength}}static lineBuffered(e){const n=new TextDecoder("utf-8",{fatal:!1});let a="";return new Be(f=>{a+=n.decode(f,{stream:!0});const i=a.split(`
`);for(const[r,s]of i.entries())r<i.length-1?e(s):a=s})}constructor(e){super(),this.ino=H.issue_ino(),this.write=e}},Ke=t=>{const e=new Blob([t]);return URL.createObjectURL(e)},qe={"text/csv":"csv","application/zip":"zip"},Re=async t=>{const e=document.createElement("a");e.style.display="none";let n;e.href=Ke(t.content),t.fileName&&(e.download=t.fileName),t.appendGuessedFileExtension&&n&&(e.download=`${e.download}.${qe[n]||"txt"}`),document.body.append(e),e.click(),e.remove()},Qe=async(t={})=>await new Promise((n,a)=>{const f=document.createElement("div");f.style.display="none",f.innerHTML=`<input type="file" id="temp-upload" accept="${t.extensions?.join(",")??""}" />`;const i=f.children[0];i.onchange=function(){try{if(i.files===null)throw Error("No files in input");const r=i.files.item(0);if(r===null)throw Error("First file in input was null");const s=r,o=new FileReader;o.onloadend=function(l){l.target?.readyState===FileReader.DONE&&n({name:r.name,content:l.target.result})},t.type==="text"?o.readAsText(s,"utf8"):o.readAsDataURL(s)}catch(r){a(r)}},i.click()}),w;(function(t){t.void_={name:"void",kind:"primitive",size:0},t.i32={name:"i32",kind:"primitive",size:4},t.u32={name:"u32",kind:"primitive",size:4},t.i64={name:"i64",kind:"primitive",size:8},t.u64={name:"u64",kind:"primitive",size:8},t.bool={name:"bool",kind:"primitive",size:4},t.f32={name:"f32",kind:"primitive",size:4},t.f64={name:"f64",kind:"primitive",size:8},t.string={name:"string",kind:"primitive",size:4},t.code={name:"string",kind:"primitive",size:0},t.rgba={name:"rgba",kind:"primitive",size:4},t.extern={name:"extern",kind:"primitive",size:4},t.vec3={name:"vec3",kind:"struct",size:24,fieldNames:["x","y","z"],fieldTypes:[t.f64,t.f64,t.f64],fieldOffsets:[0,8,16]}})(w||(w={}));function R(t,e){if(!t)throw Error(e??"assertion condition was false")}function ae(t,e){if(e.length===0)return w.void_;if(e.length===1)return e[0];let n=0;const a=[];for(const f of e)a.push(n),n+=f.size;return{name:t,kind:"struct",fieldNames:e.map((f,i)=>String(i)),fieldTypes:e,fieldOffsets:a,size:n}}function ke(t,e){return typeof t.type=="string"?e.types[t.type]:t.type}function V(t,e){return typeof t.type=="string"?e.types[t.type]:t.type}function Ze(t,e,n){if(e===w.string){R(typeof t=="string");const a=new TextEncoder().encode(t);let f=0;const i=n.exports.__graphl_create_array_string(a.byteLength);for(;f<a.byteLength;){const r=a.slice(f,f+N);Ne(n).set(r),n.exports.__graphl_read_array(i,f,r.byteLength),f+=N}return i}else return e===w.bool?t?1:0:t}function et(t,e,n){if(le in t)return t[le];const a=[],f=[];function i(s,o,l){R(o.kind==="struct");const c=new DataView(n.exports.memory.buffer,X,N);for(let d=0;d<o.fieldNames.length;++d){const u=o.fieldNames[d],h=o.fieldTypes[d],p=l+o.fieldOffsets[d],g=s[u];if(h===w.f32)R(typeof g=="number",`received non-number value '${JSON.stringify(g)}' for field '${u}' of struct ${h.name}`),c.setFloat32(p,g,!0);else if(h===w.f64)R(typeof g=="number",`received non-number value '${JSON.stringify(g)}' for field '${u}' of struct ${h.name}`),c.setFloat64(p,g,!0);else if(h===w.i32||h===w.rgba)R(typeof g=="number"&&g>=-2147483648&&g<=2**31-1&&Math.round(g)===g,`received value '${JSON.stringify(g)}' that was not a 32-bit signed integer for field '${u}' of struct ${h.name}`),c.setInt32(p,g,!0);else if(h===w.i64)R(typeof g=="number"&&g>=Number.MIN_SAFE_INTEGER&&g<=Number.MAX_SAFE_INTEGER&&Math.round(g)===g||typeof g=="bigint"&&g>=-9223372036854775808n&&g<=9223372036854775807n,`received value '${JSON.stringify(g)}' that was not a 64-bit signed integer for field '${u}' of struct ${h.name}`),c.setBigInt64(p,BigInt(g),!0);else if(h===w.u32)R(typeof g=="bigint"&&g>=0&&g<=2**32-1,`received value '${JSON.stringify(g)}' that was not a 32-bit unsigned number value for field '${u}' of struct ${h.name}`),c.setBigInt64(p,g,!0);else if(h===w.u64)R(typeof g=="number"&&g>=0&&g<=Number.MAX_SAFE_INTEGER&&Math.round(g)===g||typeof g=="bigint"&&g>=0&&g<=0xffffffffffffffffn,`received value '${JSON.stringify(g)}' that was not a 64-bit unsigned integer for field '${u}' of struct ${h.name}`),c.setBigUint64(p,BigInt(g),!0);else if(h===w.bool)R(typeof g=="boolean",`received value '${JSON.stringify(g)}' that was not a boolean value for field '${u}' of struct ${h.name}`),c.setInt32(p,g?1:0,!0);else if(h===w.string)R(typeof g=="string",`received non-string value '${JSON.stringify(g)}' for field '${u}' of struct ${h.name}`),f.push({fullData:new TextEncoder().encode(g)});else if(h===w.extern)a.push(g);else if(h.kind==="struct")i(g,h,p);else throw Error(`unhandled field type: ${h.name}`)}}i(t,e,0);const r=n.exports[`__graphl_read_struct_${e.name}_fields`]();{let s=0;for(const{fullData:o}of f){let l=0;for(;l<o.byteLength;)Ne(n).set(o.slice(l)),n.exports[`__graphl_read_struct_${e.name}_array`](r,s,l,Math.min(N,o.byteLength-l)),l+=N;s+=1}}for(let s=0;s<a.length;++s)n.exports[`__graphl_set_struct_${e.name}_extern`](r,s,a[s]);return r}function tt(t,e,n){if(e===w.string){const a=new TextDecoder;let f=0;const i=[];for(;;){const o=n.exports.__graphl_write_array(t,f);if(o===0)break;f+=o;const l=new Uint8Array(n.exports.memory.buffer,X,o);i.push(l)}const r=f,s=new Uint8Array(r);{let o=0;for(const l of i)s.set(l,o),o+=l.byteLength}return a.decode(s)}else return e===w.bool?!!t:t}var le=Symbol.for("graphl-native-val");function rt(t,e,n){n.exports[`__graphl_write_struct_${e.name}_fields`](t);const a=[],f=[],i={};Object.defineProperty(i,le,{value:t,enumerable:!1,writable:!1,configurable:!1});function r(s,o,l={}){R(s.kind==="struct");const c=new DataView(n.exports.memory.buffer,X,N);for(let d=0;d<s.fieldNames.length;++d){const u=s.fieldTypes[d],h=s.fieldNames[d],p=s.fieldOffsets[d];if(u===w.f32)l[h]=c.getFloat32(p,!0);else if(u===w.f64)l[h]=c.getFloat64(p,!0);else if(u===w.i32||u===w.rgba)l[h]=c.getInt32(p,!0);else if(u===w.i64)l[h]=c.getBigInt64(p,!0);else if(u===w.u32)l[h]=c.getUint32(p,!0);else if(u===w.u64)l[h]=c.getBigUint64(p,!0);else if(u===w.bool)l[h]=!!c.getInt32(p,!0);else if(u===w.string)a.push({obj:l,fieldName:h});else if(u===w.extern)f.push({obj:l,fieldName:h});else if(u.kind==="struct")l[h]={},r(u);else throw Error(`unhandled field type: ${u.name}`)}return l}r(e,0,i);{let s=0;for(const o of a){const l=[];let c=0;for(;;){const u=n.exports[`__graphl_write_struct_${e.name}_array`](t,s,c),h=new Uint8Array(n.exports.memory.buffer,X,u);if(l.push(h),h.byteLength===0)break;c+=u}const d=new Uint8Array(c);{let u=0;for(const h of l)d.set(h,u),u+=h.byteLength}o.obj[o.fieldName]=new TextDecoder().decode(d),s+=1}}for(let s=0;s<f.length;++s){const o=f[s];o.obj[o.fieldName]=n.exports[`__graphl_get_struct_${e.name}_extern`](t,s)}return i}function K(t,e,n){if(e.kind==="primitive")return Ze(t,e,n);if(e.kind==="struct")return et(t,e,n);throw Error("unhandled")}function $(t,e,n){if(e.kind==="primitive")return tt(t,e,n);if(e.kind==="struct")return rt(t,e,n);throw Error("unhandled")}var X=3072,N=4096,Ne=t=>new Uint8Array(t.exports.memory.buffer,X,N);function nt(t,e,n,a){const f=[t.async?"callUserFuncAsync":"callUserFunc",...t.inputs?.map(i=>typeof i.type=="string"?i.type:i.type.name)??[],"R",...t.outputs?.map(i=>typeof i.type=="string"?i.type:i.type.name)??[]].join("_");return[f,(i,...r)=>{const s=n.get(i);R(s,`No user function with id ${i}, this is a bug`);const o=r.map((c,d)=>$(c,ke(t.inputs[d],a),e)),l=ae(f,t.outputs?.map(c=>V(c,a))??[]);if(t.async){const c=new Int32Array(e.exports.memory.buffer),d=1024;s.paused?(e.exports.asyncify_stop_rewind(),s.paused=!1):(c[d>>2]=d+8,c[d+4>>2]=d+2048,e.exports.asyncify_start_unwind(d),a.unwindCount+=1,s.paused=!0,s.impl.call(void 0,...o).then(h=>{const p=K(h,l,e);e.exports[`ASYNC_RET_${i}`].value=p,e.exports.asyncify_start_rewind(d),R(a.currentEntry!==void 0);const g=a.unwindCount,_=e.exports[a.currentEntry]();a.unwindCount===g&&a.finishCurrentExec(_)}))}else{const c=s.impl.call(void 0,...o);return K(c,l,e)}}]}function it(t,e){let n=0;for(let a=0;a<t.byteLength;++a)if(t.getUint8(a)===e.getUint8(n)?n+=1:n=0,n>=e.byteLength)return a-e.byteLength;return-1}function st(t){const e=new DataView(t),n=it(e,new DataView(new TextEncoder().encode('{"token":"63a7f259-5c6b-4206-8927-8102dc9ad34d').buffer))+1;R(n!==-1,"graphl meta token not found");let a=1;for(let f=n+1;f<t.byteLength;++f)if(String.fromCharCode(e.getUint8(f))==="{"||String.fromCharCode(e.getUint8(f))==="["?a+=1:(String.fromCharCode(e.getUint8(f))==="}"||String.fromCharCode(e.getUint8(f))==="]")&&(a-=1),a===0){const i=t.slice(n,f+1),r=new TextDecoder().decode(i),s=JSON.parse(r);return delete s.token,s}throw Error("couldn't find end of graphl meta")}var fe;(function(t){function e(){return{types:{...w},currentEntry:void 0,unwindCount:0,finishCurrentExec:void 0}}t.init=e})(fe||(fe={}));async function ot(t,e={}){const n={exports:void 0},a=st(t),f=new Map(a.host.functions.map(d=>[d.name,d.id])),i={},r=new Map,s=fe.init(),o=new Map;for(const d of a.structs){const u={name:d.name,kind:"struct",size:0,fieldNames:d.field_names,fieldTypes:d.field_types.map(p=>s.types[p]),fieldOffsets:[]};let h=0;for(const p of d.field_types)u.fieldOffsets.push(h),h+=s.types[p].size;u.size=h,s.types[d.name]=u}for(const[d,u]of Object.entries(e??{})){const h=f.get(d);if(h===void 0)continue;r.set(h,{impl:u.impl??(()=>{}),paused:!1}),f.delete(d);const[p,g]=nt(u,n,r,s);p in i||(i[p]=g)}if(f.size>0){const d=Error(`Unspecified host functions: ${[...f]}`);throw d.unspecifiedFunctionNames=[...f],d}for(const d of a.functions)o.set(d.name,{name:d.name,inputs:d.inputs.map(u=>({type:s.types[u]})),outputs:d.outputs.map(u=>({type:s.types[u]}))});const l={env:{...i,__graphl_host_log_msg(...d){const u=[];for(let h=0;h<d.length;h+=2){d[h];const p=d[h+1];u.push(K(p,w.i32,n))}console.log(...u)}}},c=await WebAssembly.instantiate(t,l);return n.exports=c.instance.exports,{functions:Object.fromEntries(Object.entries(c.instance.exports).filter(([,d])=>typeof d=="function").map(([d,u])=>[d,(...h)=>{const p=o.get(d),g=h.map((_,y)=>K(_,ke(p.inputs[y],s),n));if("asyncify_stop_unwind"in c.instance.exports)return new Promise((_,y)=>{try{let E;const I=s.unwindCount;s.finishCurrentExec=M=>{c.instance.exports.asyncify_stop_unwind(),_(M)},s.currentEntry=d,E=u.apply(null,g);let L;if(p.outputs.length===0)L=void 0;else if(p.outputs.length===1)L=$(E,V(p.outputs[0],s),n);else{const M=ae(d,p.outputs.map(q=>V(q,s)));L=$(E,M,n)}if(!(s.unwindCount===I))return;s.finishCurrentExec(L)}catch(E){y(E)}});{let _;const y=u.apply(null,g);if(p.outputs.length===0)_=void 0;else if(p.outputs.length===1)_=$(y,V(p.outputs[0],s),n);else{const E=ae(d,p.outputs.map(I=>V(I,s)));_=$(y,E,n)}return _}}])),_wasmInstance:c.instance}}async function at(t){await new Promise(e=>setTimeout(e,t))}async function lt(t){let n=await(await fetch(t)).blob();return new Uint8Array(await n.arrayBuffer())}async function ft(t,e){return new Promise((n,a)=>{const f=document.createElement("input");f.setAttribute("type","file"),f.setAttribute("accept",t),e&&f.toggleAttribute("multiple",!0),f.oncancel=()=>{console.trace("File picking cancelled"),a("canceled")},f.onchange=()=>{if(f.files.length===0&&(console.error("File picker picked no files"),f.oncancel()),!e&&f.files.length>1){console.error("Picked multiple files in single file picker"),a("Too many files");return}n(f.files)},f.click()})}var ut=`
    precision mediump float;

    attribute vec4 aVertexPosition;
    attribute vec4 aVertexColor;
    attribute vec2 aTextureCoord;

    uniform mat4 uMatrix;

    varying vec4 vColor;
    varying vec2 vTextureCoord;

    void main() {
      gl_Position = uMatrix * aVertexPosition;
      vColor = aVertexColor / 255.0;  // normalize u8 colors to 0-1
      vTextureCoord = aTextureCoord;
    }
`,ct=`# version 300 es

    precision mediump float;

    in vec4 aVertexPosition;
    in vec4 aVertexColor;
    in vec2 aTextureCoord;

    uniform mat4 uMatrix;

    out vec4 vColor;
    out vec2 vTextureCoord;

    void main() {
      gl_Position = uMatrix * aVertexPosition;
      vColor = aVertexColor / 255.0;  // normalize u8 colors to 0-1
      vTextureCoord = aTextureCoord;
    }
`,dt=`
    precision mediump float;

    varying vec4 vColor;
    varying vec2 vTextureCoord;

    uniform sampler2D uSampler;
    uniform bool useTex;

    void main() {
        if (useTex) {
            gl_FragColor = texture2D(uSampler, vTextureCoord) * vColor;
        }
        else {
            gl_FragColor = vColor;
        }
    }
`,ht=`# version 300 es

    precision mediump float;

    in vec4 vColor;
    in vec2 vTextureCoord;

    uniform sampler2D uSampler;
    uniform bool useTex;

    out vec4 fragColor;

    void main() {
        if (useTex) {
            fragColor = texture(uSampler, vTextureCoord) * vColor;
        }
        else {
            fragColor = vColor;
        }
    }
`,C=new TextDecoder,k=new TextEncoder,gt=class{gl;indexBuffer;vertexBuffer;shaderProgram;programInfo;textures=new Map;newTextureId=1;using_fb=!1;frame_buffer=null;renderTargetSize=[0,0];instance;stopped=!1;log_string="";hidden_input;touches=[];textInputRect=[];filesCacheModified=!1;filesCache=new Map;get webgl2(){return this.gl instanceof WebGL2RenderingContext}oskCheck(){this.textInputRect.length==0?this.gl.canvas.focus():(this.hidden_input.style.left=window.scrollX+this.gl.canvas.getBoundingClientRect().left+this.textInputRect[0]+"px",this.hidden_input.style.top=window.scrollY+this.gl.canvas.getBoundingClientRect().top+this.textInputRect[1]+"px",this.hidden_input.style.width=this.textInputRect[2]+"px",this.hidden_input.style.height=this.textInputRect[3]+"px",this.hidden_input.focus())}touchIndex(t){let e=this.touches.findIndex(n=>n[0]===t);return e<0&&(e=this.touches.length,this.touches.push([t,e])),e}constructor(){this.hidden_input=document.createElement("input"),this.hidden_input.style.position="absolute",this.hidden_input.style.left=0,this.hidden_input.style.top=0,this.hidden_input.style.opacity=0,this.hidden_input.style.zIndex=-1,document.body.prepend(this.hidden_input),this.imports={wasm_about_webgl2:()=>this.webgl2?1:0,wasm_panic:(t,e)=>{this.stopped=!0;let n=C.decode(new Uint8Array(this.instance.exports.memory.buffer,t,e));console.error("PANIC:",n),alert(n)},wasm_log_write:(t,e)=>{this.log_string+=C.decode(new Uint8Array(this.instance.exports.memory.buffer,t,e))},wasm_log_flush:()=>{console.log(this.log_string),this.log_string=""},wasm_now:()=>performance.now(),wasm_sleep:t=>{at(t)},wasm_pixel_width:()=>this.gl.drawingBufferWidth,wasm_pixel_height:()=>this.gl.drawingBufferHeight,wasm_frame_buffer:()=>this.using_fb?1:0,wasm_canvas_width:()=>this.gl.canvas.clientWidth,wasm_canvas_height:()=>this.gl.canvas.clientHeight,wasm_textureCreate:(t,e,n,a)=>{const f=new Uint8Array(this.instance.exports.memory.buffer,t,e*n*4),i=this.gl.createTexture(),r=this.newTextureId;return this.newTextureId+=1,this.textures.set(r,[i,e,n]),this.gl.bindTexture(this.gl.TEXTURE_2D,i),this.gl.texImage2D(this.gl.TEXTURE_2D,0,this.gl.RGBA,e,n,0,this.gl.RGBA,this.gl.UNSIGNED_BYTE,f),this.webgl2&&this.gl.generateMipmap(this.gl.TEXTURE_2D),a==0?(this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MIN_FILTER,this.gl.NEAREST),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MAG_FILTER,this.gl.NEAREST)):(this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MIN_FILTER,this.gl.LINEAR),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MAG_FILTER,this.gl.LINEAR)),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_S,this.gl.CLAMP_TO_EDGE),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_T,this.gl.CLAMP_TO_EDGE),this.gl.bindTexture(this.gl.TEXTURE_2D,null),r},wasm_textureCreateTarget:(t,e,n)=>{const a=this.gl.createTexture(),f=this.newTextureId;return this.newTextureId+=1,this.textures.set(f,[a,t,e]),this.gl.bindTexture(this.gl.TEXTURE_2D,a),this.gl.texImage2D(this.gl.TEXTURE_2D,0,this.gl.RGBA,t,e,0,this.gl.RGBA,this.gl.UNSIGNED_BYTE,null),n==0?(this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MIN_FILTER,this.gl.NEAREST),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MAG_FILTER,this.gl.NEAREST)):(this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MIN_FILTER,this.gl.LINEAR),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MAG_FILTER,this.gl.LINEAR)),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_S,this.gl.CLAMP_TO_EDGE),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_T,this.gl.CLAMP_TO_EDGE),this.gl.bindTexture(this.gl.TEXTURE_2D,null),f},wasm_textureRead:(t,e,n,a)=>{const f=this.textures.get(t)[0];this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,this.frame_buffer),this.gl.framebufferTexture2D(this.gl.FRAMEBUFFER,this.gl.COLOR_ATTACHMENT0,this.gl.TEXTURE_2D,f,0);var i=new Uint8Array(this.instance.exports.memory.buffer,e,n*a*4);this.gl.readPixels(0,0,n,a,this.gl.RGBA,this.gl.UNSIGNED_BYTE,i,0),this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,null)},wasm_renderTarget:t=>{t===0?(this.using_fb=!1,this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,null),this.renderTargetSize=[this.gl.drawingBufferWidth,this.gl.drawingBufferHeight],this.gl.viewport(0,0,this.renderTargetSize[0],this.renderTargetSize[1]),this.gl.scissor(0,0,this.renderTargetSize[0],this.renderTargetSize[1])):(this.using_fb=!0,this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,this.frame_buffer),this.gl.framebufferTexture2D(this.gl.FRAMEBUFFER,this.gl.COLOR_ATTACHMENT0,this.gl.TEXTURE_2D,this.textures.get(t)[0],0),this.renderTargetSize=[this.textures.get(t)[1],this.textures.get(t)[2]],this.gl.viewport(0,0,this.renderTargetSize[0],this.renderTargetSize[1]),this.gl.scissor(0,0,this.renderTargetSize[0],this.renderTargetSize[1]))},wasm_textureDestroy:t=>{const e=this.textures.get(t)[0];this.textures.delete(t),this.gl.deleteTexture(e)},wasm_renderGeometry:(t,e,n,a,f,i,r,s,o,l,c,d,u,h)=>{l===1&&this.gl.scissor(c,d,u,h),this.gl.bindBuffer(this.gl.ELEMENT_ARRAY_BUFFER,this.indexBuffer);const p=new Uint16Array(this.instance.exports.memory.buffer,e,n/2);this.gl.bufferData(this.gl.ELEMENT_ARRAY_BUFFER,p,this.gl.STATIC_DRAW),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.vertexBuffer);const g=new Uint8Array(this.instance.exports.memory.buffer,a,f);this.gl.bufferData(this.gl.ARRAY_BUFFER,g,this.gl.STATIC_DRAW);let _=new Float32Array(16);_[0]=2/this.renderTargetSize[0],_[1]=0,_[2]=0,_[3]=0,_[4]=0,this.using_fb?_[5]=2/this.renderTargetSize[1]:_[5]=-2/this.renderTargetSize[1],_[6]=0,_[7]=0,_[8]=0,_[9]=0,_[10]=1,_[11]=0,_[12]=-1,this.using_fb?_[13]=-1:_[13]=1,_[14]=0,_[15]=1,this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.vertexBuffer),this.gl.vertexAttribPointer(this.programInfo.attribLocations.vertexPosition,2,this.gl.FLOAT,!1,i,r),this.gl.enableVertexAttribArray(this.programInfo.attribLocations.vertexPosition),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.vertexBuffer),this.gl.vertexAttribPointer(this.programInfo.attribLocations.vertexColor,4,this.gl.UNSIGNED_BYTE,!1,i,s),this.gl.enableVertexAttribArray(this.programInfo.attribLocations.vertexColor),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.vertexBuffer),this.gl.vertexAttribPointer(this.programInfo.attribLocations.textureCoord,2,this.gl.FLOAT,!1,i,o),this.gl.enableVertexAttribArray(this.programInfo.attribLocations.textureCoord),this.gl.useProgram(this.shaderProgram),this.gl.uniformMatrix4fv(this.programInfo.uniformLocations.matrix,!1,_),t!=0?(this.gl.activeTexture(this.gl.TEXTURE0),this.gl.bindTexture(this.gl.TEXTURE_2D,this.textures.get(t)[0]),this.gl.uniform1i(this.programInfo.uniformLocations.useTex,1)):(this.gl.bindTexture(this.gl.TEXTURE_2D,null),this.gl.uniform1i(this.programInfo.uniformLocations.useTex,0)),this.gl.uniform1i(this.programInfo.uniformLocations.uSampler,0),this.gl.drawElements(this.gl.TRIANGLES,p.length,this.gl.UNSIGNED_SHORT,0),l===1&&this.gl.scissor(0,0,this.renderTargetSize[0],this.renderTargetSize[1])},wasm_cursor:(t,e)=>{let n=C.decode(new Uint8Array(this.instance.exports.memory.buffer,t,e));this.gl.canvas.style.cursor=n},wasm_text_input:(t,e,n,a)=>{n>0&&a>0?this.textInputRect=[t,e,n,a]:this.textInputRect=[]},wasm_open_url:(t,e)=>{let n=C.decode(new Uint8Array(this.instance.exports.memory.buffer,t,e));window.open(n)},wasm_download_data:(t,e,n,a)=>{const f=C.decode(new Uint8Array(this.instance.exports.memory.buffer,t,e)),i=new Uint8Array(this.instance.exports.memory.buffer,n,a),r=new Blob([i],{type:"octet/stream"}),s=URL.createObjectURL(r),o=document.createElement("a");o.href=s,o.download=f,document.body.appendChild(o),o.click(),document.body.removeChild(o),URL.revokeObjectURL(s)},wasm_open_file_picker:(t,e,n,a)=>{let f=C.decode(new Uint8Array(this.instance.exports.memory.buffer,e,n));ft(f,a).then(i=>{let r=[],s=[];for(let o=0;o<i.length;o++){const l=i.item(o);r.push(l),s.push(l.arrayBuffer())}Promise.all(s).then(o=>{this.filesCacheModified=!0,this.filesCache.set(t,{files:r,data:o})})}).catch(()=>console.debug("Filepicker canceled: This is currently not detectable from within dvui"))},wasm_get_file_size:(t,e)=>{const n=this.filesCache.get(t);return!n||n.files.length<=e?void 0:n.files[e].size},wasm_get_file_name:(t,e)=>{const n=this.filesCache.get(t);if(!n||n.files.length<=e)return;const a=k.encode(n.files[e].name),f=this.instance.exports.arena_u8(a.length+1);var i=new Uint8Array(this.instance.exports.memory.buffer,f,a.length+1);return i.set(a),i.set([0],a.length),f},wasm_read_file_data:(t,e,n)=>{const a=this.filesCache.get(t);if(!(!a||a.files.length<=e)){var f=new Uint8Array(this.instance.exports.memory.buffer,n);f.set(new Uint8Array(a.data[e]))}},wasm_get_number_of_files_available:t=>{const e=this.filesCache.get(t);return e?e.files.length:0},wasm_clipboardTextSet:(t,e)=>{if(e==0)return;let n=C.decode(new Uint8Array(this.instance.exports.memory.buffer,t,e));navigator.clipboard?navigator.clipboard.writeText(n):(this.hidden_input.value=n,this.hidden_input.focus(),this.hidden_input.select(),document.execCommand("copy"),this.hidden_input.value="",this.oskCheck())},wasm_add_noto_font:()=>{lt("NotoSansKR-Regular.ttf").then(t=>{const e=this.instance.exports.gpa_u8(t.length);var n=new Uint8Array(this.instance.exports.memory.buffer,e,t.length);n.set(t),this.instance.exports.new_font(e,t.length)})}}}setInstance(t){this.instance=t}setCanvas(t){const e=t instanceof HTMLCanvasElement?t:document.querySelector(t);if(!e){alert("Could not find canvas element.");return}if(e.style.userSelect="none",e.style["user-drag"]="none",this.gl=e.getContext("webgl2",{alpha:!0}),this.gl===null&&(this.gl=e.getContext("webgl",{alpha:!0})),this.gl===null){alert("Unable to initialize WebGL.");return}if(!this.webgl2&&this.gl.getExtension("OES_element_index_uint")===null){alert("WebGL doesn't support OES_element_index_uint.");return}this.frame_buffer=this.gl.createFramebuffer();const n=this.gl.createShader(this.gl.VERTEX_SHADER);if(this.webgl2?this.gl.shaderSource(n,ct):this.gl.shaderSource(n,ut),this.gl.compileShader(n),!this.gl.getShaderParameter(n,this.gl.COMPILE_STATUS))return alert(`Error compiling vertex shader: ${this.gl.getShaderInfoLog(n)}`),this.gl.deleteShader(n),null;const a=this.gl.createShader(this.gl.FRAGMENT_SHADER);if(this.webgl2?this.gl.shaderSource(a,ht):this.gl.shaderSource(a,dt),this.gl.compileShader(a),!this.gl.getShaderParameter(a,this.gl.COMPILE_STATUS))return alert(`Error compiling fragment shader: ${this.gl.getShaderInfoLog(a)}`),this.gl.deleteShader(a),null;if(this.shaderProgram=this.gl.createProgram(),this.gl.attachShader(this.shaderProgram,n),this.gl.attachShader(this.shaderProgram,a),this.gl.linkProgram(this.shaderProgram),!this.gl.getProgramParameter(this.shaderProgram,this.gl.LINK_STATUS))return alert(`Error initializing shader program: ${this.gl.getProgramInfoLog(this.shaderProgram)}`),null;this.programInfo={attribLocations:{vertexPosition:this.gl.getAttribLocation(this.shaderProgram,"aVertexPosition"),vertexColor:this.gl.getAttribLocation(this.shaderProgram,"aVertexColor"),textureCoord:this.gl.getAttribLocation(this.shaderProgram,"aTextureCoord")},uniformLocations:{matrix:this.gl.getUniformLocation(this.shaderProgram,"uMatrix"),uSampler:this.gl.getUniformLocation(this.shaderProgram,"uSampler"),useTex:this.gl.getUniformLocation(this.shaderProgram,"useTex")}},this.indexBuffer=this.gl.createBuffer(),this.vertexBuffer=this.gl.createBuffer(),this.gl.enable(this.gl.BLEND),this.gl.blendFunc(this.gl.ONE,this.gl.ONE_MINUS_SRC_ALPHA),this.gl.enable(this.gl.SCISSOR_TEST),this.gl.scissor(0,0,this.gl.canvas.clientWidth,this.gl.canvas.clientHeight)}init(){let t=0,e=k.encode(navigator.platform);if(e.length>0){const a=this.instance.exports.gpa_u8(e.length);var n=new Uint8Array(this.instance.exports.memory.buffer,a,e.length);n.set(e),t=this.instance.exports.dvui_init(a,e.length),this.instance.exports.gpa_free(a,e.length)}else t=this.instance.exports.dvui_init(0,0);if(t!=0)throw new Error("ERROR: dvui_init returned "+t)}run(){if(!this.instance)throw new Error("Missing wasm instance, did you forget to call `setInstance`?");if(!this.gl)throw new Error("Missing rendering context, did you forget to call `setCanvas`?");this.init();let t=!1,e=0;const n=()=>{if(this.stopped)return;t=!1;const r=this.gl.canvas.clientWidth,s=this.gl.canvas.clientHeight;if(r===0||s===0)return;const o=window.devicePixelRatio;this.gl.canvas.width=Math.round(r*o),this.gl.canvas.height=Math.round(s*o),this.renderTargetSize=[this.gl.drawingBufferWidth,this.gl.drawingBufferHeight],this.gl.viewport(0,0,this.gl.drawingBufferWidth,this.gl.drawingBufferHeight),this.gl.scissor(0,0,this.gl.drawingBufferWidth,this.gl.drawingBufferHeight),this.gl.clearColor(0,0,0,1),this.gl.clear(this.gl.COLOR_BUFFER_BIT);let l=this.instance.exports.dvui_update();this.filesCacheModified||this.filesCache.clear(),this.filesCacheModified=!1,l<0?this.stopped=!0:l==0?a():l>0&&(e=setTimeout(function(){e=0,a()},l))};function a(){e>0&&(clearTimeout(e),e=0),t||(t=!0,requestAnimationFrame(n))}this.gl.canvas.addEventListener("contextmenu",r=>{r.preventDefault()}),this.gl.canvas instanceof HTMLCanvasElement&&new ResizeObserver(()=>{a()}).observe(this.gl.canvas),window.addEventListener("resize",r=>{a()}),this.gl.canvas.addEventListener("mousemove",r=>{let s=this.gl.canvas.getBoundingClientRect(),o=(r.clientX-s.left)/(s.right-s.left)*this.gl.canvas.clientWidth,l=(r.clientY-s.top)/(s.bottom-s.top)*this.gl.canvas.clientHeight;this.instance.exports.add_event(1,0,0,o,l),a()}),this.gl.canvas.addEventListener("mousedown",r=>{this.instance.exports.add_event(2,r.button,0,0,0),a()}),this.gl.canvas.addEventListener("mouseup",r=>{this.instance.exports.add_event(3,r.button,0,0,0),a(),this.oskCheck()}),this.gl.canvas.addEventListener("wheel",r=>{r.preventDefault(),r.deltaX!=0&&this.instance.exports.add_event(4,0,0,-r.deltaX,0),r.deltaY!=0&&this.instance.exports.add_event(4,1,0,r.deltaY,0),a()});let f=r=>{r.key=="Tab"&&r.preventDefault();let s=k.encode(r.key);if(s.length>0){const l=this.instance.exports.arena_u8(s.length);var o=new Uint8Array(this.instance.exports.memory.buffer,l,s.length);o.set(s),this.instance.exports.add_event(5,l,s.length,r.repeat,(r.metaKey<<3)+(r.altKey<<2)+(r.ctrlKey<<1)+(r.shiftKey<<0)),a()}};this.gl.canvas.addEventListener("keydown",f),this.hidden_input.addEventListener("keydown",f);let i=r=>{const s=k.encode(r.key),o=this.instance.exports.arena_u8(s.length);var l=new Uint8Array(this.instance.exports.memory.buffer,o,s.length);l.set(s),this.instance.exports.add_event(6,o,s.length,0,(r.metaKey<<3)+(r.altKey<<2)+(r.ctrlKey<<1)+(r.shiftKey<<0)),a()};this.gl.canvas.addEventListener("keyup",i),this.hidden_input.addEventListener("keyup",i),this.hidden_input.addEventListener("beforeinput",r=>{if(r.preventDefault(),r.data){const o=k.encode(r.data),l=this.instance.exports.arena_u8(o.length);var s=new Uint8Array(this.instance.exports.memory.buffer,l,o.length);s.set(o),this.instance.exports.add_event(7,l,o.length,0,0),a()}}),this.gl.canvas.addEventListener("touchstart",r=>{r.preventDefault();let s=this.gl.canvas.getBoundingClientRect();for(let o=0;o<r.changedTouches.length;o++){let l=r.changedTouches[o],c=(l.clientX-s.left)/(s.right-s.left),d=(l.clientY-s.top)/(s.bottom-s.top),u=this.touchIndex(l.identifier);this.instance.exports.add_event(8,this.touches[u][1],0,c,d)}a()}),this.gl.canvas.addEventListener("touchend",r=>{r.preventDefault();let s=this.gl.canvas.getBoundingClientRect();for(let o=0;o<r.changedTouches.length;o++){let l=r.changedTouches[o],c=(l.clientX-s.left)/(s.right-s.left),d=(l.clientY-s.top)/(s.bottom-s.top),u=this.touchIndex(l.identifier);this.instance.exports.add_event(9,this.touches[u][1],0,c,d),this.touches.splice(u,1)}a(),this.oskCheck()}),this.gl.canvas.addEventListener("touchmove",r=>{r.preventDefault();let s=this.gl.canvas.getBoundingClientRect();for(let o=0;o<r.changedTouches.length;o++){let l=r.changedTouches[o],c=(l.clientX-s.left)/(s.right-s.left),d=(l.clientY-s.top)/(s.bottom-s.top),u=this.touchIndex(l.identifier);this.instance.exports.add_event(10,this.touches[u][1],0,c,d)}a()}),a()}};function Ue(t,e="Assertion failed"){if(!t)throw Error(e)}var Ae=16384;async function pt(t,e){for(const[u,h]of Object.entries(e.graphs??{}))h.name=u;const n=new Map,a=new Map;let f=[new Ie(new De([])),Te.lineBuffered(u=>console.log(`[WASI stdout] ${u}`)),Te.lineBuffered(u=>console.warn(`[WASI stderr] ${u}`)),new Je(".",new Map)],i=new Ye(["bin","arg1"],["FOO=bar"],f);const r=new gt;let s;const o=()=>{const u=new Promise(h=>{Ue(s===void 0),s=p=>{u.reached=!0,s=void 0,h(p)}});return u.cleanup=()=>s=void 0,u.reached=!1,u},l={wasi_snapshot_preview1:i.wasiImport,dvui:r.imports,env:{breakpoint(){debugger},main(){},onExportCurrentSource:(u,h)=>{if(h===0)return;const p=C.decode(new Uint8Array(c.instance.exports.memory.buffer,u,h));console.log("compiled:"),console.log(p),globalThis._monacoSyncHook?.(p),Re({fileName:"project.scm",content:p})},onRequestLoadSource(){},onReceiveSlice(u,h){const p=new Uint8Array(c.instance.exports.memory.buffer,u,h),g=new ArrayBuffer(p.byteLength),_=new Uint8Array(g);_.set(p),s?.(_)},onClickReportIssue(){window.open("https://github.com/MichaelBelousov/graphl/issues/new","_blank")},on_menu_click:u=>{a.get(u)?.()}}};let c;const d={async exportGraphlt(){const u=o();try{if(c.instance.exports.compileToGraphlt(),!u.reached)throw u.cleanup(),Error("failed?");const h=await u;return C.decode(h)}finally{u.cleanup()}},async exportWasm(){const u=o();try{if(c.instance.exports.compileToWasm(),!u.reached)throw u.cleanup(),Error("failed?");return await u}finally{u.cleanup()}},async exportGraphJson(){const u=o();try{c.instance.exports.getGraphsJson();const h=await u;return C.decode(h)}finally{u.cleanup()}},async compile(){const u=await this.exportWasm();return ot(u.buffer,e.userFuncs)},_dvui:r};return WebAssembly.instantiateStreaming(fetch(Pe),l).then(u=>{c=u;const h=u.instance.exports;i.initialize(u.instance),r.setInstance(u.instance),r.setCanvas(t);let p=0;function g(x){if(x!==void 0)for(const U of x){const S=p;p++,a.set(S,U.onClick),U.on_click_handle=S,g(U.submenus)}}const _=[{name:"File",submenus:[{name:"Open",async onClick(){const x=await Qe({type:"text",extensions:[".gr.json"]}),U=x.content.length,S=c.instance.exports.transfer_buffer,W=()=>new Uint8Array(c.instance.exports.memory.buffer,S,U);{const Q=k.encodeInto(x.content,W());Ue(Q.written===U,"failed to write file to transfer buffer")}return c.instance.exports.onReceiveLoadedSource(S,U)}},{name:"Save",async onClick(){let x;try{const U=o();c.instance.exports.getGraphsJson(),x=await U}finally{s=void 0}Re({content:x,fileName:"project.gr.json"})}}]},...e.allowRunning?[{name:"Build",submenus:[{name:"Run main",async onClick(){let x;try{x=await d.compile()}catch(S){alert(String(S)+`
`+S.diagnostic);return}const U=x.functions.main();console.log("Result:",U)}}]}]:[]],y=[...e.menus??[]];e.preferences?.topbar?.noDefaultMenus||y.unshift(..._);const E={...e,menus:y,userFuncs:{}};g(y);let I=0;for(const x in e.userFuncs){n.set(I,{name:x,func:{inputs:e.userFuncs?.[x].inputs??[],outputs:e.userFuncs?.[x].outputs??[],impl:e.userFuncs?.[x].impl??(()=>{})}});for(const{pins:U,type:S}of[{pins:e.userFuncs?.[x].inputs??[],type:"input"},{pins:e.userFuncs?.[x].outputs??[],type:"output"}])U.forEach((W,Q)=>{if(!/^[^() \t\n]*$/.test(W.name))throw Error([`Name '${W.name}' cannot contain spaces or parentheses`,`(${S} ${Q} of ${x})`].join(`
`))});E.userFuncs[x]={id:I++,node:{...e.userFuncs?.[x],name:x,kind:"func",inputs:[...e.userFuncs?.[x].kind!=="pure"?[{name:"",type:"exec"}]:[],...e.userFuncs?.[x].inputs??[]],outputs:[...e.userFuncs?.[x].kind!=="pure"?[{name:"",type:"exec"}]:[],...e.userFuncs?.[x].outputs??[]]}},delete E.userFuncs[x].node.impl}const L=()=>new Uint8Array(u.instance.exports.memory.buffer,u.instance.exports.transfer_buffer,Ae),O=JSON.stringify(E);if(k.encodeInto(O,L()).read!==O.length)throw console.error("options blob",O),Error(`options blob too large, max ${Ae} bytes allowed. File a bug report`);const M=h.transfer_buffer,q=O.length;if(!h.setInitOpts(M,q))throw Error("error setting initialization options");r.run()}),d}const _t={Point:{inputs:[{name:"x",type:"f64"},{name:"y",type:"f64"},{name:"z",type:"f64"}],outputs:[{name:"",type:"vec3"}],kind:"pure",tags:["geom"],description:"create a point",impl:(t,e,n)=>({x:t,y:e,z:n})},Sphere:{inputs:[{name:"center",type:"vec3",desc:"point to place the sphere"},{name:"radius",type:"f64"},{name:"color",type:"string",desc:"color in RGB Hex e.g. ff00ff"}],outputs:[],tags:["geom"],description:"create a sphere",impl(t,e,n){P.primitives.push({type:"sphere",params:{radius:e},position:[t.x,t.y,t.z],color:parseInt(n??"ffffff",16)})}},Box:{inputs:[{name:"position",type:"vec3",desc:"point to place the box"},{name:"dimensions",type:"vec3",desc:"width, height, depth"},{name:"color",type:"string",desc:"color in RGB Hex e.g. ff00ff"}],outputs:[],tags:["geom"],description:"create a box",impl(t,e,n){P.primitives.push({type:"cube",params:{width:e.x,height:e.y,depth:e.z},position:[t.x,t.y,t.z],color:parseInt(n??"ffffff",16)})}}},mt=[{type:"sphere",params:{radius:1},position:[-2,0,0],color:16729156},{type:"cube",params:{width:1.5,height:1.5,depth:1.5},position:[2,0,0],color:4474111}];class yt{constructor(){this.scene=null,this.camera=null,this.renderer=null,this.controls=null,this.currentObjects=[],this.primitives=[...mt],this.init(),this.updateScene(),this.animate()}init(){const e=document.getElementById("three-canvas"),n=e.parentElement;this.scene=new THREE.Scene,this.scene.background=new THREE.Color(2236962),this.camera=new THREE.PerspectiveCamera(75,n.clientWidth/n.clientHeight,.1,1e3),this.camera.position.set(5,5,5),this.camera.lookAt(0,0,0),this.renderer=new THREE.WebGLRenderer({canvas:e,antialias:!0}),this.renderer.setSize(n.clientWidth,n.clientHeight),this.renderer.shadowMap.enabled=!0,this.renderer.shadowMap.type=THREE.PCFSoftShadowMap;const a=new THREE.AmbientLight(4210752,.6);this.scene.add(a);const f=new THREE.DirectionalLight(16777215,.8);f.position.set(10,10,5),f.castShadow=!0,f.shadow.mapSize.width=2048,f.shadow.mapSize.height=2048,this.scene.add(f),this.controls=new THREE.OrbitControls(this.camera,this.renderer.domElement),this.controls.enableDamping=!0,this.controls.dampingFactor=.05,this.controls.enableZoom=!0,this.controls.enableRotate=!0,this.controls.enablePan=!0,window.addEventListener("resize",()=>this.onWindowResize())}onWindowResize(){const e=document.querySelector(".right-panel");this.camera.aspect=e.clientWidth/e.clientHeight,this.camera.updateProjectionMatrix(),this.renderer.setSize(e.clientWidth,e.clientHeight)}clearScene(){this.currentObjects.forEach(e=>{this.scene.remove(e),e.geometry&&e.geometry.dispose(),e.material&&e.material.dispose()}),this.currentObjects=[]}updateScene(){this.clearScene(),this.primitives.forEach(e=>{const n=this.createMeshFromPrimitive(e);n&&(this.scene.add(n),this.currentObjects.push(n))})}createMeshFromPrimitive(e){let n;const{type:a,params:f={},position:i=[0,0,0],rotation:r=[0,0,0],scale:s=[1,1,1],color:o=65416}=e;switch(a.toLowerCase()){case"sphere":n=new THREE.SphereGeometry(f.radius||1,f.widthSegments||32,f.heightSegments||16);break;case"cube":case"box":n=new THREE.BoxGeometry(f.width||1,f.height||1,f.depth||1);break;case"cylinder":n=new THREE.CylinderGeometry(f.radiusTop||1,f.radiusBottom||1,f.height||1,f.radialSegments||8);break;case"cone":n=new THREE.ConeGeometry(f.radius||1,f.height||1,f.radialSegments||8);break;case"plane":n=new THREE.PlaneGeometry(f.width||1,f.height||1);break;case"torus":n=new THREE.TorusGeometry(f.radius||1,f.tube||.4,f.radialSegments||8,f.tubularSegments||6);break;default:return console.warn(`Unknown primitive type: ${a}`),null}const l=new THREE.MeshLambertMaterial({color:o}),c=new THREE.Mesh(n,l);return c.position.set(...i),c.rotation.set(...r),c.scale.set(...s),c.castShadow=!0,c.receiveShadow=!0,c}animate(){requestAnimationFrame(()=>this.animate()),this.controls.update(),this.renderer.render(this.scene,this.camera)}}let P;window.addEventListener("DOMContentLoaded",()=>{P=new yt;const t=document.getElementById("left-canvas");let e;pt(t,{allowRunning:!1,userFuncs:_t,menus:[{name:"Sync",async onClick(){P.primitives=[],console.log(await e.exportGraphlt()),(await e.compile()).functions.geometry(),P.updateScene()}}],graphs:{geometry:{fixedSignature:!0,inputs:[],outputs:[],nodes:[{id:1,type:"Point",inputs:{0:{float:-2},1:{float:0},2:{float:0}}},{id:2,type:"Point",inputs:{0:{float:2},1:{float:0},2:{float:0}}},{id:3,type:"Point",inputs:{0:{float:1.5},1:{float:1.5},2:{float:1.5}}},{id:4,type:"Sphere",inputs:{0:{node:0,outPin:0},1:{node:1,outPin:0},2:{float:1},3:{string:"FF4444"}}},{id:5,type:"Box",inputs:{0:{node:4,outPin:0},1:{node:2,outPin:0},2:{node:3,outPin:0},3:{string:"4444FF"}}},{id:6,type:"return",inputs:{0:{node:5,outPin:0}}}]}}}).then(a=>e=a)});window.updateScene=function(t){P?P.updateScene(t):console.error("ThreeJS viewer not initialized yet")};
