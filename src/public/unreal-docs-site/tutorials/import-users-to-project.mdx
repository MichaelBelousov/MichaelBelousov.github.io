export const metadata = {
  title: 'Import Users into Project',
  tile: {
    name: 'Import Users into Project',
    description:
      'This tutorial will demonstrate how to add users to a Project from a CSV file.',
    href: '/tutorials/import-users-to-project/',
    durationInMinutes: 5,
    relatedApiIds: ['projects'],
  },
};

<Introduction 
  skillLevel="Basic" 
  durationInMinutes="5" >

## Introduction

This tutorial will demonstrate how to add users to a Project from a CSV file. This tutorial is accompanied by a sample powershell script located [here](https://github.com/iTwin/platform-api-samples/tree/main/Administration/Project-Import-Users). Authorization is provided as a separate [script](https://github.com/iTwin/platform-api-samples/blob/main/Authorization/New-OidcAuthCodePkceLogin.ps1).

</Introduction>

<TutorialSection>

## Prerequisites

This tutorial assumes that you already have:

- [PowerShell](https://docs.microsoft.com/en-us/powershell/scripting/overview?view=powershell-7.1) (Recommended 7.0+ version) installed.
- Access to, or create a new, project to use this sample.
  - Process of creating a new project is covered in [this tutorial](/tutorials/create-and-query-projects-guide/)
- Your own **Desktop/Mobile** application/client registered on iTwin Platform.
  - Steps to follow for registering an application can be found [here](/tutorials/register-and-modify-application/).
  - Make sure that your application/client is associated with **Projects API** and has `projects:read` and `projects:modify` scopes enabled.

</TutorialSection>

<TutorialSection>

## 1. Request access token for use in Authorization header

Authorization is required for all iTwin Platform API endpoints. See the [Authorization README](https://github.com/iTwin/platform-api-samples/tree/main/Authorization) for more information.
[This tutorial powershell sample](https://github.com/iTwin/platform-api-samples/blob/main/Administration/Project-Import-Users/Import-ProjectUsers.ps1) already includes code that obtains an authorization token.

<Alert>
  These samples require an Authorization Code + PKCE client. Registration of a{' '}
  <strong>Desktop/Mobile</strong> application/client will give you an
  Authorization Code + PKCE client.
</Alert>

</TutorialSection>

<TutorialSection>

## 2. Read users from CSV

Reading users from a CSV is dependent upon your particular development framework and is outside the scope of this tutorial.

Users CSV file must be in following format:

```CSV
Email: Roles
user1@example.com: <comma-separated list of project roles>
user2@example.com: <comma-separated list of project roles>
```

</TutorialSection>

<TutorialSection
  actions={[
    <Title>Example HTTP request</Title>,
    <CodeBlock
      language="http"
      code={
`POST https://api.bentley.com/projects/validation/38b7e366-bc20-4bb1-9572-0797cf5221f/members HTTP/1.1
Authorization: Bearer JWT_TOKEN
Content-Type: application/json`} />
  ]}>

## 3. Add each user to the Project

Adding a team member to a project requires POSTing the request to the `https://api.bentley.com/projects/{id}/members` endpoint.

#### Request headers

Two headers are required. An authorization header is needed.

```HTTP
Authorization: Bearer JWT_TOKEN
Content-Type: application/json
```

</TutorialSection>

<TutorialSection
  subSection={true}
  actions={[
    <Title>Example request body</Title>,
    <CodeBlock
      language="json"
      code={
`{
  "email":"john.doe@my-org.com",
  "roleNames":[
    "Project Role 1",
    "Project Role 2"
  ]
}`} />
  ]}
>

#### Request body

The request body is specified as JSON and requires the email and roleNames properties. The API works with one user at a time, thus one _email_. Multiple roles may be requested via the _roleNames_ array.

</TutorialSection>

<ContinueLearningSection>

## More resources that you may like

<TileList>
  <ResourceTile
    title="Administration API group"
    href="/api-groups/administration/"
    description="Manage the users, projects, and organizations that interact with your iTwin."
  />
  <ResourceTile
    title="Projects API documentation"
    href="/apis/projects/"
    description="An overview and detailed Projects API documentation."
  />
  <ResourceTile
    title="iTwin Platform API samples"
    href="https://github.com/iTwin/platform-api-samples"
    description="PowerShell samples demonstrating API endpoints."
    isExternal={true}
  />
</TileList>

</ContinueLearningSection>
