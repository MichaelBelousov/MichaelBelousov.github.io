(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[7102],{91272:function(e,t,n){"use strict";n.d(t,{Pu:function(){return c},ZP:function(){return y},Jt:function(){return N}});var i=n(159),a=n(91164),o=n(67294),r=n(3905),s=["components"],c=(o.createElement,{title:"Authorize Service Application",tile:{name:"Get Access Token with Service application",description:"This tutorial will provide you information how to authorize.",href:"/tutorials/authorize-service/",durationInMinutes:10,relatedApiIds:[]}}),l=function(e){return function(t){return console.warn("Component "+e+" was not imported, exported, or provided by MDXProvider as global scope"),(0,r.kt)("div",t)}},p=l("Introduction"),u=l("TutorialSection"),d=l("SignInButton"),m=l("CreateServiceAppButton"),h=l("CodeBlock"),k=l("Alert"),f=l("Title"),g=l("HttpSample"),v=l("ContinueLearningSection"),w={metadata:c};function y(e){var t=e.components,n=(0,a.Z)(e,s);return(0,r.kt)("wrapper",(0,i.Z)({},w,n,{components:t,mdxType:"MDXLayout"}),(0,r.kt)(p,{skillLevel:"Basic",durationInMinutes:"10",mdxType:"Introduction"},(0,r.kt)("h2",{id:"introduction"},"Introduction"),(0,r.kt)("p",null,"In this tutorial you will create ",(0,r.kt)("strong",{parentName:"p"},"Service")," application. Learn how ",(0,r.kt)("strong",{parentName:"p"},"client_credential")," flow works and how to get ",(0,r.kt)("strong",{parentName:"p"},"access token")," with it. And in the end we will double check if token is truly valid by making request to one of ",(0,r.kt)("strong",{parentName:"p"},"iTwin Platforms API endpoint"),".")),(0,r.kt)(u,{mdxType:"TutorialSection"},(0,r.kt)("h2",{id:"1-register-an-service-application"},"1. Register an Service Application"),(0,r.kt)("h4",{id:"what-is-service-application"},"What is Service Application?"),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Service application")," is designed to operate without user interaction (sometimes called two-legged OAuth) in order to access web-hosted resourced by using the identity of an application. Services run on a server where the source code or configuration of the application is not available to the public. This allows the use of a client secret when communicating with the authorization server to help improve security.")),(0,r.kt)(u,{subSection:!0,actions:[(0,r.kt)(d,{mdxType:"SignInButton"})],mdxType:"TutorialSection"},(0,r.kt)("h4",{id:"sign-in"},"Sign in"),(0,r.kt)("p",null,"To be able to register application you need to be Signed in.\nIf you are not already you can do that in action pane by clicking ",(0,r.kt)("strong",{parentName:"p"},"Sign In")," button or in the headers top right corner. ")),(0,r.kt)(u,{subSection:!0,actions:function(e){return[(0,r.kt)(m,{tooltip:"Register a basic Service App for this tutorial",allowedScopes:["users:read"],clientName:"Authorize Service",mdxType:"CreateServiceAppButton"},"Register Application"),(0,r.kt)(h,{language:"json",code:e.clientId&&e.clientSecret&&e.scope?JSON.stringify({client_id:e.clientId,client_secret:e.clientSecret,scope:e.scope},void 0,2):void 0,mdxType:"CodeBlock"})]},mdxType:"TutorialSection"},(0,r.kt)("h4",{id:"register-an-service-application"},"Register an Service Application"),(0,r.kt)("p",null,"You will need to register an application to be able consume/use iTwin Platform APIs.\nTo make your tutorial more interactive please use the ",(0,r.kt)("strong",{parentName:"p"},"Register Application")," button."),(0,r.kt)("p",null,"After you click this button it will registers an client and will display its settings."),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"client_id"),": This is the unique identifier for your application. It is displayed on the application details page as ",(0,r.kt)("strong",{parentName:"li"},"Client ID"),"."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"client_secret"),": Secret that was created and shown first time you created an application. "),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"scope"),": List of accesses granted to the application. Displayed on the application details page as ",(0,r.kt)("strong",{parentName:"li"},"Scopes"),".")),(0,r.kt)(k,{type:"informational",mdxType:"Alert"},(0,r.kt)("b",null,"For future use"),": You can register applications in ",(0,r.kt)("a",{href:"/my-apps",target:"_blank"},"My apps")," page. But it is not recommended for this tutorial")),(0,r.kt)(u,{mdxType:"TutorialSection"},(0,r.kt)("h2",{id:"2-get-access-token"},"2. Get Access Token"),(0,r.kt)("h4",{id:"what-is-access-token"},"What is access token?"),(0,r.kt)("p",null,"An ",(0,r.kt)("strong",{parentName:"p"},"Access Token")," is token which contains a string that can be used to make authenticated requests to an API to access protect resources (in this case iTwin Platform APIs). The string has no meaning to the application using it, but represents that the user has authorized the application to access their account. The token is bounded by an appropriate lifetime, scopes, and other information that the server may require."),(0,r.kt)("h4",{id:"21-client-credentials-flow"},"2.1. Client credentials flow"),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Client credentials")," flow provides the ability for a web service (confidential client) to use it\u2019s own credentials, instead of impersonating a user, to authenticate when calling a web service. Permissions are granted directly to the application itself by an administrator. When the app presents a token to a resource, the resource enforces that the app itself has authorization to perform an action since there is no user involved in the authentication."),(0,r.kt)("p",null,"You can find more information ",(0,r.kt)("a",{parentName:"p",href:"/apis/overview/authorization/#authorizingservicemachinetomachines"},"here"),", but it is more technical."),(0,r.kt)("p",null,"To sum up in simpler terms:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"No user interaction,"),(0,r.kt)("li",{parentName:"ul"},"No user context/information,"),(0,r.kt)("li",{parentName:"ul"},"You will use ",(0,r.kt)("strong",{parentName:"li"},"client id")," and ",(0,r.kt)("strong",{parentName:"li"},"client secret")," and ",(0,r.kt)("strong",{parentName:"li"},"scope")," to get access token."))),(0,r.kt)(u,{subSection:!0,actions:function(e){var t,n,i;return[(0,r.kt)(f,{mdxType:"Title"},"Request to Token endpoint"),(0,r.kt)(g,{method:"POST",url:"".concat(e.authority,"/connect/token"),headers:{"Content-Type":"application/x-www-form-urlencoded"},body:new URLSearchParams({client_id:null!==(t=e.clientId)&&void 0!==t?t:"CLIENT_ID",client_secret:null!==(n=e.clientSecret)&&void 0!==n?n:"CLIENT_SECRET",scope:null!==(i=e.scope)&&void 0!==i?i:"users:read",grant_type:"client_credentials"}).toString(),saveResponseTo:"tokenResponse",canSendRequest:e.clientId&&e.clientSecret&&e.scope,mdxType:"HttpSample"})]},mdxType:"TutorialSection"},(0,r.kt)("h4",{id:"211-request-to-token-endpoint"},"2.1.1. Request to Token endpoint"),(0,r.kt)("p",null,"You need to call the token endpoint with the ",(0,r.kt)("strong",{parentName:"p"},"Content-Type")," header equal to ",(0,r.kt)("strong",{parentName:"p"},"application/x-www-form-urlencoded"),"."),(0,r.kt)("p",null,"Request body (with ",(0,r.kt)("a",{parentName:"p",href:"https://www.w3schools.com/tags/ref_urlencode.ASP"},"url encoded")," characters):"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"client_id"),": Identification that is generated when the application is created.  You can find it in the ",(0,r.kt)("a",{parentName:"li",href:"/my-apps"},"My Apps")," page. If you generated it during this tutorial you can find it in the first step."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"client_secret"),": Secret that was created and shown first time you created an application"),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"scope"),": Space separated scopes (in this tutorial: users:read)"),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"grant_type"),": ",(0,r.kt)("strong",{parentName:"li"},"client_credentials")," it indicates what flow is in use and client_credentials basically means that you will provide client_id and client_secret as credentials for fake user."))),(0,r.kt)(u,{subSection:!0,actions:function(e){return[(0,r.kt)(f,{mdxType:"Title"},"Response from the Token endpoint"),(0,r.kt)(h,{language:"json",code:JSON.stringify(e.tokenResponse||{access_token:"JWT_TOKEN",token_type:"Bearer",expires_in:3599},void 0,2),mdxType:"CodeBlock"})]},mdxType:"TutorialSection"},(0,r.kt)("h4",{id:"212-response"},"2.1.2. Response"),(0,r.kt)("p",null,"Response contains:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"token_type"),": ",(0,r.kt)("strong",{parentName:"li"},"Bearer")," this is part of Authorization header that is constructed like ",(0,r.kt)("inlineCode",{parentName:"li"},"Authorize: token_type access_token")," you can read more ",(0,r.kt)("a",{parentName:"li",href:"https://www.oauth.com/oauth2-servers/differences-between-oauth-1-2/bearer-tokens/"},"here"),"."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"access_token"),": access token itself (in ",(0,r.kt)("a",{parentName:"li",href:"https://jwt.io"},"JWT")," format) that will be passed into ",(0,r.kt)("strong",{parentName:"li"},"Authorize")," header for api calls as ",(0,r.kt)("strong",{parentName:"li"},"Bearer JWT_TOKEN"),"."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"expires_in"),": lifespan of access token in seconds."))),(0,r.kt)(u,{mdxType:"TutorialSection"},(0,r.kt)("h2",{id:"3-make-the-request"},"3. Make the request")),(0,r.kt)(u,{subSection:!0,actions:function(e){var t,n;return[(0,r.kt)(f,{mdxType:"Title"},"Request to /users/me endpoint"),(0,r.kt)(g,{method:"GET",url:"".concat(e.baseUrl,"/users/me"),headers:{Authorization:"Bearer "+(null!==(t=null===(n=e.tokenResponse)||void 0===n?void 0:n.access_token)&&void 0!==t?t:"JWT_TOKEN"),Accept:"application/vnd.bentley.itwin-platform.v1+json"},body:void 0,saveResponseTo:"me",canSendRequest:e.tokenResponse,mdxType:"HttpSample"})]},mdxType:"TutorialSection"},(0,r.kt)("h4",{id:"31-make-the-request-to-usersme-endpoint"},"3.1. Make the request to /users/me endpoint"),(0,r.kt)("p",null,"This request will show that newly created ",(0,r.kt)("strong",{parentName:"p"},"access token")," is valid and will show how to use it. ",(0,r.kt)("inlineCode",{parentName:"p"},"/users/me")," endpoint would retrieve the logged in user\u2019s profile, but because authorization was done without user interaction it will contain \u201cfake\u201d user information that is associated with this ",(0,r.kt)("strong",{parentName:"p"},"Service")," application.")),(0,r.kt)(u,{subSection:!0,actions:function(e){return[(0,r.kt)(f,{mdxType:"Title"},"Response from /users/me endpoint"),(0,r.kt)(h,{language:"json",code:JSON.stringify(e.me||{user:{displayName:"CLIENT_ID@apps.imsoidc.bentley.com",givenName:"CLIENT_NAME",surname:"LastName",email:"CLIENT_ID@apps.imsoidc.bentley.com",alternateEmail:"CLIENT_ID@apps.imsoidc.bentley.com",city:null,country:"US",language:"EN",createdDateTime:"2021-08-27T10:19:07.2510000Z"}},void 0,2),mdxType:"CodeBlock"})]},mdxType:"TutorialSection"},(0,r.kt)("h4",{id:"32-response-explanation"},"3.2. Response explanation"),(0,r.kt)("p",null,"Because service applications does not require user interaction it does not contain any user context or in simpler terms access token does not contain any user information and it gets assigned to \u201cfake\u201d user and you can see details in this response. To give this application any additional access you need give extra roles, that can be done by administrator ",(0,r.kt)("a",{parentName:"p",href:"/apis/projects/#serviceapplications"},"more information about that"),".")),(0,r.kt)(v,{mdxType:"ContinueLearningSection"}))}y.isMDXComponent=!0;var N=function(){return[{id:"introduction",level:2,title:"Introduction",children:[]},{id:"1-register-an-service-application",level:2,title:"1. Register an Service Application",children:[]},{id:"2-get-access-token",level:2,title:"2. Get Access Token",children:[]},{id:"3-make-the-request",level:2,title:"3. Make the request",children:[]}]}},31389:function(e,t,n){"use strict";n.d(t,{Z:function(){return d}});var i=n(61565),a=n(67294),o=n(94184),r=n.n(o),s=(n(50371),n(73351)),c=n(85893),l=function(e){var t=e.item,n=e.setActiveItem,i=e.className,a=e.activeItem,o=e.prefix;return(0,c.jsx)(c.Fragment,{children:(0,c.jsx)("div",{className:"menuItem-container",children:(0,c.jsx)(s.D,{href:"".concat(null!==o&&void 0!==o?o:"#").concat(t.id),children:(0,c.jsx)("span",{onClick:function(){return n(t.id)},className:"".concat(i," ").concat(t.id===a?"active":""),children:t.title})})})})},p=function(e){var t=e.items,n=e.setActiveItem,i=e.activeItem,a=e.navPrefix;return(0,c.jsx)(c.Fragment,{children:t.map((function(e,t){return(0,c.jsxs)("div",{children:[(0,c.jsx)(l,{item:e,className:"sideMenuItem",setActiveItem:n,activeItem:i,prefix:a},e.id),e.children.map((function(e){return(0,c.jsx)(l,{item:e,className:"sideMenuItem sideMenuSubItem",setActiveItem:n,activeItem:i,prefix:a},e.id)}))]},t)}))})},u=n(71125),d=function(e){var t,n=a.useState(!1),o=(0,i.Z)(n,2),s=o[0],l=o[1],d=a.useState(""),m=(0,i.Z)(d,2),h=m[0],k=m[1],f=a.useState(!1),g=(0,i.Z)(f,2),v=g[0],w=g[1];a.useEffect((function(){var t;e.items.length>0&&k(null!==(t=e.activeItem)&&void 0!==t?t:e.items[0].id)}),[e.activeItem]),a.useEffect((function(){var e=function(){var e=window.location.hash.substring(1,window.location.hash.length);k(e),w(!1)};return window.addEventListener("hashchange",e,!1),function(){window.removeEventListener("hashchange",e,!1)}}),[]),a.useEffect((function(){v&&l(!1)}),[v]);return(0,c.jsxs)(c.Fragment,{children:[(0,c.jsx)(u.j,{isOpened:s,onClick:function(){l((function(e){return!e}))}}),(0,c.jsx)("div",{id:"tutorial-side-navigation-pane",className:r()(e.className,"sticky-container",s?"opened":void 0),children:(0,c.jsx)("div",{className:"sideMenu sticky-element",children:(0,c.jsxs)("div",{className:"sideMenu-large",children:[e.header,(0,c.jsx)(p,{items:e.items,setActiveItem:function(e){w(!0),k(e)},activeItem:h,navPrefix:null!==(t=e.navPrefix)&&void 0!==t?t:"#"}),e.actions&&(0,c.jsx)("div",{className:"side-menu-actions",children:e.actions})]})})})]})}},1176:function(e,t,n){"use strict";n(63673),n(67294);var i=n(29e3),a=n(31389),o=n(52203),r=n(85893);t.Z=function(e){return(0,r.jsx)(o.Z,{children:(0,r.jsxs)("div",{id:"page",className:"container tutorial-container",children:[(0,r.jsx)("div",{id:"tutorial-header",children:(0,r.jsx)(i.s,{children:e.tutorial.headline})}),(0,r.jsxs)("div",{id:"tutorial-content",children:[(0,r.jsx)(a.Z,{items:e.tutorial.navigationItems}),(0,r.jsx)("div",{id:"tutorial-content-body",children:e.tutorial.tutorialSteps})]})]})})}},12826:function(e,t,n){"use strict";n.r(t);var i=n(3905),a=n(1176),o=n(55092),r=n(91272),s=(n(67294),n(80989)),c=n(85893);t.default=function(){var e={headline:r.Pu.title,navigationItems:(0,r.Jt)(),tutorialSteps:(0,c.jsx)(i.Zo,{components:o.d,children:(0,c.jsx)(r.ZP,{})})};return(0,c.jsxs)(c.Fragment,{children:[(0,c.jsx)(s.d,{title:"".concat(r.Pu.title," - Tutorials | iTwin Platform")}),(0,c.jsx)(a.Z,{tutorial:e})]})}},80493:function(e,t,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/tutorials/authorize-service",function(){return n(12826)}])},63673:function(){}},function(e){e.O(0,[8273,508,483,229,271,2033,6815,9527,1061,9774,2888,179],(function(){return t=80493,e(e.s=t);var t}));var t=e.O();_N_E=t}]);