(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[61],{76737:function(e,t,n){"use strict";n.d(t,{Jt:function(){return S},Pu:function(){return l},ZP:function(){return v}});var a=n(36864),i=n(4730),o=n(67294),r=n(3905),s=["components"],l=(o.createElement,{title:"Authorize Single-Page Application (SPA)",tile:{name:"Authorize Single-Page Application (SPA)",description:"This tutorial will show you how to register a Single-Page Application (SPA), get an access token with it, and use it.",href:"/tutorials/authorize-spa/",durationInMinutes:10,relatedApiIds:[]}}),p=function(e){return function(t){return console.warn("Component "+e+" was not imported, exported, or provided by MDXProvider as global scope"),(0,r.kt)("div",t)}},c=p("Introduction"),d=p("TutorialSection"),u=p("SignInButton"),h=p("CreateSpaAppButton"),k=p("CodeBlock"),m=p("Title"),g=p("GeneratePkceButton"),f=p("LinkWithUrl"),N=p("HttpSample"),y=p("Alert"),w=p("ContinueLearningSection"),T={metadata:l};function v(e){var t=e.components,n=(0,i.Z)(e,s);return(0,r.kt)("wrapper",(0,a.Z)({},T,n,{components:t,mdxType:"MDXLayout"}),(0,r.kt)(c,{skillLevel:"Basic",durationInMinutes:"10",mdxType:"Introduction"},(0,r.kt)("h2",{id:"introduction"},"Introduction"),(0,r.kt)("p",null,"In this tutorial you will create a ",(0,r.kt)("strong",{parentName:"p"},"Single-Page Application (SPA)"),", learn how ",(0,r.kt)("strong",{parentName:"p"},"authorization code flow")," works with\n",(0,r.kt)("a",{parentName:"p",href:"https://auth0.com/docs/authorization/flows/authorization-code-flow-with-proof-key-for-code-exchange-pkce"},(0,r.kt)("strong",{parentName:"a"},"Proof Key for Code Exchange (PKCE)")),",\nand how to get an ",(0,r.kt)("strong",{parentName:"p"},"access token")," with it. In the end we will double check if the token is truly valid by making a request to one of the ",(0,r.kt)("strong",{parentName:"p"},"iTwin Platform API endpoints"),".")),(0,r.kt)(d,{mdxType:"TutorialSection"},(0,r.kt)("h2",{id:"1-register-a-single-page-application-spa"},"1. Register a Single-Page Application (SPA)"),(0,r.kt)("h4",{id:"what-is-a-single-page-application-spa"},"What is a Single-Page Application (SPA)?"),(0,r.kt)("p",null,"A ",(0,r.kt)("strong",{parentName:"p"},"Single-Page Application (SPA)")," is a web application or website that interacts with the user by dynamically rewriting the current web page with new data from the web server,\ninstead of the default method of a web browser loading entire new pages.")),(0,r.kt)(d,{subSection:!0,actions:[(0,r.kt)(u,{mdxType:"SignInButton"})],mdxType:"TutorialSection"},(0,r.kt)("h4",{id:"sign-in"},"Sign in"),(0,r.kt)("p",null,"To be able to register an application you need to be signed in.\nIf you are not already you can do that by clicking the ",(0,r.kt)("strong",{parentName:"p"},"Sign In")," button in the action pane or in the top right corner of the page.")),(0,r.kt)(d,{subSection:!0,actions:function(e){return[(0,r.kt)(h,{tooltip:"Register a basic Single-Page Application (SPA) for this tutorial",allowedScopes:["users:read"],clientName:"Authorize SPA",mdxType:"CreateSpaAppButton"},"Register Application"),(0,r.kt)(k,{language:"json",code:e.clientId&&e.redirectUris&&e.scope?JSON.stringify({client_id:e.clientId,redirect_uri:e.redirectUris&&e.redirectUris[0],scope:e.scope},void 0,2):void 0,mdxType:"CodeBlock"})]},mdxType:"TutorialSection"},(0,r.kt)("h4",{id:"register-a-single-page-application-spa"},"Register a Single-Page Application (SPA)"),(0,r.kt)("p",null,"You will need to register an application to use the iTwin Platform APIs.\nYou can use the ",(0,r.kt)("strong",{parentName:"p"},"Register Application")," button to automatically create your first Single-Page Application (SPA).\nThis will allow you to configure ",(0,r.kt)("a",{parentName:"p",href:"/apis/overview/authorization/#authorize-single-page-applications-spa-and-desktopmobile-applications-native"},"Authorization Code Flow for your Single-Page Application (SPA)")," and get the correct access token."),(0,r.kt)("p",null,"Once generated, you will be shown a few lines of code under the button:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"client_id")," - This is the unique identifier for your application. It is displayed on the application details page as ",(0,r.kt)("strong",{parentName:"li"},"Client ID"),"."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"redirectUris")," - Specifies where users are redirected after they have chosen whether or not to authenticate your app. Displayed on the application details page as one of ",(0,r.kt)("strong",{parentName:"li"},"Redirect URIs"),"."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"scope")," - List of accesses granted to the application. Displayed on the application details page as ",(0,r.kt)("strong",{parentName:"li"},"Scopes"),".")),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},(0,r.kt)("strong",{parentName:"p"},"For future use:")," Register and configure your application manually following the instructions in the ",(0,r.kt)("a",{parentName:"p",href:"/tutorials/register-and-modify-application/"},"Register and modify an Application")," tutorial."))),(0,r.kt)(d,{mdxType:"TutorialSection"},(0,r.kt)("h2",{id:"2-get-an-access-token"},"2. Get an Access Token"),(0,r.kt)("h4",{id:"what-is-an-access-token"},"What is an access token?"),(0,r.kt)("p",null,"An ",(0,r.kt)("strong",{parentName:"p"},"Access Token")," is token which contains a string that can be used to make authenticated requests to an API to access protect resources (in this case iTwin Platform APIs).The string has no meaning to the application using it, but represents that the user has authorized the application to access their account.\nThe token is bounded by an appropriate lifetime, scopes, and other information that the server may require."),(0,r.kt)("h4",{id:"21-authorization-code-flow-with-proof-key-for-code-exchange-pkce"},"2.1. Authorization Code Flow with Proof Key for Code Exchange (PKCE)"),(0,r.kt)("p",null,"This flow provides a way to authorize with an Authorization Server by redirecting to the authorization server,\ngetting a ",(0,r.kt)("strong",{parentName:"p"},"code")," back, and exchanging it for an ",(0,r.kt)("strong",{parentName:"p"},"access token")," in a subsequent call."),(0,r.kt)("p",null,"You can find more information ",(0,r.kt)("a",{parentName:"p",href:"/apis/overview/authorization/#authorization-code-flow-with-proof-key-for-code-exchange-pkce"},"here"),", but it is more technical."),(0,r.kt)("p",null,"Steps to get an access token using this flow:"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},"Generate ",(0,r.kt)("strong",{parentName:"li"},"code_verifier")," and ",(0,r.kt)("strong",{parentName:"li"},"code_challenge"),","),(0,r.kt)("li",{parentName:"ol"},"Navigate to the authorization server,"),(0,r.kt)("li",{parentName:"ol"},"The authorization server will redirect back to your application (one of redirect URIs) with ",(0,r.kt)("strong",{parentName:"li"},"code")," query parameter,"),(0,r.kt)("li",{parentName:"ol"},"The application exchange ",(0,r.kt)("strong",{parentName:"li"},"code")," for an ",(0,r.kt)("strong",{parentName:"li"},"access_token")," via the Token endpoint."))),(0,r.kt)(d,{subSection:!0,actions:function(e){return[(0,r.kt)(m,{mdxType:"Title"},"Generate Code Verifier and Code Challenge"),(0,r.kt)(g,{mdxType:"GeneratePkceButton"}),(0,r.kt)(k,{language:"json",code:e.pkce?JSON.stringify(e.pkce,void 0,2):void 0,mdxType:"CodeBlock"})]},mdxType:"TutorialSection"},(0,r.kt)("h4",{id:"211-code-verifier-and-code-challenge"},"2.1.1. Code Verifier and Code Challenge"),(0,r.kt)("p",null,"PKCE (",(0,r.kt)("a",{parentName:"p",href:"https://datatracker.ietf.org/doc/html/rfc7636#section-4.1"},"RFC 7636"),") is an extension to the Authorization Code flow to prevent CSRF and authorization code injection attacks."),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"code_verifier")," is a random string between 43 and 128 characters. It provides proof that you initiated the redirect to the authorization endpoint."),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"code_challenge"),": is a string that is generated from ",(0,r.kt)("strong",{parentName:"p"},"code_verifier")," and it is passed to the authorization endpoint as a query parameter.\nPseudo code to generate code challenge:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-jsx","data-language":"jsx","data-highlighted-line-numbers":"",dangerouslySetInnerHTML:{__html:'<span class="token function">base64urlEncode</span><span class="token punctuation">(</span><span class="token constant">SHA256</span><span class="token punctuation">(</span><span class="token constant">ASCII</span><span class="token punctuation">(</span>code_verifier<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n'}})),(0,r.kt)("p",null,"Read more about: ",(0,r.kt)("a",{parentName:"p",href:"https://en.wikipedia.org/wiki/ASCII"},"ASCII"),", ",(0,r.kt)("a",{parentName:"p",href:"https://en.bitcoinwiki.org/wiki/SHA-256"},"SHA256"),", ",(0,r.kt)("a",{parentName:"p",href:"https://wiki.tcl-lang.org/page/base64url"},"base64urlEncode")),(0,r.kt)("p",null,"You can generate them by clicking ",(0,r.kt)("strong",{parentName:"p"},"Generate Code Verifier and Code Challenge"),". This is required for the following steps.")),(0,r.kt)(d,{subSection:!0,actions:function(e){var t,n,a,i;return[(0,r.kt)(m,{mdxType:"Title"},"Navigate to the Authorization Server"),(0,r.kt)(f,{url:e.authority+"/connect/authorize?"+new URLSearchParams({client_id:null!==(t=e.clientId)&&void 0!==t?t:"CLIENT_ID",redirect_uri:e.redirectUris&&e.redirectUris[0]||"http://localhost:3000",scope:null!==(n=e.scope)&&void 0!==n?n:"users:read",response_type:"code",code_challenge:null!==(a=null===(i=e.pkce)||void 0===i?void 0:i.code_challenge)&&void 0!==a?a:"CODE_CHALLENGE",code_challenge_method:"S256"}).toString(),disabled:!e.clientId&&!e.pkce,mdxType:"LinkWithUrl"})]},mdxType:"TutorialSection"},(0,r.kt)("h4",{id:"212-navigate-to-the-authorization-server"},"2.1.2. Navigate To the Authorization Server"),(0,r.kt)("p",null,"Application should make interactive redirect/navigate to authorization server.\nThis allow user to authorize agents authorization server and give consent to allow access part of his data through your application.\nIf you follow the interactive part you can click the ",(0,r.kt)("strong",{parentName:"p"},"Navigate")," button and it will open popup window that will hit authorization endpoint with required query parameters."),(0,r.kt)("p",null,"The URL will be built in this way:"),(0,r.kt)("p",null,"Authorization endpoint: ",(0,r.kt)("inlineCode",{parentName:"p"},"https://ims.bentley.com/connect/authorize")),(0,r.kt)("p",null,"With query parameters:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"client_id")," this is the unique identifier for your application. Displayed on the application details page as ",(0,r.kt)("strong",{parentName:"li"},"Client ID")," (e.g. ",(0,r.kt)("inlineCode",{parentName:"li"},"spa-example"),")"),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"redirect_uri")," Specify there you want go back after successful authorization (e.g. ",(0,r.kt)("inlineCode",{parentName:"li"},"http://localhost:3000/redirect"),")"),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"scope")," list of accesses granted to the application. Displayed on the application details page as ",(0,r.kt)("strong",{parentName:"li"},"Scopes"),". (e.g. ",(0,r.kt)("inlineCode",{parentName:"li"},"users:read"),")"),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"response_type")," For this flow ",(0,r.kt)("strong",{parentName:"li"},"code")," it is only option and that indicates, that you will get code as query parameter then user will come back from authorization server."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"code_challenge")," Code challenge that was generated from code ",(0,r.kt)("strong",{parentName:"li"},"code_verifier")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"code_challenge_method")," Code challenge method type it should be ",(0,r.kt)("strong",{parentName:"li"},"S256"))),(0,r.kt)("p",null,"So in the end it should look something like this: ",(0,r.kt)("inlineCode",{parentName:"p"},"https://ims.bentley.com/connect/authorize?client_id=CLIENT_ID&redirect_uri=http%3A%2F%2Flocalhost%3A3000&scope=users%3Aread&response_type=code&code_challenge=CODE_CHALLENGE&code_challenge_method=S256"))),(0,r.kt)(d,{subSection:!0,actions:function(e){return[(0,r.kt)(m,{mdxType:"Title"},e.code?"Code query parameter value":""),(0,r.kt)(k,{language:"text",code:"string"===typeof e.code?e.code:JSON.stringify(e.code,void 0,2),mdxType:"CodeBlock"})]},mdxType:"TutorialSection"},(0,r.kt)("h4",{id:"213-receive-the-code"},"2.1.3. Receive the code"),(0,r.kt)("p",null,"The code will be placed inside the redirect URL query parameter (e.g. ",(0,r.kt)("inlineCode",{parentName:"p"},"http://localhost:3000/redirect"),(0,r.kt)("strong",{parentName:"p"},"?code=random-string"),").\nThe application should take care of ",(0,r.kt)("strong",{parentName:"p"},"code")," query parameter extraction. If you follow the interactive steps the code should appear in the action pane.")),(0,r.kt)(d,{subSection:!0,actions:function(e){var t,n,a,i;return[(0,r.kt)(m,{mdxType:"Title"},"Request to Token endpoint"),(0,r.kt)(N,{method:"POST",url:"".concat(e.authority,"/connect/token"),headers:{"Content-Type":"application/x-www-form-urlencoded"},body:new URLSearchParams({client_id:null!==(t=e.clientId)&&void 0!==t?t:"CLIENT_ID",code_verifier:null!==(n=null===(a=e.pkce)||void 0===a?void 0:a.code_verifier)&&void 0!==n?n:"CODE_VERIFIER",grant_type:"authorization_code",code:null!==(i=e.code)&&void 0!==i?i:"CODE",redirect_uri:e.redirectUris&&e.redirectUris[0]||"http://localhost:3000"}).toString(),saveResponseTo:"tokenResponse",canSendRequest:e.code&&!e.tokenResponse,disabledTooltip:e.tokenResponse?"The code can be used only once. Navigate to the authorization server one more time.":void 0,mdxType:"HttpSample"})]},mdxType:"TutorialSection"},(0,r.kt)("h4",{id:"214-receive-an-access-token"},"2.1.4. Receive an access token"),(0,r.kt)("p",null,"You need to call the token endpoint with the ",(0,r.kt)("strong",{parentName:"p"},"Content-Type")," header equal to ",(0,r.kt)("strong",{parentName:"p"},"application/x-www-form-urlencoded"),"."),(0,r.kt)("p",null,"Request body (with ",(0,r.kt)("a",{parentName:"p",href:"https://www.w3schools.com/tags/ref_urlencode.ASP"},"URL encoded")," characters):"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"client_id"),": Identification that is generated when the application is created. You can find it in the ",(0,r.kt)("a",{parentName:"li",href:"/my-apps"},"My Apps")," page. If you generated it during this tutorial you can find it in the first step."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"grant_type"),": ",(0,r.kt)("strong",{parentName:"li"},"authorization_code")," indicates that the application will use a ",(0,r.kt)("strong",{parentName:"li"},"code")," to get an ",(0,r.kt)("strong",{parentName:"li"},"access_token"),"."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"code_verifier"),": It is for verification purposes that the same application that redirected to the authorization server is calling this endpoint."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"code"),": Code that the application got after the redirect from the authorization server back to the application itself."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"redirect_uri"),": redirect URI there was code send.")),(0,r.kt)(y,{type:"informational",mdxType:"Alert"},(0,r.kt)("b",null,"Code is short lived"),": If your code has expired please Navigate to the authorization server one more time.")),(0,r.kt)(d,{subSection:!0,actions:function(e){return[(0,r.kt)(m,{mdxType:"Title"},"Response from the Token endpoint"),(0,r.kt)(k,{language:"json",code:JSON.stringify(e.tokenResponse||{access_token:"JWT_TOKEN",token_type:"Bearer",expires_in:3599},void 0,2),mdxType:"CodeBlock"})]},mdxType:"TutorialSection"},(0,r.kt)("h4",{id:"response-from-the-token-endpoint"},"Response from the Token endpoint"),(0,r.kt)("p",null,"Response contains:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"token_type"),": ",(0,r.kt)("strong",{parentName:"li"},"Bearer"),". This is part of the Authorization header that is constructed like ",(0,r.kt)("inlineCode",{parentName:"li"},"Authorize: token_type access_token"),". You can read more ",(0,r.kt)("a",{parentName:"li",href:"https://www.oauth.com/oauth2-servers/differences-between-oauth-1-2/bearer-tokens/"},"here"),"."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"access_token"),": Access token itself (in ",(0,r.kt)("a",{parentName:"li",href:"https://jwt.io"},"JWT")," format) that will be passed in the ",(0,r.kt)("strong",{parentName:"li"},"Authorize")," header for API calls as ",(0,r.kt)("strong",{parentName:"li"},"Bearer JWT_TOKEN"),"."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"expires_in"),": Lifespan of the access token in seconds."))),(0,r.kt)(d,{mdxType:"TutorialSection"},(0,r.kt)("h2",{id:"3-make-the-request"},"3. Make the request")),(0,r.kt)(d,{subSection:!0,actions:function(e){var t,n;return[(0,r.kt)(m,{mdxType:"Title"},"Request to /users/me endpoint"),(0,r.kt)(N,{method:"GET",url:"".concat(e.baseUrl,"/users/me"),headers:{Authorization:"Bearer "+(null!==(t=null===(n=e.tokenResponse)||void 0===n?void 0:n.access_token)&&void 0!==t?t:"JWT_TOKEN"),Accept:"application/vnd.bentley.itwin-platform.v1+json"},body:void 0,saveResponseTo:"me",canSendRequest:e.tokenResponse,mdxType:"HttpSample"})]},mdxType:"TutorialSection"},(0,r.kt)("h4",{id:"31-make-the-request-to-the-usersme-endpoint"},"3.1. Make the request to the /users/me endpoint"),(0,r.kt)("p",null,"This request will show that the newly created ",(0,r.kt)("strong",{parentName:"p"},"access token")," is valid and how to use it.\nThe ",(0,r.kt)("inlineCode",{parentName:"p"},"/users/me")," endpoint will retrieve the logged in user\u2019s profile information.\nIf you follow the interactive part you can click the ",(0,r.kt)("strong",{parentName:"p"},"Send request")," button.")),(0,r.kt)(d,{subSection:!0,actions:function(e){return[(0,r.kt)(m,{mdxType:"Title"},"Response from /users/me endpoint"),(0,r.kt)(k,{language:"json",code:JSON.stringify(e.me||{user:{displayName:"FirstName LastName",givenName:"FirstName",surname:"LastName",email:"FirstName.LastName@domain.com",alternateEmail:"FirstName.LastName@alternative.com",city:"CityName",country:"US",language:"EN",createdDateTime:"2021-08-27T10:19:07.2510000Z"}},void 0,2),mdxType:"CodeBlock"})]},mdxType:"TutorialSection"},(0,r.kt)("h4",{id:"32-response"},"3.2. Response"),(0,r.kt)("p",null,"This request will return user information (name, email, country and etc.).")),(0,r.kt)(w,{mdxType:"ContinueLearningSection"}))}v.isMDXComponent=!0;var S=function(){return[{id:"introduction",level:2,title:"Introduction",children:[]},{id:"1-register-a-single-page-application-spa",level:2,title:"1. Register a Single-Page Application (SPA)",children:[]},{id:"2-get-an-access-token",level:2,title:"2. Get an Access Token",children:[]},{id:"3-make-the-request",level:2,title:"3. Make the request",children:[]}]}},38683:function(e,t,n){"use strict";n.r(t);var a=n(3905),i=n(1176),o=n(58822),r=n(76737),s=(n(67294),n(80989)),l=n(85893);n(14473),t.default=function(){var e={headline:r.Pu.title,navigationItems:(0,r.Jt)(),tutorialSteps:(0,l.jsx)(a.Zo,{components:o.d,children:(0,l.jsx)(r.ZP,{})})};return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(s.d,{title:"".concat(r.Pu.title," - Tutorials | iTwin Platform")}),(0,l.jsx)(i.Z,{tutorial:e})]})}},48262:function(e,t,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/tutorials/authorize-spa",function(){return n(38683)}])}},function(e){e.O(0,[3714,8670,9734,9102,8764,1706,4009,1610,6638,9774,2888,179],(function(){return t=48262,e(e.s=t);var t}));var t=e.O();_N_E=t}]);