(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[7102],{91272:function(e,t,n){"use strict";n.d(t,{Jt:function(){return f},Pu:function(){return l},ZP:function(){return g}});var a=n(36864),i=n(4730),r=n(67294),o=n(3905),s=["components"],l=(r.createElement,{title:"Authorize a Service Application",tile:{name:"Authorize a Service Application",description:"This tutorial will provide you information how to authorize your Service application.",href:"/tutorials/authorize-service/",relatedApiIds:[]}}),p=function(e){return function(t){return console.warn("Component "+e+" was not imported, exported, or provided by MDXProvider as global scope"),(0,o.kt)("div",t)}},c=p("Alert"),u=p("Mermaid"),d=p("RequestLine"),h=p("ExecutableCodeBlock"),m=p("TileList"),k=p("ResourceTile"),y={metadata:l};function g(e){var t=e.components,n=(0,i.Z)(e,s);return(0,o.kt)("wrapper",(0,a.Z)({},y,n,{components:t,mdxType:"MDXLayout"}),(0,o.kt)("h2",{id:"introduction"},"Introduction"),(0,o.kt)("p",null,"When building a server-side app that securely stores secrets, use the following procedures to set up your authorization."),(0,o.kt)(c,{type:"warning",mdxType:"Alert"},(0,o.kt)("p",null,(0,o.kt)("strong",{parentName:"p"},"IMPORTANT")),(0,o.kt)("p",null,"Keep your client credentials, i.e., ",(0,o.kt)("strong",{parentName:"p"},"client ID"),", ",(0,o.kt)("strong",{parentName:"p"},"client secret"),", and ",(0,o.kt)("strong",{parentName:"p"},"access tokens"),", secure. Do not include them in publicly accessible code where they could be discovered. Instead, store them safely on a backend server.")),(0,o.kt)(c,{mdxType:"Alert"},(0,o.kt)("p",null,(0,o.kt)("strong",{parentName:"p"},"Note")),(0,o.kt)("p",null,"Service apps need permission to access the your iTwin\u2019s or iTwin-related data. iTwin roles and permissions are set up using the ",(0,o.kt)("a",{parentName:"p",href:"/apis/access-control/"},"Access Control API")," and the generated email on the ",(0,o.kt)("em",{parentName:"p"},"App Details")," page in ",(0,o.kt)("strong",{parentName:"p"},"My Apps > App Name"),". Setting up access control is not necessary for this tutorial; however, it must be set up before making requests to the APIs.")),(0,o.kt)("h2",{id:"before-you-begin"},"Before you begin"),(0,o.kt)("p",null,"This guide assumes you have:"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"Registered a service application with the necessary scopes for your use case. If you have not created an application, open the ",(0,o.kt)("a",{parentName:"li",href:"/my-apps"},"My Apps")," page under your ",(0,o.kt)("strong",{parentName:"li"},"Profile")," menu to create one. For this guide, the application type is ",(0,o.kt)("strong",{parentName:"li"},"Service"),"."),(0,o.kt)("li",{parentName:"ul"},"The ",(0,o.kt)("inlineCode",{parentName:"li"},"client_id")," and the ",(0,o.kt)("inlineCode",{parentName:"li"},"client_secret")," supplied when you created your application.")),(0,o.kt)(c,{mdxType:"Alert"},(0,o.kt)("p",null,(0,o.kt)("strong",{parentName:"p"},"Note")),(0,o.kt)("p",null,"There is an optional step at the end of the tutorial that enables you to validate the token you received beyond the successful HTTP response. If you would like to perform this step, your app must have the ",(0,o.kt)("inlineCode",{parentName:"p"},"users:read")," scope assigned.")),(0,o.kt)("h2",{id:"client-credential-flow"},"Client Credential Flow"),(0,o.kt)("p",null,"The Client Credential Flow allows your backend process or service, i.e., a confidential client, to authenticate using its own credentials rather than impersonating a user."),(0,o.kt)("p",null,"An administrator grants permissions directly to the application. Since no user is involved in the authentication, the resource enforces that the application is authorized to perform an action when it presents a token to a resource."),(0,o.kt)("p",null,"The following steps provide an overview of the process."),(0,o.kt)("ol",null,(0,o.kt)("li",{parentName:"ol"},"The application makes a request to the authorization server token endpoint with the required parameters."),(0,o.kt)("li",{parentName:"ol"},"The authorization server confirms the information supplied and returns an access token."),(0,o.kt)("li",{parentName:"ol"},"The application uses the access token to call a given API."),(0,o.kt)("li",{parentName:"ol"},"The API responds to the request with the requested data when the necessary scopes are included in the token, and the service identity has the proper permissions for that API.")),(0,o.kt)(u,{chart:"\n  sequenceDiagram\n      participant app as Application\n      participant as as Authorization Server\n      participant api as iTwin API\n  \n      app->>+as: Authenticate using client_id and client_secret\n      as->>as: Validate client_id, client_secret and scopes\n      as->>-app: Granted access token\n  \n      app->>+api: API request with the access token\n      api->>-app: API response\n",mdxType:"Mermaid"}),(0,o.kt)("h2",{id:"set-up-authorization-for-your-app"},"Set up Authorization for your App"),(0,o.kt)("p",null,"The following steps guide you through setting up your application and retrieving an access token with the needed permissions for your service application and identity."),(0,o.kt)("h3",{id:"register-a-service-application"},"Register a service application"),(0,o.kt)("ol",null,(0,o.kt)("li",{parentName:"ol"},"Click your profile button in the upper-right corner of the page. You must be logged in to the Developer Portal."),(0,o.kt)("li",{parentName:"ol"},"Select ",(0,o.kt)("strong",{parentName:"li"},"My Apps")," from the drop-down."),(0,o.kt)("li",{parentName:"ol"},"Click the ",(0,o.kt)("strong",{parentName:"li"},"Register New")," button."),(0,o.kt)("li",{parentName:"ol"},"Enter the name of your application. Service apps have a maximum of 60 characters, the following characters are not allowed: ,;[]=\\<",">",'?"{}',"|","+!@","#","\\$%\\^","*","`","~"),(0,o.kt)("li",{parentName:"ol"},"Select the appropriate scopes for your application in ",(0,o.kt)("em",{parentName:"li"},"API associations"),".",(0,o.kt)("br",{parentName:"li"}),"Selected scopes are listed in the ",(0,o.kt)("strong",{parentName:"li"},"Allowed scope")," list box."),(0,o.kt)("li",{parentName:"ol"},"In ",(0,o.kt)("em",{parentName:"li"},"Application Type"),", click ",(0,o.kt)("strong",{parentName:"li"},"Service")," to indicate you are creating a Service app."),(0,o.kt)("li",{parentName:"ol"},"Click ",(0,o.kt)("strong",{parentName:"li"},"Save"),"."),(0,o.kt)("li",{parentName:"ol"},"On the ",(0,o.kt)("em",{parentName:"li"},"Success")," dialog, click ",(0,o.kt)("strong",{parentName:"li"},"Copy")," to copy the ",(0,o.kt)("inlineCode",{parentName:"li"},"client_id")," and ",(0,o.kt)("inlineCode",{parentName:"li"},"client_secret")," created for your app. Make sure you save this data in a secure location. It is required to obtain a token.",(0,o.kt)("br",{parentName:"li"}),"Close the dialog by clicking the ",(0,o.kt)("strong",{parentName:"li"},"X")," in the upper-right corner or clicking outside the box.")),(0,o.kt)("h2",{id:"obtain-an-access-token"},"Obtain an access token"),(0,o.kt)("p",null,"To obtain an access token for your app, follow these steps:"),(0,o.kt)("ol",null,(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("p",{parentName:"li"},"Send a request to the authorization server endpoint."),(0,o.kt)(d,{method:"POST",baseUrl:function(e){return e.authority},path:"/connect/token",mdxType:"RequestLine"}),(0,o.kt)("p",{parentName:"li"},"The authorization request requires the following parameters:"),(0,o.kt)("table",{parentName:"li"},(0,o.kt)("thead",{parentName:"table"},(0,o.kt)("tr",{parentName:"thead"},(0,o.kt)("th",{parentName:"tr",align:null},(0,o.kt)("strong",{parentName:"th"},"Parameter")),(0,o.kt)("th",{parentName:"tr",align:null},(0,o.kt)("strong",{parentName:"th"},"Description")))),(0,o.kt)("tbody",{parentName:"table"},(0,o.kt)("tr",{parentName:"tbody"},(0,o.kt)("td",{parentName:"tr",align:null},"grant_type"),(0,o.kt)("td",{parentName:"tr",align:null},"Set to ",(0,o.kt)("inlineCode",{parentName:"td"},"client_credentials")," for service-based applications.")),(0,o.kt)("tr",{parentName:"tbody"},(0,o.kt)("td",{parentName:"tr",align:null},"client_id"),(0,o.kt)("td",{parentName:"tr",align:null},"The ID of the app you created. If you forgot the ID, find it on the ",(0,o.kt)("a",{parentName:"td",href:"/my-apps/"},"My Apps")," page. Locate your app in the list. The Client ID is in the same-named column.")),(0,o.kt)("tr",{parentName:"tbody"},(0,o.kt)("td",{parentName:"tr",align:null},"client_secret"),(0,o.kt)("td",{parentName:"tr",align:null},"The secret given when you registered the app. If you did not save the client secret, generate a new one. To do so, open the ",(0,o.kt)("a",{parentName:"td",href:"/my-apps/"},"My Apps")," page and find your app in the list, click the link to open the ",(0,o.kt)("em",{parentName:"td"},"Details")," page, and then click ",(0,o.kt)("strong",{parentName:"td"},"Re-generate")," in the ",(0,o.kt)("em",{parentName:"td"},"Client Secret")," field.")),(0,o.kt)("tr",{parentName:"tbody"},(0,o.kt)("td",{parentName:"tr",align:null},"scope"),(0,o.kt)("td",{parentName:"tr",align:null},"Add the scopes assigned to your app during registration. Scopes enable the application to access requested resources. Separate multiple scopes with a space. ",(0,o.kt)("strong",{parentName:"td"},"Note:")," Needed scopes for each API are in their respective reference documentation pages."))))),(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("p",{parentName:"li"},"The authorization server confirms the ",(0,o.kt)("inlineCode",{parentName:"p"},"client_id")," and ",(0,o.kt)("inlineCode",{parentName:"p"},"client_secret")," and returns an access token. Bentley\u2019s authorization server completes this step. There is no implementation needed in your application. A successful response includes the access token.")),(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("p",{parentName:"li"},"Use the access token to call the API.\nRemember to call iTwin platform APIs, you must set up your iTwin roles and permissions. For more information, see the ",(0,o.kt)("a",{parentName:"p",href:"/apis/access-control/"},"Access Control API")," documentation."))),(0,o.kt)("h3",{id:"token-request-example"},"Token request example"),(0,o.kt)(h,{method:"POST",baseUrl:function(e){return e.authority},path:"/connect/token",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:new URLSearchParams("client_id=<client_id>&client_secret=<client_secret>&scope=users:read&grant_type=client_credentials").toString(),dataToSave:[{variableName:"accessToken",jsonQuery:"access_token"}],mdxType:"ExecutableCodeBlock"}),(0,o.kt)("h3",{id:"validate-your-token"},"Validate your token"),(0,o.kt)("p",null,"If you received a ",(0,o.kt)("inlineCode",{parentName:"p"},"200 OK")," response to your request for a token, it is not necessary to validate it. However, the ",(0,o.kt)("inlineCode",{parentName:"p"},"users/me")," endpoint is provided if you would like to do so. This returns the profile information for the user account assigned to the service when you created your service application."),(0,o.kt)("p",null,"Remember, the iTwin Platform Base URI is ",(0,o.kt)("inlineCode",{parentName:"p"},"api.bentley.com"),"."),(0,o.kt)(h,{method:"GET",path:"/users/me",headers:function(e){var t;return{Accept:"application/vnd.bentley.itwin-platform.v1+json",Authorization:"Bearer ".concat(null!==(t=e.accessToken)&&void 0!==t?t:"<returned token from the previous request>")}},mdxType:"ExecutableCodeBlock"}),(0,o.kt)("h2",{id:"more-resources-that-you-may-like"},"More resources that you may like"),(0,o.kt)(m,{mdxType:"TileList"},(0,o.kt)(k,{title:"Access Control",href:"/apis/access-control/",description:"Manage Access Controls for your iTwin member using iTwin roles and permissions.",mdxType:"ResourceTile"})))}g.isMDXComponent=!0;var f=function(){return[{id:"introduction",level:2,title:"Introduction",children:[]},{id:"before-you-begin",level:2,title:"Before you begin",children:[]},{id:"client-credential-flow",level:2,title:"Client Credential Flow",children:[]},{id:"set-up-authorization-for-your-app",level:2,title:"Set up Authorization for your App",children:[{id:"register-a-service-application",level:3,title:"Register a service application",children:[]}]},{id:"obtain-an-access-token",level:2,title:"Obtain an access token",children:[{id:"token-request-example",level:3,title:"Token request example",children:[]},{id:"validate-your-token",level:3,title:"Validate your token",children:[]}]},{id:"more-resources-that-you-may-like",level:2,title:"More resources that you may like",children:[]}]}},48020:function(e,t,n){"use strict";n.r(t);var a=n(91272),i=n(3905),r=n(54504),o=n(80989),s=n(84479),l=n(85893);n(14473),t.default=function(){var e={headline:a.Pu.title,navigationItems:(0,a.Jt)(),tutorialSteps:(0,l.jsx)(i.Zo,{components:s.d,children:(0,l.jsx)(a.ZP,{})})};return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(o.d,{title:"".concat(a.Pu.title," - Tutorials | iTwin Platform")}),(0,l.jsx)(r.Z,{tutorial:e})]})}},15441:function(e,t,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/tutorials/authorize-service",function(){return n(48020)}])}},function(e){e.O(0,[8670,9734,9102,8764,5781,7974,4009,1610,4786,6042,9774,2888,179],(function(){return t=15441,e(e.s=t);var t}));var t=e.O();_N_E=t}]);