(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[6391],{20398:function(e,t,n){"use strict";n.d(t,{Jt:function(){return f},Pu:function(){return s},ZP:function(){return N}});var a=n(36864),r=n(4730),i=n(67294),o=n(3905),l=["components"],s=(i.createElement,{title:"Authorize a Web Application",tile:{name:"Authorize a Web Application",description:"This tutorial will provide you information how to authorize your web application.",href:"/tutorials/authorize-webapp/",relatedApiIds:[]}}),p=function(e){return function(t){return console.warn("Component "+e+" was not imported, exported, or provided by MDXProvider as global scope"),(0,o.kt)("div",t)}},c=p("Alert"),u=p("Mermaid"),d=p("RequestLine"),h=p("NavigateToAuthorizationServer"),k=p("ExecutableCodeBlock"),m=p("TileList"),y=p("ResourceTile"),g={metadata:s};function N(e){var t=e.components,n=(0,r.Z)(e,l);return(0,o.kt)("wrapper",(0,a.Z)({},g,n,{components:t,mdxType:"MDXLayout"}),(0,o.kt)("h2",{id:"introduction"},"Introduction"),(0,o.kt)("p",null,"When developing web applications using a server-side framework, use the following procedures to set up your authorization."),(0,o.kt)(c,{type:"warning",mdxType:"Alert"},(0,o.kt)("p",null,(0,o.kt)("strong",{parentName:"p"},"IMPORTANT")),(0,o.kt)("p",null,"Keep your client credentials, i.e., ",(0,o.kt)("strong",{parentName:"p"},"client ID"),", ",(0,o.kt)("strong",{parentName:"p"},"client secret"),", and ",(0,o.kt)("strong",{parentName:"p"},"access tokens"),", secure. Do not include them in publicly accessible code where they could be discovered. Instead, store them safely on a backend server.")),(0,o.kt)("h2",{id:"before-you-begin"},"Before you begin"),(0,o.kt)("p",null,"This guide assumes you have:"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"Registered a web app with the necessary scopes for your use case. If you have not created an application, open the ",(0,o.kt)("a",{parentName:"li",href:"/my-apps"},"My Apps")," page under your ",(0,o.kt)("strong",{parentName:"li"},"Profile")," menu to create one. For this guide, the application type is ",(0,o.kt)("strong",{parentName:"li"},"Web App"),"."),(0,o.kt)("li",{parentName:"ul"},"The ",(0,o.kt)("inlineCode",{parentName:"li"},"client_id")," and the ",(0,o.kt)("inlineCode",{parentName:"li"},"client_secret")," supplied when you created your application."),(0,o.kt)("li",{parentName:"ul"},"This tutorial requires a redirect URI of ",(0,o.kt)("inlineCode",{parentName:"li"},"https://developer.bentley.com/redirect-tutorial"),". Please add this redirect URI to the ",(0,o.kt)("em",{parentName:"li"},"App Details")," for your application. The ",(0,o.kt)("em",{parentName:"li"},"App Details")," page can be accessed through the ",(0,o.kt)("a",{parentName:"li",href:"/my-apps"},"My Apps")," page.")),(0,o.kt)(c,{mdxType:"Alert"},(0,o.kt)("p",null,(0,o.kt)("strong",{parentName:"p"},"Note")),(0,o.kt)("p",null,"There is an optional step at the end of the tutorial that enables you to validate the token you received beyond the successful HTTP response. If you would like to perform this step, your app must have the ",(0,o.kt)("inlineCode",{parentName:"p"},"users:read")," scope assigned.")),(0,o.kt)("h2",{id:"user-authorization-code-flow"},"User Authorization Code Flow"),(0,o.kt)("p",null,"Web applications can use the OAuth 2.0 Authorization Code Flow to enable data owners to authorize third-party apps to access user data. This flow includes features like customer login and consent handling to obtain authorization from the resource owner."),(0,o.kt)("p",null,"The following steps provide an overview of the process."),(0,o.kt)("ol",null,(0,o.kt)("li",{parentName:"ol"},"The application makes a request to the authorization server endpoint."),(0,o.kt)("li",{parentName:"ol"},"The end-user provides their authentication information and consents for the application to access resources on their behalf."),(0,o.kt)("li",{parentName:"ol"},"The authorization server returns an authorization code to the Redirect URI specified when creating the application."),(0,o.kt)("li",{parentName:"ol"},"Exchange the authorization code for an access token."),(0,o.kt)("li",{parentName:"ol"},"Use the access token to call the API on behalf of the user.")),(0,o.kt)(u,{chart:"\n  sequenceDiagram\n      participant ro as Resource Owner\n      participant app as Application\n      participant as as Authorization Server\n      participant api as iTwin API\n  \n      ro->>+app: Connect to application\n      app->>+as: Request authorization code\n      as->>ro: Redirect to login and consent\n      ro->>as: Sign in and consent\n      as->>-app: Authorization code\n      app->>+as: Exchange authorization code for an access_token\n      as->>as: Validate client_id, client_secret, scope and redirect_uri\n      as->>-app: Granted access token\n      app->>-ro: Signed in\n  \n      ro->>+app: Perform action\n      app->>+api: API request with the access token\n      api->>-app: API response\n      app->>-ro: Render content\n",mdxType:"Mermaid"}),(0,o.kt)("h2",{id:"set-up-authorization-for-your-app"},"Set up Authorization for your App"),(0,o.kt)("p",null,"The following steps guide you through setting up your application and retrieving an access token with the needed permissions for your web application."),(0,o.kt)("h3",{id:"register-a-web-application"},"Register a web application"),(0,o.kt)("ol",null,(0,o.kt)("li",{parentName:"ol"},"Click your profile button in the upper-right corner of the page. You must be logged in to the Developer Portal."),(0,o.kt)("li",{parentName:"ol"},"Select ",(0,o.kt)("strong",{parentName:"li"},"My Apps")," from the drop-down."),(0,o.kt)("li",{parentName:"ol"},"Click the ",(0,o.kt)("strong",{parentName:"li"},"Register New")," button."),(0,o.kt)("li",{parentName:"ol"},"Enter the name of your application. Web apps have a maximum of 128 characters, the following characters are not allowed: ,;[]=\\<",">",'?"{}',"|","+!@","#","\\$%\\^","*","`","~"),(0,o.kt)("li",{parentName:"ol"},"Select the appropriate scopes for your application in ",(0,o.kt)("em",{parentName:"li"},"API associations"),".",(0,o.kt)("br",{parentName:"li"}),"Selected scopes are listed in the ",(0,o.kt)("strong",{parentName:"li"},"Allowed scope")," list box."),(0,o.kt)("li",{parentName:"ol"},"In ",(0,o.kt)("em",{parentName:"li"},"Application Type"),", click ",(0,o.kt)("strong",{parentName:"li"},"Web App")," to indicate you are creating a web application."),(0,o.kt)("li",{parentName:"ol"},"In ",(0,o.kt)("em",{parentName:"li"},"Redirect URIs"),", enter the callback URL to use during the authorization process. This is the URL to which the authorization code is sent.",(0,o.kt)("br",{parentName:"li"}),"Optionally, you can set a ",(0,o.kt)("em",{parentName:"li"},"Post logout URI")," to which the user will be redirected when logging out of the app."),(0,o.kt)("li",{parentName:"ol"},"Click ",(0,o.kt)("strong",{parentName:"li"},"Save"),"."),(0,o.kt)("li",{parentName:"ol"},"On the ",(0,o.kt)("em",{parentName:"li"},"Success")," dialog, click ",(0,o.kt)("strong",{parentName:"li"},"Copy")," to copy the ",(0,o.kt)("inlineCode",{parentName:"li"},"client_id")," and ",(0,o.kt)("inlineCode",{parentName:"li"},"client_secret")," created for your app. Make sure you save this data in a secure location. It is required to obtain a token.",(0,o.kt)("br",{parentName:"li"}),"Close the dialog by clicking the ",(0,o.kt)("strong",{parentName:"li"},"X")," in the upper-right corner or clicking outside the box.")),(0,o.kt)("h2",{id:"obtain-an-access-token"},"Obtain an Access Token"),(0,o.kt)("p",null,"To obtain an access token for your app, follow these steps:"),(0,o.kt)("ol",null,(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("p",{parentName:"li"},"When the user opens the Web app, redirect them to the authorization server endpoint."),(0,o.kt)(d,{baseUrl:function(e){return e.authority},path:"/connect/authorize?client_id=<client_id>&redirect_uri=<redirect_uri>&scope=<scopes>+offline_access&response_type=code",mdxType:"RequestLine"}),(0,o.kt)("p",{parentName:"li"},"The request for an authorization code requires the following parameters:"),(0,o.kt)("table",{parentName:"li"},(0,o.kt)("thead",{parentName:"table"},(0,o.kt)("tr",{parentName:"thead"},(0,o.kt)("th",{parentName:"tr",align:null},"Parameter"),(0,o.kt)("th",{parentName:"tr",align:null},"Description"))),(0,o.kt)("tbody",{parentName:"table"},(0,o.kt)("tr",{parentName:"tbody"},(0,o.kt)("td",{parentName:"tr",align:null},"response_type"),(0,o.kt)("td",{parentName:"tr",align:null},"Set to ",(0,o.kt)("inlineCode",{parentName:"td"},"code")," to indicate that an authorization code is needed.")),(0,o.kt)("tr",{parentName:"tbody"},(0,o.kt)("td",{parentName:"tr",align:null},"client_id"),(0,o.kt)("td",{parentName:"tr",align:null},"The ID of the app you created. If you forgot the ID, find it on the ",(0,o.kt)("a",{parentName:"td",href:"/my-apps"},"My Apps")," page. Locate your app in the list, and the Client ID is in the same-named column.")),(0,o.kt)("tr",{parentName:"tbody"},(0,o.kt)("td",{parentName:"tr",align:null},"redirect_uri"),(0,o.kt)("td",{parentName:"tr",align:null},"The callback URL you entered when registering your application. The returned authorization code is sent to this URL.")),(0,o.kt)("tr",{parentName:"tbody"},(0,o.kt)("td",{parentName:"tr",align:null},"scope"),(0,o.kt)("td",{parentName:"tr",align:null},"Add the scopes assigned to your app during registration. Separate multiple scopes with a space. Your end user will consent to the app accessing this information on their behalf during the login process. When requesting a refresh token, include the scope ",(0,o.kt)("inlineCode",{parentName:"td"},"offline_access"),". For all other scopes, check the reference documentation for each respective API.")),(0,o.kt)("tr",{parentName:"tbody"},(0,o.kt)("td",{parentName:"tr",align:null},"state"),(0,o.kt)("td",{parentName:"tr",align:null},"(Optional) Used by the client to maintain state between a request and a callback. Recommended to prevent cross-site request forgery. The authorization server includes this value when redirecting the user-agent to the client.")))),(0,o.kt)(h,{query:new URLSearchParams("client_id=<client_id>&redirect_uri=<redirect_uri>&scope=users:read+offline_access&response_type=code").toString(),mdxType:"NavigateToAuthorizationServer"})),(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("p",{parentName:"li"},"The user signs in to authenticate and consents for the application to access resources on their behalf. This page is managed by the Bentley authorization server and does not require any implementation in your application."),(0,o.kt)("p",{parentName:"li"},(0,o.kt)("img",{parentName:"p",src:"/unreal-docs-site/static/images/tutorials/authorize-webapp/user-signin-consent.png",alt:"User interface for facing Bentley authorization server"})),(0,o.kt)("p",{parentName:"li"},"Once authenticated, the Bentley authorization server returns an authorization code to the Redirect URI registered with your application. Extract the ",(0,o.kt)("inlineCode",{parentName:"p"},"code")," in the response from the ",(0,o.kt)("inlineCode",{parentName:"p"},"redirect_uri")," field."),(0,o.kt)(c,{mdxType:"Alert"},(0,o.kt)("p",{parentName:"li"},(0,o.kt)("strong",{parentName:"p"},"Note")),(0,o.kt)("p",{parentName:"li"},"Authorization codes are time-sensitive. If your code expires, send a new request to the authorization server for a new code."))),(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("p",{parentName:"li"},"Send a request to the token endpoint to exchange the authorization code for an access token."),(0,o.kt)(d,{method:"POST",baseUrl:function(e){return e.authority},path:"/connect/token",mdxType:"RequestLine"}),(0,o.kt)("p",{parentName:"li"},"The authorization request requires the following parameters:"),(0,o.kt)("table",{parentName:"li"},(0,o.kt)("thead",{parentName:"table"},(0,o.kt)("tr",{parentName:"thead"},(0,o.kt)("th",{parentName:"tr",align:null},"Field Name"),(0,o.kt)("th",{parentName:"tr",align:null},"Description"))),(0,o.kt)("tbody",{parentName:"table"},(0,o.kt)("tr",{parentName:"tbody"},(0,o.kt)("td",{parentName:"tr",align:null},"client_id"),(0,o.kt)("td",{parentName:"tr",align:null},"Identification generated during application creation. Found in the ",(0,o.kt)("a",{parentName:"td",href:"/my-apps"},"My Apps")," page or in the first step if generated during the tutorial.")),(0,o.kt)("tr",{parentName:"tbody"},(0,o.kt)("td",{parentName:"tr",align:null},"client_secret"),(0,o.kt)("td",{parentName:"tr",align:null},"Secret created during application creation.")),(0,o.kt)("tr",{parentName:"tbody"},(0,o.kt)("td",{parentName:"tr",align:null},"grant_type"),(0,o.kt)("td",{parentName:"tr",align:null},"Set to ",(0,o.kt)("inlineCode",{parentName:"td"},"authorization_code")," Indicates the type of grant being used. This tells the service you are exchanging the code for a token.")),(0,o.kt)("tr",{parentName:"tbody"},(0,o.kt)("td",{parentName:"tr",align:null},"code"),(0,o.kt)("td",{parentName:"tr",align:null},"This is the authorization code returned in the previous request.")),(0,o.kt)("tr",{parentName:"tbody"},(0,o.kt)("td",{parentName:"tr",align:null},"redirect_uri"),(0,o.kt)("td",{parentName:"tr",align:null},"The callback URL you entered when registering your application. This URL must match the URL provided in the initial request.")))),(0,o.kt)(k,{method:"POST",baseUrl:function(e){return e.authority},path:"/connect/token",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:function(e){var t,n,a;return new URLSearchParams("client_id=".concat(null!==(t=e.clientId)&&void 0!==t?t:"<client_id>","&client_secret=<client_secret>&grant_type=authorization_code&code=").concat(null!==(n=e.code)&&void 0!==n?n:"<code>","&redirect_uri=").concat(null!==(a=e.redirectURI)&&void 0!==a?a:"<redirect_uri>")).toString()},dataToSave:[{variableName:"accessToken",jsonQuery:"access_token"},{variableName:"refreshToken",jsonQuery:"refresh_token"}],mdxType:"ExecutableCodeBlock"})),(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("p",{parentName:"li"},"The authorization server confirms the information sent in the request and returns an access token. Bentley\u2019s authorization server completes this step. There is no implementation needed in your application.\nA successful response includes the ",(0,o.kt)("inlineCode",{parentName:"p"},"access_token"),", an expiry of 3600 seconds, and a ",(0,o.kt)("inlineCode",{parentName:"p"},"refresh_token"),". Tokens are ",(0,o.kt)("em",{parentName:"p"},"Bearer")," type, which must be specified in your API calls.")),(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("p",{parentName:"li"},"Use the access token to call the API. Tokens are added to the ",(0,o.kt)("inlineCode",{parentName:"p"},"Authorization")," header with ",(0,o.kt)("inlineCode",{parentName:"p"},"Bearer")," type in subsequent requests.",(0,o.kt)("br",{parentName:"p"}),"\n","Successfully sending a request to an API requires the end user to have the correct account permissions. Use the ",(0,o.kt)("a",{parentName:"p",href:"/apis/access-control/"},"Access Control API")," to ensure your user can access the required resources."))),(0,o.kt)("h2",{id:"request-a-new-access-token-with-a-refresh-token"},"Request a new access token with a refresh token"),(0,o.kt)("p",null,"When your access token is close to the expiry time, you must request a new one using the refresh token provided in the original request. The response contains a new token and a new refresh token. Tokens are ",(0,o.kt)("em",{parentName:"p"},"Bearer")," type, which must be specified in your API calls."),(0,o.kt)(d,{method:"POST",baseUrl:function(e){return e.authority},path:"/connect/token",mdxType:"RequestLine"}),(0,o.kt)("table",null,(0,o.kt)("thead",{parentName:"table"},(0,o.kt)("tr",{parentName:"thead"},(0,o.kt)("th",{parentName:"tr",align:null},"Field Name"),(0,o.kt)("th",{parentName:"tr",align:null},"Description"))),(0,o.kt)("tbody",{parentName:"table"},(0,o.kt)("tr",{parentName:"tbody"},(0,o.kt)("td",{parentName:"tr",align:null},"client_id"),(0,o.kt)("td",{parentName:"tr",align:null},"Identification generated during application creation. Found in the ",(0,o.kt)("a",{parentName:"td",href:"/my-apps"},"My Apps")," page or in the first step if generated during the tutorial.")),(0,o.kt)("tr",{parentName:"tbody"},(0,o.kt)("td",{parentName:"tr",align:null},"client_secret"),(0,o.kt)("td",{parentName:"tr",align:null},"Secret created during application creation.")),(0,o.kt)("tr",{parentName:"tbody"},(0,o.kt)("td",{parentName:"tr",align:null},"grant_type"),(0,o.kt)("td",{parentName:"tr",align:null},"Set to ",(0,o.kt)("inlineCode",{parentName:"td"},"refresh_token")," Indicates the type of grant being used. This tells the service you are requesting a new ",(0,o.kt)("inlineCode",{parentName:"td"},"access_token")," with a ",(0,o.kt)("inlineCode",{parentName:"td"},"refresh_token"),".")),(0,o.kt)("tr",{parentName:"tbody"},(0,o.kt)("td",{parentName:"tr",align:null},"refresh_token"),(0,o.kt)("td",{parentName:"tr",align:null},"The refresh token. Ensure the ",(0,o.kt)("inlineCode",{parentName:"td"},"refresh_token")," you include is the same one received from the previous request.")))),(0,o.kt)(k,{method:"POST",baseUrl:function(e){return e.authority},path:"/connect/token",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:function(e){var t,n,a;return new URLSearchParams("client_id=".concat(null!==(t=e.clientId)&&void 0!==t?t:"<client_id>","&client_secret=<client_secret>&grant_type=refresh_token&refresh_token=").concat(null!==(n=e.refreshToken)&&void 0!==n?n:"<refresh_token>","&redirect_uri=").concat(null!==(a=e.redirectURI)&&void 0!==a?a:"<redirect_uri>")).toString()},dataToSave:[{variableName:"accessToken",jsonQuery:"access_token"}],mdxType:"ExecutableCodeBlock"}),(0,o.kt)("h2",{id:"validate-your-token"},"Validate your token"),(0,o.kt)("p",null,"If you received a ",(0,o.kt)("inlineCode",{parentName:"p"},"200 OK")," response to your request for a token, it is not necessary to validate it. However, the ",(0,o.kt)("inlineCode",{parentName:"p"},"users/me")," endpoint is provided if you would like to do so. This request returns the profile information for the user account associated with the token received."),(0,o.kt)("p",null,"Remember, the iTwin Platform Base URI is ",(0,o.kt)("inlineCode",{parentName:"p"},"api.bentley.com"),"."),(0,o.kt)(k,{method:"GET",path:"/users/me",headers:function(e){var t;return{Accept:"application/vnd.bentley.itwin-platform.v1+json",Authorization:"Bearer ".concat(null!==(t=e.accessToken)&&void 0!==t?t:"<returned token from the previous request>")}},mdxType:"ExecutableCodeBlock"}),(0,o.kt)("h2",{id:"more-resources-that-you-may-like"},"More resources that you may like"),(0,o.kt)(m,{mdxType:"TileList"},(0,o.kt)(y,{title:"Access Control",href:"/apis/access-control/",description:"Manage Access Controls for your iTwin member using iTwin roles and permissions.",mdxType:"ResourceTile"})))}N.isMDXComponent=!0;var f=function(){return[{id:"introduction",level:2,title:"Introduction",children:[]},{id:"before-you-begin",level:2,title:"Before you begin",children:[]},{id:"user-authorization-code-flow",level:2,title:"User Authorization Code Flow",children:[]},{id:"set-up-authorization-for-your-app",level:2,title:"Set up Authorization for your App",children:[{id:"register-a-web-application",level:3,title:"Register a web application",children:[]}]},{id:"obtain-an-access-token",level:2,title:"Obtain an Access Token",children:[]},{id:"request-a-new-access-token-with-a-refresh-token",level:2,title:"Request a new access token with a refresh token",children:[]},{id:"validate-your-token",level:2,title:"Validate your token",children:[]},{id:"more-resources-that-you-may-like",level:2,title:"More resources that you may like",children:[]}]}},68722:function(e,t,n){"use strict";n.r(t);var a=n(20398),r=n(3905),i=n(54504),o=n(80989),l=n(84479),s=n(85893);n(14473),t.default=function(){var e={headline:a.Pu.title,navigationItems:(0,a.Jt)(),tutorialSteps:(0,s.jsx)(r.Zo,{components:l.d,children:(0,s.jsx)(a.ZP,{})})};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(o.d,{title:"".concat(a.Pu.title," - Tutorials | iTwin Platform")}),(0,s.jsx)(i.Z,{tutorial:e})]})}},70348:function(e,t,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/tutorials/authorize-webapp",function(){return n(68722)}])}},function(e){e.O(0,[8670,9734,9102,8764,5781,7974,4009,1610,4786,6042,9774,2888,179],(function(){return t=70348,e(e.s=t);var t}));var t=e.O();_N_E=t}]);