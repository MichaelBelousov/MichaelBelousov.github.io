(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[4407],{3721:function(e,n,t){"use strict";t.r(n),t.d(n,{default:function(){return A}});var r=t(80989),o=t(2905),a=t(57255),i=t(11163),c=t.n(i),s=t(67294),u=t(61686),l=t(59499),d=t(59734),p=t(42869),f=t(23315),m=t(13393),g=t(49413),v=t(17791);function h(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n&&(r=r.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,r)}return t}function j(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?h(Object(t),!0).forEach((function(n){(0,l.Z)(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):h(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}var b=p.Z.DEVELOPER_PORTAL_API_URL+"/usage/account";var O=t(8302),x=t(85495),y=t(5948),w=t(85893),P=function(e){var n=e.onChange,t=e.value,r=e.className;return(0,w.jsx)(x.J2,{content:(0,w.jsx)(a.DatePicker,{date:t,onChange:function(e){return e&&n(e)}}),trigger:"click",children:(0,w.jsx)(a.LabeledInput,{displayStyle:"inline",iconDisplayStyle:"inline",svgIcon:(0,w.jsx)(y.ceO,{}),readOnly:!0,value:t.toDateString(),className:r})})},C=t(31993),N=(t(20778),t(94184)),S=t.n(N),T=t(41664),D=t.n(T),E=t(51477),L=t(89026),k=t(46415);t(80768);function I(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n&&(r=r.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,r)}return t}var _=function(e){var n=e.data,t=e.error,r=e.isLoading,o=(0,L.L)(),i=(0,s.useMemo)((function(){return[{Header:"Consumption",columns:[{id:"application",Header:"Application",accessor:"application",Cell:function(e){return(0,w.jsx)(w.Fragment,{children:0===e.row.depth?e.row.original.appPath?(0,w.jsx)(D(),{href:"".concat((0,u.AP)(o[k.u7]),"/[clientType]/[clientId]"),as:e.row.original.appPath,passHref:!0,children:(0,w.jsx)("a",{className:"consumption-table-app-name",children:(0,w.jsx)(a.Tooltip,{content:e.row.original.name,children:(0,w.jsx)("span",{children:e.row.original.name})})})}):(0,w.jsx)(a.Tooltip,{content:e.row.original.name,children:(0,w.jsx)("span",{className:"consumption-table-app-name",children:e.row.original.name})}):(0,w.jsx)(a.Tooltip,{content:e.row.original.name,children:(0,w.jsx)("span",{className:"consumption-table-app-name sub-row-alignment",children:e.row.original.name})})})}},{id:"consumed",Header:"Consumed",accessor:"consumed",cellClassName:"consumption-table-number-cell",cellRenderer:function(e){return e.cellProps.value||(e.cellElementProps.className=S()("consumption-table-empty-cell",e.cellElementProps.className)),(0,w.jsx)(a.DefaultCell,function(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?I(Object(t),!0).forEach((function(n){(0,l.Z)(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):I(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}({},e))},maxWidth:150},{id:"totalCredits",Header:"Total credits consumed",cellClassName:"consumption-table-number-cell",accessor:"totalCredits",maxWidth:200,Cell:function(e){return(0,w.jsx)(w.Fragment,{children:(n=e.row,n.depth>0?(0,w.jsxs)("div",{className:"consumption-table-total-info",children:[e.row.original.totalCredits," cr",(0,w.jsx)(a.Tooltip,{content:"".concat(e.row.original.name," rate is ").concat(e.row.original.rate," cr per ").concat(e.row.original.unit),trigger:"mouseenter click",children:(0,w.jsx)("span",{children:(0,w.jsx)(y.u$m,{className:"consumption-table-info-icon"})})})]}):(0,w.jsxs)("div",{className:"consumption-table-app-total-info",children:[e.row.original.totalCredits," cr"]}))});var n}}]}]}),[]),c=(0,s.useMemo)((function(){var e;return(null!==(e=null===n||void 0===n?void 0:n.apps)&&void 0!==e?e:[]).map((function(e){var n=0;return{name:e.applicationType?e.applicationName:"Deleted (".concat(e.clientId,")"),id:e.clientId,appPath:e.applicationType?"".concat((0,u.AP)(o[k.u7]),"/").concat(e.applicationType,"/").concat(e.clientId):null,subRows:e.apis.map((function(e){var t=E.c.roundNumberUp(e.totalCredits,1);return n+=t,{name:e.apiName,rate:E.c.roundNumberUp(e.creditsPerUnit,1),unit:e.unit,consumed:"".concat(E.c.roundNumberUp(e.totalConsumption,1)," ").concat(e.unit),totalCredits:E.c.roundNumberUp(t,1)}})).sort((function(e,n){return e.name.toLowerCase().localeCompare(n.name.toLowerCase())})),totalCredits:E.c.roundNumberUp(n,1)}})).sort((function(e,n){return e.name&&n.name?e.name.toLowerCase().localeCompare(n.name.toLowerCase()):1}))}),[n]),d=(0,s.useMemo)((function(){var e,t=0;return(null!==(e=null===n||void 0===n?void 0:n.apps)&&void 0!==e?e:[]).forEach((function(e){var n;(null!==(n=null===e||void 0===e?void 0:e.apis)&&void 0!==n?n:[]).forEach((function(e){t+=E.c.roundNumberUp(e.totalCredits,1)}))})),t}),[n]);return(0,w.jsxs)(w.Fragment,{children:[(0,w.jsx)(a.Table,{columns:i,data:c,emptyTableContent:t?"Could not get consumption data. Please try again later.":"There is no consumption data available.",isSortable:!0,isLoading:r}),(0,w.jsx)("div",{className:"consumption-table-footer",children:(null===n||void 0===n?void 0:n.totalCredits)&&"Total credit consumption: ".concat(E.c.roundNumberUp(d,1)," cr")})]})};function U(e){var n=e.getFullYear().toLocaleString("en",{minimumIntegerDigits:4,useGrouping:!1}),t=(e.getMonth()+1).toLocaleString("en",{minimumIntegerDigits:2,useGrouping:!1}),r=e.getDate().toLocaleString("en",{minimumIntegerDigits:2,useGrouping:!1});return"".concat(n,"-").concat(t,"-").concat(r)}var R=function(){var e=(0,O.k)().session,n=new Date;n.setDate(1);var t=(0,s.useState)(n),r=t[0],o=t[1],i=(0,s.useState)(new Date),l=i[0],p=i[1],h=(0,s.useState)(void 0),x=h[0],y=h[1],N=(0,s.useState)(void 0),S=N[0],T=N[1],D=function(e,n){var t=(0,f.a)(),r=!!t&&!!t.accessToken&&!!e&&!!n,o=["".concat(b,"?fromDate=").concat(e,"&untilDate=").concat(n),t.accessToken],a=(0,d.ZP)(r?o:null,m.kh,j(j(j({},g.r),v.U),{},{revalidateIfStale:!1,refreshInterval:6e5})),i=a.data,c=a.error,s=a.isLoading,u=a.isValidating;return{consumption:i,error:c,isLoading:s||!r||u}}(x,S),E=D.consumption,L=D.error,k=D.isLoading,I=function(){y(U(r)),T(U(l))};return(0,s.useEffect)((function(){I()}),[]),(0,s.useEffect)((function(){!e||null!==e&&void 0!==e&&e.areas.subscriptionConsumption||c().push(u.Hi)}),[e]),null!==e&&void 0!==e&&e.areas.subscriptionConsumption?(0,w.jsxs)("div",{id:"page",className:"consumption-page",children:[(0,w.jsx)(a.Headline,{children:"iTwin Platform credit consumption"}),(0,w.jsx)(a.Body,{id:"disclaimer",children:(0,w.jsx)("i",{children:"Consumption data is updated every 24 hours and may not reflect your most recent usage."})}),(0,w.jsxs)("div",{className:"date-filters",children:[(0,w.jsx)("span",{children:"Date range (UTC)"}),(0,w.jsx)(P,{value:r,onChange:o,className:"date-input"}),(0,w.jsx)(P,{value:l,onChange:p,className:"date-input"}),(0,w.jsx)(a.Button,{onClick:I,children:"Apply filter"})]}),(0,w.jsx)("div",{children:(0,w.jsx)(_,{data:E,error:L,isLoading:k})})]}):(0,w.jsx)(C.b,{isFullPage:!0})},Z=t(58475);t(14473);var A=(0,Z.h)((function(){return(0,w.jsx)(o.A,{flagName:k.Xb,children:(0,w.jsxs)(w.Fragment,{children:[(0,w.jsx)(r.d,{title:"Consumption | iTwin Platform"}),(0,w.jsx)(R,{})]})})}))},80989:function(e,n,t){"use strict";t.d(n,{d:function(){return i}});var r=t(9008),o=t.n(r),a=t(85893);function i(e){var n=e.title;return(0,a.jsx)(o(),{children:(0,a.jsx)("title",{children:n})})}},2905:function(e,n,t){"use strict";t.d(n,{A:function(){return c}});var r=t(89026),o=t(212),a=t(31993),i=t(85893);function c(e){var n=e.flagName,t=e.children,c=(0,r.L)();return null==c[n]?(0,i.jsx)(a.b,{isFullPage:!0}):c[n]?t:(0,i.jsx)(o.T,{})}},31993:function(e,n,t){"use strict";t.d(n,{b:function(){return i}});var r=t(6227),o=(t(45046),t(51974)),a=t(85893);function i(e){var n=e.isFullPage,t=void 0!==n&&n,i=e.hasSecondaryHeader,c=void 0!==i&&i,s=e.message,u=e.status,l=(0,a.jsxs)("div",{className:"spinner-page-overlay",children:[(0,a.jsx)(o.Z,{children:(0,a.jsx)(r.ProgressRadial,{indeterminate:!0,status:u})}),s?(0,a.jsx)("span",{className:"message",children:s}):null]});return t?(0,a.jsx)("div",{className:c?"full-page-with-secondary-header-overlay-container":"full-page-overlay-container",children:l}):l}},212:function(e,n,t){"use strict";t.d(n,{T:function(){return c}});var r=t(7811),o=t(51974),a=t(6227),i=t(85893);function c(){return(0,i.jsx)(o.Z,{id:"error-page",children:(0,i.jsx)(a.NonIdealState,{svg:(0,i.jsx)(r.M4,{}),heading:"Page not found",description:"You don't have permissions to this page or this page does not exist."})})}},13393:function(e,n,t){"use strict";t.d(n,{ZI:function(){return d},kh:function(){return l}});var r=t(50029),o=t(16835),a=t(87794),i=t.n(a),c=t(9669),s=t.n(c),u=t(85804),l=function(e){var n=(0,o.Z)(e,2),t=n[0],r=n[1];return s().get(t,{headers:{Authorization:"Bearer ".concat(r)}}).then((function(e){return e.data}))},d=function(e){var n=function(){var n=(0,r.Z)(i().mark((function n(){var t,r,o,a;return i().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:t=new URLSearchParams({$top:u.dG.toString()}),r=[];case 2:return n.next=4,s().get(e,{params:t});case 4:a=n.sent,o=a.data.nextLink,a.data.value.forEach((function(e){return r.push(e)})),t.set("$skip",r.length.toString());case 8:if(o){n.next=2;break}case 9:return n.abrupt("return",r);case 10:case"end":return n.stop()}}),n)})));return function(){return n.apply(this,arguments)}}();return n().then((function(e){return e}))}},49413:function(e,n,t){"use strict";t.d(n,{r:function(){return r}});var r={shouldRetryOnError:!0,errorRetryInterval:2e3,errorRetryCount:3}},17791:function(e,n,t){"use strict";t.d(n,{U:function(){return r}});var r={revalidateIfStale:!0,revalidateOnFocus:!1,revalidateOnReconnect:!1}},69338:function(e,n,t){"use strict";t.d(n,{N:function(){return u}});var r=t(50029),o=t(87794),a=t.n(o),i=t(67294),c=t(28038),s=t(45829);function u(){var e=(0,s.m)(),n=e.user,t=e.isLoggedIn,o=(0,i.useMemo)((function(){return new c.Z(n.accessToken)}),[n]),u=(0,i.useState)(!0),l=u[0],d=u[1],p=(0,i.useState)(!1),f=p[0],m=p[1],g=(0,i.useCallback)((0,r.Z)(a().mark((function e(){return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,o.acceptTermsOfService();case 2:case"end":return e.stop()}}),e)}))),[o]);return(0,i.useEffect)((function(){t?o.getTermsOfServiceState().then((function(e){return d(e)})).catch((function(){return d(!0)})).finally((function(){return m(!0)})):(d(!0),m(!1))}),[o,t]),(0,i.useMemo)((function(){return{isTermsOfServiceAccepted:l,receivedState:f,acceptTermsOfService:g}}),[g,l,f])}},58475:function(e,n,t){"use strict";t.d(n,{h:function(){return f}});var r=t(59499),o=t(11163),a=t.n(o),i=t(67294),c=t(31993),s=t(61686),u=t(99301),l=t(69338),d=t(85893);function p(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n&&(r=r.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,r)}return t}var f=function(e){return function(n){var t=(0,l.N)().isTermsOfServiceAccepted,o=(0,u.m)(),f=o.isLoaded,m=o.isLoggedIn,g=o.signin,v=m&&t;return(0,i.useEffect)((function(){f&&!v&&(m?t||a().push("".concat(s.sz,"?redirect=").concat(encodeURIComponent(a().asPath))):g())}),[f,m,t,v,g]),v?(0,d.jsx)(e,function(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?p(Object(t),!0).forEach((function(n){(0,r.Z)(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):p(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}({},n)):(0,d.jsx)(c.b,{isFullPage:!0})}}},97069:function(e,n,t){(window.__NEXT_P=window.__NEXT_P||[]).push(["/consumption",function(){return t(3721)}])},45046:function(){},20778:function(){},80768:function(){}},function(e){e.O(0,[9734,7811,9774,2888,179],(function(){return n=97069,e(e.s=n);var n}));var n=e.O();_N_E=n}]);