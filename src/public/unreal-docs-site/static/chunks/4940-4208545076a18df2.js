(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[4940],{25692:function(e,t,r){"use strict";r.d(t,{o:function(){return m}});var n=r(59499),s=r(27812),a=r(50029),i=r(92777),o=r(82262),c=r(87794),u=r.n(c),l=r(9669),d=r.n(l),p=r(42869);function f(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function h(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?f(Object(r),!0).forEach((function(t){(0,n.Z)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):f(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var m=function(){function e(t){(0,i.Z)(this,e),this.token=t}return(0,o.Z)(e,[{key:"baseUrl",get:function(){return p.Z.REPORTING_API_KEYS_URL}},{key:"getAllApiKeys",value:function(){var e=(0,a.Z)(u().mark((function e(){var t;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getAll("/keys");case 2:return t=e.sent,e.abrupt("return",t);case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"getAll",value:function(){var e=(0,a.Z)(u().mark((function e(t){var r,n,a,i;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r=[],n="",a=new URLSearchParams({$continuationToken:"",revoked:"false"});case 3:return e.next=5,d().get(t,{params:a,headers:this.getAuthorizationHeaders(),baseURL:this.baseUrl});case 5:i=e.sent,n=i.data.continuationToken,a.set("$continuationToken",n||""),r.push.apply(r,(0,s.Z)(i.data.apiKeys));case 9:if(n){e.next=3;break}case 10:return e.abrupt("return",r);case 11:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"createApiKey",value:function(){var e=(0,a.Z)(u().mark((function e(t){return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,d().post("/keys",t,{baseURL:this.baseUrl,headers:h(h({},this.getAuthorizationHeaders()),{},{"Content-Type":"application/json"})});case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"updateApiKey",value:function(){var e=(0,a.Z)(u().mark((function e(t,r){return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,d().patch("/keys/".concat(t),r,{baseURL:this.baseUrl,headers:h(h({},this.getAuthorizationHeaders()),{},{"Content-Type":"application/json"})});case 2:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"getApiKey",value:function(){var e=(0,a.Z)(u().mark((function e(t){var r;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,d().get("/keys/".concat(t),{baseURL:this.baseUrl,headers:h({},this.getAuthorizationHeaders())});case 2:return r=e.sent,e.abrupt("return",r.data);case 4:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"revokeApiKey",value:function(){var e=(0,a.Z)(u().mark((function e(t){return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,d().delete("keys/".concat(t),{headers:this.getAuthorizationHeaders(),baseURL:this.baseUrl});case 2:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getAuthorizationHeaders",value:function(){return{Authorization:"Bearer ".concat(this.token)}}}]),e}()},69687:function(e,t,r){"use strict";var n=r(94184),s=r.n(n),a=r(6227),i=(r(67294),r(51974)),o=(r(64219),r(85893));t.Z=function(e){var t=e.onSave,r=e.onCancel,n=e.message,c=e.className,u=e.submitLabel,l=void 0===u?"Save":u,d=e.cancelLabel,p=void 0===d?"Cancel":d,f=e.submitDisabled,h=void 0!==f&&f;return(0,o.jsx)(i.Z,{children:(0,o.jsxs)("div",{id:"actions",className:s()("action-panel",c),children:[n&&(0,o.jsx)(a.Text,{variant:"small",isMuted:!0,children:n}),(0,o.jsxs)("div",{className:"button-section",children:[(0,o.jsx)(a.Button,{size:"large",styleType:"cta",type:"submit",id:"save-app",onClick:t,disabled:h,children:l}),r&&(0,o.jsx)(a.Button,{size:"large",styleType:"default",type:"button",id:"cancel",onClick:r,children:p})]})]})})}},54740:function(e,t,r){"use strict";var n=r(6227),s=(r(50854),r(51974)),a=r(85893);t.Z=function(e){var t=e.header,r=e.children,i=e.footer;return(0,a.jsxs)("div",{className:"framed-card",children:[(0,a.jsxs)("div",{className:"framed-card-content",children:[(0,a.jsx)(s.Z,{children:(0,a.jsx)(n.Text,{variant:"title",as:"h2",className:"framed-card-title",children:t})}),r]}),i&&(0,a.jsx)("div",{className:"framed-card-footer",children:i})]})}},81878:function(e,t,r){"use strict";var n=r(57255),s=(r(67294),r(70347)),a=(r(3830),r(85893));t.Z=function(e){return e.breadcrumbs?(0,a.jsx)("div",{id:"page-header-with-breadcrumbs",children:(0,a.jsxs)("div",{className:"page-header-content-container",children:[e.breadcrumbs&&(0,a.jsx)(n.Breadcrumbs,{className:"breadcrumbs",children:e.breadcrumbs}),(0,a.jsx)("div",{className:"page-header-content",children:e.content})]})}):e.sticky?(0,a.jsx)("div",{id:"page-header",className:"sticky",children:e.content}):e.newVersion?(0,a.jsx)(s.PageLayout.Content,{className:"page-content-header",padded:!0,children:e.content}):(0,a.jsx)("div",{id:"page-header",children:e.content})}},31993:function(e,t,r){"use strict";r.d(t,{b:function(){return i}});var n=r(6227),s=(r(45046),r(51974)),a=r(85893);function i(e){var t=e.isFullPage,r=void 0!==t&&t,i=e.hasSecondaryHeader,o=void 0!==i&&i,c=e.message,u=e.status,l=(0,a.jsxs)("div",{className:"spinner-page-overlay",children:[(0,a.jsx)(s.Z,{children:(0,a.jsx)(n.ProgressRadial,{indeterminate:!0,status:u})}),c?(0,a.jsx)("span",{className:"message",children:c}):null]});return r?(0,a.jsx)("div",{className:o?"full-page-with-secondary-header-overlay-container":"full-page-overlay-container",children:l}):l}},58731:function(e,t,r){"use strict";r.d(t,{ZP:function(){return U}});var n=r(16835),s=r(50029),a=r(87794),i=r.n(a),o=r(57255),c=r(11163),u=r(67294),l=r(5948),d=r(85393),p=r(42869),f=r(85876);function h(){return(0,u.useMemo)((function(){return new f.zr(p.Z.REPORTING_API_URL)}),[])}var m=r(79036),v=r(51477),g=r(69687),y=r(54740),x=r(81878),b=r(31993),w=(r(79109),r(27812)),j=r(59499),k=(r(72223),r(70648)),S=r(23315);function T(){return(0,u.useMemo)((function(){return new k.mm(p.Z.ITWINS_API_URL)}),[])}var I=r(85893);function O(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function A(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?O(Object(r),!0).forEach((function(t){(0,j.Z)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):O(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var R=function(){var e=(0,s.Z)(i().mark((function e(t,r,n){var a,o;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=n.map(function(){var e=(0,s.Z)(i().mark((function e(n){return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,n.id){e.next=3;break}throw new Error("iTwin ID is missing");case 3:return e.t0=A,e.t1=A({},n),e.t2={},e.next=8,r.getReports(t,n.id);case 8:return e.t3=e.sent,e.t4={reports:e.t3,forbidden:!1},e.abrupt("return",(0,e.t0)(e.t1,e.t2,e.t4));case 13:if(e.prev=13,e.t5=e.catch(0),"object"!==typeof e.t5||null===e.t5||!("status"in e.t5)){e.next=20;break}if(403!==e.t5.status){e.next=18;break}return e.abrupt("return",A(A({},n),{},{reports:[],forbidden:!0}));case 18:if(404!==e.t5.status){e.next=20;break}return e.abrupt("return",A(A({},n),{},{reports:[],forbidden:!1}));case 20:throw e.t5;case 21:case"end":return e.stop()}}),e,null,[[0,13]])})));return function(t){return e.apply(this,arguments)}}()),e.next=3,Promise.all(a);case 3:return o=e.sent,e.abrupt("return",o);case 5:case"end":return e.stop()}}),e)})));return function(t,r,n){return e.apply(this,arguments)}}(),N=function(e,t){return e.filter((function(e){return[e.displayName,e.description].join(" ").toLowerCase().includes(t.toLowerCase())}))},P=function(e){var t=e.reports,r=e.setReports,a=(0,u.useState)(!0),c=a[0],d=a[1],p=(0,u.useState)(""),f=p[0],m=p[1],v=(0,u.useState)(!1),g=v[0],x=v[1],b=(0,u.useState)(""),O=b[0],P=b[1],C=(0,u.useState)([]),U=C[0],Z=C[1],L=(0,u.useState)(!1),F=L[0],B=L[1],D=(0,u.useState)(""),E=D[0],M=D[1],H=(0,u.useState)([]),z=H[0],q=H[1],K=(0,u.useState)(!1),W=K[0],$=K[1],_=(0,u.useState)(!0),G=_[0],V=_[1],Y=(0,u.useState)([]),J=Y[0],Q=Y[1],X=(0,u.useState)(0),ee=X[0],te=X[1],re=(0,u.useState)([]),ne=re[0],se=re[1],ae=(0,u.useState)([]),ie=ae[0],oe=ae[1],ce=(0,u.useState)(!1),ue=ce[0],le=ce[1],de=(0,u.useState)([]),pe=de[0],fe=de[1],he=function(e){var t=(0,u.useState)([]),r=t[0],n=t[1],a=(0,S.a)(),c="Bearer ".concat(a.accessToken),l=T(),d=h();return(0,u.useEffect)((function(){var t=function(){var t=(0,s.Z)(i().mark((function t(){var r,s;return i().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,e(!0),t.next=4,l.queryRecentsAsync(c,k.BI.Project);case 4:return r=t.sent,t.next=7,R(c,d,r.data);case 7:s=t.sent,n(s),t.next=14;break;case 11:t.prev=11,t.t0=t.catch(0),o.toaster.negative("Failed to get recent iTwins and reports.",{hasCloseButton:!0});case 14:return t.prev=14,e(!1),t.finish(14);case 17:case"end":return t.stop()}}),t,null,[[0,11,14,17]])})));return function(){return t.apply(this,arguments)}}();t()}),[c,l,d,e]),[r,n]}(d),me=(0,n.Z)(he,1)[0],ve=(0,u.useRef)(null),ge=h(),ye=T(),xe=(0,S.a)(),be="Bearer ".concat(xe.accessToken),we=function(){m(""),Q([]),se([]),oe([]),x(!1)},je=function(){var e=(0,s.Z)(i().mark((function e(t,r,n,s){var a;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,s(!0),e.next=4,ye.queryAsync(be,k.BI.Project,{search:t,top:10});case 4:return a=e.sent,e.t0=r,e.next=8,R(be,ge,a.data);case 8:e.t1=e.sent,(0,e.t0)(e.t1),n(1),e.next=17;break;case 13:return e.prev=13,e.t2=e.catch(0),o.toaster.negative("Failed to fetch iTwins",{hasCloseButton:!0}),e.abrupt("return",[]);case 17:return e.prev=17,s(!1),e.finish(17);case 20:case"end":return e.stop()}}),e,null,[[0,13,17,20]])})));return function(t,r,n,s){return e.apply(this,arguments)}}(),ke=(0,u.useCallback)(function(){var e=(0,s.Z)(i().mark((function e(t,r,n,s,a,c){var u,l,d;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,ye.queryAsync(be,k.BI.Project,{search:t,top:10,skip:10*r});case 3:if(l=e.sent,0!==(null===(u=l.data)||void 0===u?void 0:u.length)){e.next=6;break}return e.abrupt("return");case 6:return e.next=8,R(be,ge,l.data);case 8:(d=e.sent).length>0&&(s([].concat((0,w.Z)(n),(0,w.Z)(d))),a((function(e){return e+1}))),e.next=15;break;case 12:e.prev=12,e.t0=e.catch(0),o.toaster.negative("Failed to fetch more iTwins",{hasCloseButton:!0});case 15:return e.prev=15,c(!1),e.finish(15);case 18:case"end":return e.stop()}}),e,null,[[0,12,15,18]])})));return function(t,r,n,s,a,i){return e.apply(this,arguments)}}(),[be,ye,ge]),Se=(0,u.useCallback)((function(){c||G||!ee||ke(f,ee,J,Q,te,d)}),[c,G,ee,ke,f,J]);(0,u.useEffect)((function(){ve.current&&ve.current.scrollIntoView({behavior:"smooth"})}),[ue]);var Te=(0,u.useMemo)((function(){return[{Header:"Table",columns:[{id:"ITwinNumber",Header:"iTwin Number",accessor:"number",Filter:o.tableFilters.TextFilter()},{id:"Name",Header:"Name",accessor:"displayName",Filter:o.tableFilters.TextFilter()},{id:"reportCount",Header:"Report Count",accessor:"reports.length",width:"125px"}]}]}),[]),Ie=(0,u.useMemo)((function(){return[{Header:"Table",columns:[{id:"Name",Header:"Name",accessor:"displayName",Filter:o.tableFilters.TextFilter()},{id:"Description",Header:"Description",accessor:"description",Filter:o.tableFilters.TextFilter()}]}]}),[]),Oe=(0,u.useMemo)((function(){return t}),[t]),Ae=(0,u.useMemo)((function(){return J}),[J]),Re=(0,u.useMemo)((function(){return me}),[me]),Ne=(0,u.useMemo)((function(){return ne}),[ne]),Pe=(0,u.useMemo)((function(){return U}),[U]),Ce=(0,u.useMemo)((function(){return z}),[z]),Ue=(0,u.useMemo)((function(){return function(e,t){se(t.original.reports),t.toggleRowSelected(!0),Ze()}}),[]),Ze=function(){B(!1),P(""),Z([])},Le=function(){q([]),$(!1),M("")};return(0,I.jsx)(I.Fragment,{children:(0,I.jsxs)("div",{className:"reports-container",children:[(0,I.jsx)(y.Z,{header:"Associated Reports",children:(0,I.jsxs)("div",{className:"associated-reports-table",children:[(0,I.jsxs)("div",{className:"reports-table-header",children:[(0,I.jsxs)("div",{className:"header-content",children:[(0,I.jsx)(o.Button,{styleType:"high-visibility",onClick:function(){le(!0),se([]),Ze()},disabled:ue,startIcon:(0,I.jsx)(l.zWu,{}),children:"Add Reports"}),(0,I.jsx)(o.Button,{onClick:function(){var e=t.filter((function(e){return!pe.filter((function(t){return t.id===e.id})).length}));r(e),fe([]),W&&q(N(e,E))},disabled:0===pe.length,startIcon:(0,I.jsx)(l.uSB,{}),children:"Remove Selected"})]}),(0,I.jsx)("div",{className:"header-content",children:(0,I.jsx)("form",{onSubmit:function(e){e.preventDefault(),q(N(t,E)),$(!0)},children:(0,I.jsx)(o.LabeledInput,{id:"associatedReportSearch",placeholder:"Search",iconDisplayStyle:"inline",disabled:!W&&0===t.length,required:!0,value:E,onChange:function(e){M(e.target.value)},svgIcon:W?(0,I.jsx)(o.IconButton,{onClick:function(){return setTimeout((function(){Le()}),100)},styleType:"borderless",children:(0,I.jsx)(l.GG$,{})}):(0,I.jsx)(o.IconButton,{disabled:!W&&0===t.length,type:"submit",styleType:"borderless",children:(0,I.jsx)(l.yrh,{})})})})})]}),(0,I.jsx)(o.Table,{style:{height:"400px"},data:W?Ce:Oe,isSelectable:!0,columns:Ie,emptyTableContent:"No reports associated with this key.",onSelect:function(e){e&&fe(e)}})]})}),ue&&(0,I.jsxs)("div",{children:[(0,I.jsx)(o.Title,{children:"Report Lookup"}),(0,I.jsxs)("div",{className:"report-modification",ref:ve,children:[(0,I.jsx)("div",{className:"project-selection-table",children:(0,I.jsxs)(y.Z,{header:"iTwins",children:[(0,I.jsxs)("div",{className:"reports-table-header",children:[(0,I.jsxs)("div",{className:"header-content",children:[(0,I.jsx)(o.Button,{className:G?"iui-active":"",onClick:(0,s.Z)(i().mark((function e(){return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:we(),V(!0);case 2:case"end":return e.stop()}}),e)}))),startIcon:(0,I.jsx)(l.h$b,{}),children:"View Recent"}),(0,I.jsx)(o.Button,{className:G?"":"iui-active",onClick:(0,s.Z)(i().mark((function e(){return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return V(!1),we(),e.next=4,je("",Q,te,d);case 4:case"end":return e.stop()}}),e)}))),startIcon:(0,I.jsx)(l.yrh,{}),children:"Search All"})]}),(0,I.jsx)("div",{className:"header-content",children:(0,I.jsx)("form",{onSubmit:function(){var e=(0,s.Z)(i().mark((function e(t){return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.preventDefault(),Q([]),e.next=4,je(f,Q,te,d);case 4:x(!0);case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),children:!G&&(0,I.jsx)(o.LabeledInput,{id:"projectContextSwitch",placeholder:"Search all iTwins",iconDisplayStyle:"inline",required:!0,value:f,onChange:function(e){m(e.target.value)},svgIcon:g?(0,I.jsx)(o.IconButton,{onClick:function(){return setTimeout((0,s.Z)(i().mark((function e(){return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return we(),e.next=3,je("",Q,te,d);case 3:case"end":return e.stop()}}),e)}))),100)},styleType:"borderless",children:(0,I.jsx)(l.GG$,{})}):(0,I.jsx)(o.IconButton,{type:"submit",styleType:"borderless",children:(0,I.jsx)(l.yrh,{})})})})})]}),(0,I.jsx)(o.Table,{data:G?Re:Ae,style:{height:"400px",minWidth:"374px"},onRowClick:Ue,isSortable:!1,columns:Te,emptyTableContent:"No iTwins found.",stateReducer:function(e,t){return"toggleRowSelected"===t.type?A(A({},e),{},{selectedRowIds:(0,j.Z)({},t.id,t.value)}):e},isRowDisabled:function(e){return e.forbidden},isLoading:c,onBottomReached:Se})]})}),(0,I.jsx)("div",{className:"report-selection-table",children:(0,I.jsxs)(y.Z,{header:"Reports",children:[(0,I.jsxs)("div",{className:"reports-table-header",children:[(0,I.jsx)("div",{className:"header-content",children:(0,I.jsx)("div",{className:"interactive-corner",children:(0,I.jsx)(o.Button,{onClick:function(){r((function(e){return[].concat((0,w.Z)(e),(0,w.Z)(ie))})),le(!1),oe([]),Le()},disabled:!(ne.length>0&&ie.length>0),styleType:"high-visibility",startIcon:(0,I.jsx)(l.zWu,{}),children:"Add Selected"})})}),(0,I.jsx)("div",{className:"header-content",children:(0,I.jsx)("div",{children:(0,I.jsx)("form",{onSubmit:function(e){e.preventDefault(),Z(N(ne,O)),B(!0)},children:(0,I.jsx)(o.LabeledInput,{id:"reportSearch",placeholder:"Search reports",iconDisplayStyle:"inline",required:!0,value:O,onChange:function(e){P(e.target.value)},disabled:0===Ne.length,svgIcon:F?(0,I.jsx)(o.IconButton,{onClick:function(){return setTimeout((function(){Ze()}),100)},styleType:"borderless",children:(0,I.jsx)(l.GG$,{})}):(0,I.jsx)(o.IconButton,{type:"submit",styleType:"borderless",children:(0,I.jsx)(l.yrh,{})})})})})})]}),(0,I.jsx)(o.Table,{style:{height:"400px"},isSelectable:!0,data:F?Pe:Ne,columns:Ie,emptyTableContent:"No iTwins selected or reports available.",isRowDisabled:function(e){return t.some((function(t){return t.id.includes(e.id)}))},onSelect:function(e){e&&oe(e)}})]})})]})]})]})})},C=function(e){var t=e.toLocaleDateString("en-US",{year:"numeric",month:"2-digit",day:"2-digit"}).split("/");return"".concat(t[2],"-").concat(t[0],"-").concat(t[1])},U=function(){var e=(0,u.useState)(""),t=e[0],r=e[1],a=(0,u.useState)([]),p=a[0],f=a[1],w=(0,u.useState)(),j=w[0],k=w[1],T=(0,u.useState)(""),O=T[0],A=T[1],R=(0,u.useState)(),N=R[0],U=R[1],Z=(0,u.useState)(!1),L=Z[0],F=Z[1],B=(0,m.ZP)(),D=(0,n.Z)(B,2),E=D[0],M=D[1],H=(0,u.useState)(!1),z=H[0],q=H[1],K=(0,c.useRouter)(),W="/apis/insights/api-keys/",$=K.query.id,_=(0,d.$)();!function(e,t,r,n,a,c,l){var p=(0,S.a)(),f="Bearer ".concat(p.accessToken),m=(0,d.$)(),v=h();(0,u.useEffect)((function(){if(e){c(!0);var u=function(){var u=(0,s.Z)(i().mark((function u(){var d,p;return i().wrap((function(u){for(;;)switch(u.prev=u.next){case 0:return u.prev=0,u.next=3,m.getApiKey(e);case 3:return d=u.sent,t(d.apiKey.name),u.t0=r,u.next=8,Promise.all(d.apiKey.reportIds.map(function(){var e=(0,s.Z)(i().mark((function e(t){return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,v.getReport(f,t);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()));case 8:u.t1=u.sent,(0,u.t0)(u.t1),p=new Date(d.apiKey.expiresAt),n(p),a(C(p)),u.next=19;break;case 15:u.prev=15,u.t2=u.catch(0),o.toaster.negative("Failed to fetch API Key details.",{hasCloseButton:!0}),l(!0);case 19:return u.prev=19,c(!1),u.finish(19);case 22:case"end":return u.stop()}}),u,null,[[0,15,19,22]])})));return function(){return u.apply(this,arguments)}}();u()}}),[f,e,m,v,n,a,l,c,t,r])}($,r,f,k,A,F,q),z&&K.push(W);var G=function(){var e=(0,s.Z)(i().mark((function e(){return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(E.allValid()){e.next=3;break}return M(!0),e.abrupt("return");case 3:if(e.prev=3,F(!0),!$){e.next=10;break}return e.next=8,_.updateApiKey($,{name:t,reportIds:p.map((function(e){return e.id})),expiresAt:null===j||void 0===j?void 0:j.toISOString()});case 8:e.next=15;break;case 10:return e.t0=U,e.next=13,_.createApiKey({name:t,reportIds:p.map((function(e){return e.id})),expiresAt:null===j||void 0===j?void 0:j.toISOString()});case 13:e.t1=e.sent,(0,e.t0)(e.t1);case 15:$&&K.push(W),e.next=21;break;case 18:e.prev=18,e.t2=e.catch(3),o.toaster.negative("Error saving API Key",{hasCloseButton:!0});case 21:return e.prev=21,F(!1),e.finish(21);case 24:case"end":return e.stop()}}),e,null,[[3,18,21,24]])})));return function(){return e.apply(this,arguments)}}();return(0,I.jsxs)(I.Fragment,{children:[(0,I.jsxs)("div",{id:"key-page",className:"page-content-container",children:[(0,I.jsx)(x.Z,{content:(0,I.jsxs)(o.Headline,{children:[$?"Modify":"Add"," API Key"]})}),(0,I.jsxs)("div",{className:"api-key-action-container",children:[(0,I.jsx)(y.Z,{header:"Details",children:(0,I.jsxs)("div",{className:"details-form",children:[(0,I.jsx)(o.Small,{className:"field-legend",children:"Asterisk * indicates mandatory fields."}),(0,I.jsx)(o.LabeledInput,{id:"name",required:!0,className:"names-input",label:"Name",value:t,onChange:function(e){r(e.target.value),E.showMessageFor("name")},message:E.message("name",t,"required"),status:E.message("name",t,"required")?"negative":void 0,onBlur:function(){E.showMessageFor("name")},onBlurCapture:function(e){r(e.target.value),E.showMessageFor("name")}}),(0,I.jsx)(o.LabeledInput,{id:"expiresAt",className:"expires-at-input",label:"Expires At",type:"date",required:!0,min:C(new Date),max:function(){var e=new Date;return e.setFullYear(e.getFullYear()+1),e.toISOString().split("T")[0]}(),value:O,onChange:function(e){var t=new Date(e.target.value.replaceAll("-","/"));t.setHours(23,59,59,999),k(t),A(e.target.value)},onBlur:function(){E.showMessageFor("expiresAt")},status:E.message("expiresAt",j,"required|WithinOneYearTimeFrame")?"negative":void 0,message:E.message("expiresAt",j,"required|WithinOneYearTimeFrame")})]})}),(0,I.jsx)(y.Z,{header:(0,I.jsxs)("div",{className:"reports-label",children:["Reports Menu",(0,I.jsx)(o.Tooltip,{placement:"auto",style:{pointerEvents:"auto",backgroundColor:"#000000"},content:(0,I.jsx)(o.Small,{children:"User must have REPORTINGVIEW permission assigned at the Project level. iModel specific permissions may also be applied at the iModel level if iModel level permissions are enabled. Alternatively the user should be an Organization Administrator for the Organization that owns a given Project or iModel. An Organization Administrator must have at least one of the following roles assigned in User Management: Account Administrator, Co-Administrator, or CONNECT Services Administrator. For more information about User Management please visit our Bentley Communities wiki page."}),children:(0,I.jsx)("div",{className:"info-icon",children:(0,I.jsx)(l.MCn,{})})})]}),children:(0,I.jsx)(P,{reports:p,setReports:f})})]}),(0,I.jsx)(g.Z,{onSave:G,onCancel:function(){K.push(W)}})]}),L&&(0,I.jsx)(b.b,{}),N&&(0,I.jsxs)(o.Modal,{title:"Success",modalRootId:"key-page",onClose:function(){K.push(W)},closeOnExternalClick:!1,isOpen:N,children:[(0,I.jsx)(o.Leading,{children:"You have successfully created a new API Key."}),(0,I.jsxs)("div",{className:"key-wrapper",children:[(0,I.jsx)(o.LabeledInput,{label:"Key",value:null===N||void 0===N?void 0:N.data.apiKey.key,readOnly:!0}),(0,I.jsx)(o.IconButton,{onClick:function(){return v.c.copyToClipboard(null===N||void 0===N?void 0:N.data.apiKey.key,(function(){return o.toaster.positive("Copied!",{hasCloseButton:!0,type:"temporary"})}))},children:(0,I.jsx)(l.xF4,{})})]}),(0,I.jsx)(o.Alert,{style:{marginTop:"5px"},type:"warning",children:"The key is only displayed once, you will not be able to retrieve it again after closing. Please copy the key."})]})]})}},69338:function(e,t,r){"use strict";r.d(t,{N:function(){return u}});var n=r(50029),s=r(87794),a=r.n(s),i=r(67294),o=r(28038),c=r(45829);function u(){var e=(0,c.m)(),t=e.user,r=e.isLoggedIn,s=(0,i.useMemo)((function(){return new o.Z(t.accessToken)}),[t]),u=(0,i.useState)(!0),l=u[0],d=u[1],p=(0,i.useState)(!1),f=p[0],h=p[1],m=(0,i.useCallback)((0,n.Z)(a().mark((function e(){return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,s.acceptTermsOfService();case 2:case"end":return e.stop()}}),e)}))),[s]);return(0,i.useEffect)((function(){r?s.getTermsOfServiceState().then((function(e){return d(e)})).catch((function(){return d(!0)})).finally((function(){return h(!0)})):(d(!0),h(!1))}),[s,r]),(0,i.useMemo)((function(){return{isTermsOfServiceAccepted:l,receivedState:f,acceptTermsOfService:m}}),[m,l,f])}},85393:function(e,t,r){"use strict";r.d(t,{$:function(){return i}});var n=r(67294),s=r(25692),a=r(23315);function i(){var e=(0,a.a)();return(0,n.useMemo)((function(){return new s.o(e.accessToken)}),[e])}},79036:function(e,t,r){"use strict";r.d(t,{Iv:function(){return n}});var n,s=r(67294),a=r(41283),i=r.n(a),o=r(51477);!function(e){e.AppName="applicationName",e.ApiGroups="apiGroups",e.AppType="appType",e.RedirectURI="redirectURI",e.PostLogoutRedirectURI="postLogoutRedirectURI",e.Scopes="scopes",e.Owner="owner",e.ProjectParticipants="projectParticipants",e.AppDetailsSwitchBackReasons="appDetailsSwitchBackReasons"}(n||(n={}));var c=function(e){switch(e){case n.AppName:return',;[]=<>?"{}|+!@#$%^*`~';case"firstName":case"lastName":return':;[]=<>?"{}|+!@#$%^*`~\\/()^&';case"company":return':;[]=<>?"{}|+!@#$%^*`~\\/()^';default:return""}},u={UriIsHttpOrHttps:{message:"Your URI is not allowed. URI must be HTTPS or HTTP (only for loopback URIs).",rule:function(e){var t=("string"===typeof e?e:e.value).toLowerCase();if(""===t)return!0;try{var r=o.c.ParseUri(t);return void 0!==r&&["http","https"].some((function(e){return e===r.scheme}))}catch(n){return!1}}},UriIsSecure:{message:"This URI is not allowed. URI must start with HTTPS or HTTP (only for loopback URIs).",rule:function(e){var t=("string"===typeof e?e:e.value).toLowerCase(),r=RegExp("^http://(localhost:?)|(127.0.0.1:?)|(::1:?)");return""===t||(!t.startsWith("http://")||r.test(t))}},AllowedUriScheme:{message:"This URI scheme is not allowed.",rule:function(e){var t=("string"===typeof e?e:e.value).toLowerCase(),r=RegExp("^(javascript:)|(file:)|(data:)|(mailto:)|(ftp:)|(blob:)|(about:)|(ssh:)|(tel:)|(view-source:)|(ws:)|(wss:)");return""===t||!r.test(t)}},NoFragments:{message:"Fragments are not allowed.",rule:function(e){var t=("string"===typeof e?e:e.value).toLowerCase();return""===t||-1===t.indexOf("#")}},UriContainsOrigin:{message:"Your URI is not allowed. URI must start with origin part.",rule:function(e){var t=("string"===typeof e?e:e.value).toLowerCase();if(""===t)return!0;try{var r,n=o.c.ParseUri(t),s=new URL(t).origin,a=t.match("^.*".concat(null!==(r=null===n||void 0===n?void 0:n.authority)&&void 0!==r?r:""));return null!==a&&a[0]===s}catch(i){return!1}}},UriContainsAuthorityOrPath:{message:"Uri does not contain authority or path.",rule:function(e){var t=("string"===typeof e?e:e.value).toLowerCase();if(""===t)return!0;try{var r=o.c.ParseUri(t),n=void 0!==r&&[void 0,null,""].every((function(e){return e!==(null===r||void 0===r?void 0:r.authority)})),s=void 0!==r&&[void 0,null,"","/"].every((function(e){return e!==(null===r||void 0===r?void 0:r.path)}));return n||s}catch(a){return!1}}},NoDuplicates:{message:"Duplicates are not allowed.",rule:function(e){if("string"===typeof e)return!0;var t=e.allValues?e.allValues.map((function(e){return e.toLowerCase()})):[];return""===e.value||(t.indexOf(e.value.toLowerCase())===e.index||-1===t.indexOf(e.value.toLowerCase()))}},ValidEmail:{message:"The email must be a valid email address.",rule:function(e){var t=("string"===typeof e?e:e.value).toLowerCase(),r=RegExp(/^[a-zA-Z0-9'_+&*\-{|}]+(?:\.[a-zA-Z0-9'_+&*\-{|}]+)*@(?:[a-zA-Z0-9-]+\.)+[a-zA-Z]{2,24}$/);return""===t||r.test(t)}},IsWellFormedUri:{message:"URI is not absolute or well-formed.",rule:function(e){var t=("string"===typeof e?e:e.value).toLowerCase();return""===t||o.c.IsWellFormedUri(t)}},HasAtLeastOneUri:{message:"This field is required.",rule:function(e){return e.allValues.filter((function(e){return""!==e})).length>0}},HasAtLeastOneAPIAssociation:{message:"Please select at least one API association.",rule:function(e){return e.filter((function(e){return e.isSelected})).length>0}},HasAtLeastOneScope:{message:"You must provide a scope for at least one API association selected.",rule:function(e){return e.length>0},required:!0},AppTypeIsSelected:{message:"Please select the application type.",rule:function(e){return void 0!==e}},ImodelSourceIsSelected:{message:"Please select the iModel source.",rule:function(e){return void 0!==e}},MaxStringSize:{message:"The :field may not be greater than :max characters.",rule:function(e,t){return e.length<=parseFloat(t[0])},messageReplace:function(e,t){return e.replace(":max",t[0]).replace(":field",t[1])}},NoInvalidChars:{message:"The :label cannot contain following characters: :chars",rule:function(e,t){var r=c(t[1]);return new RegExp("^[^".concat(o.c.EscapeRegExp(r),"]+$"),"g").test(e)},messageReplace:function(e,t){return e.replace(":label",t[0]).replace(":chars",c(t[1]))}},AllowedFileExtensions:{message:"This file type is not allowed.",rule:function(e,t){return t.some((function(t){return e.name.endsWith(t)}))}},MaxFileSize:{message:"This file is too large to upload. The maximum file size supported is :size.",rule:function(e,t){return e.size<=t},messageReplace:function(e,t){return e.replace(":size",o.c.formatBytes(t))}},NoSpacesInFileName:{message:"File name cannot contain spaces.",rule:function(e){return!e.name.match(/ /)}},WithinOneYearTimeFrame:{message:"Dates in the past or more than one year into the future are not allowed.",rule:function(e){var t=new Date;return e.getTime()<t.getTime()+31536e6&&t.getTime()<e.getTime()}},ValidPhoneNumber:{message:"Phone number format is not valid.",rule:function(e){return!!e.match(/^[+]*[(]{0,1}[0-9]{1,4}[)]{0,1}[-\s\./0-9]*$/g)}},CompleteRecaptcha:{message:"Please confirm that you are not a robot.",required:!0,rule:function(e){return void 0!==e&&""!==e}},UrisAreSecure:{message:"All URIs must start with HTTPS or HTTP (only for loopback URIs).",rule:function(e){return e.every((function(e){return""===e||e.toLowerCase().startsWith("http://")||e.toLowerCase().startsWith("https://")}))}},UrisAreUnique:{message:"All URIs must be unique.",rule:function(e){return e.every((function(t,r){return e.indexOf(t)===r||""===t}))}},UrisFollowAllowedScheme:{message:"All URIs must follow allowed scheme.",rule:function(e){var t=RegExp("^(javascript:)|(file:)|(data:)|(mailto:)|(ftp:)|(blob:)|(about:)|(ssh:)|(tel:)|(view-source:)|(ws:)|(wss:)");return e.every((function(e){return""===e||!t.test(e)}))}},UrisDoNotContainFragments:{message:"URIs cannot contain fragments.",rule:function(e){return e.every((function(e){return""===e||-1===e.indexOf("#")}))}},UrisAreNotWellFormatted:{message:"All URIs must be absolute and well-formed.",rule:function(e){return e.every((function(e){return""===e||o.c.IsWellFormedUri(e)&&!e.endsWith("https://")&&!e.endsWith("http://")}))}},UrisAreNotEmpty:{message:"URIs cannot be empty.",rule:function(e){return e.every((function(e){return""!==e}))}}},l={required:"This field is required."};t.ZP=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:l,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:u,r=(0,s.useState)(!1),n=r[0],a=r[1],o=(0,s.useState)(),c=(o[0],o[1]),d=(0,s.useRef)(new(i())({messages:e,validators:t,autoForceUpdate:{forceUpdate:function(){return c((function(e){return!e}))}}}));return(0,s.useEffect)((function(){n&&d.current.showMessages()}),[n]),[d.current,a]}},58475:function(e,t,r){"use strict";r.d(t,{h:function(){return f}});var n=r(59499),s=r(11163),a=r.n(s),i=r(67294),o=r(31993),c=r(61686),u=r(99301),l=r(69338),d=r(85893);function p(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}var f=function(e){return function(t){var r=(0,l.N)().isTermsOfServiceAccepted,s=(0,u.m)(),f=s.isLoaded,h=s.isLoggedIn,m=s.signin,v=h&&r;return(0,i.useEffect)((function(){f&&!v&&(h?r||a().push("".concat(c.sz,"?redirect=").concat(encodeURIComponent(a().asPath))):m())}),[f,h,r,v,m]),v?(0,d.jsx)(e,function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?p(Object(r),!0).forEach((function(t){(0,n.Z)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):p(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}({},t)):(0,d.jsx)(o.b,{isFullPage:!0})}}},64219:function(){},50854:function(){},3830:function(){},45046:function(){},79109:function(){},72223:function(){}}]);