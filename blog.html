<script type="text/javascript">

/* TODO:
    - load pages as people scroll down, 
    (which isn't necessary yet given the tiny size of the site)
    - add more post metadata via git hooks, i.e. generating title,
    post date, last edit date, etc
    - anchors so articles can be linked, also read individually
*/

function BlogTable (data) {
    this.records = data.split('\n').filter(x => x !== '');
}

function loadBlogs() {
    fetch('/blog/record.txt', {
        //cachemode: 'no-cache'
    })
    .then(resp => resp.text())
    .then(data => {
        var table = new BlogTable(data);
        var articles = table.records;
        for (var i = 0, article = articles[0]; i < articles.length; ++i, article = articles[i] ) {
            fetch(`blog/${article}`)
            .then(blog_resp => blog_resp.text())
            .then((j => text => {
                var this_blog_content = format(text);
                var this_blog = $(this_blog_content);
                var blogs_in_dom = $('#content .blog');
                var blog_at_intended_loc = blogs_in_dom[j];
                if (blog_at_intended_loc !== undefined)
                    $(this_blog).insertBefore(blog_at_intended_loc);
                else
                    $('#content').append(this_blog)
            })(i));  // HACK: for unique, correct value of i
        }
    });
}

loadBlogs();

</script>
<style>
.blog {
    text-align: left;
}
p code {
    margin: 5pt;
}
</style>
